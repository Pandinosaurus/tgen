/*
 tgen.js - the seamless texture generator
 https://github.com/schalkt/tgen/
 http://seamless-texture.com/

 Copyright (c) 2015 Tamas Schalk
 MIT license

 @version 0.4.4
*/
((f)=>{window[f]={version:"0.4.4",defaults:{},effects:{},blends:{},shapes:{},colormaps:{},events:{beforeEffect:{},afterEffect:{},beforeRender:{},afterRender:{}},config:{historyLast:15,historyName:"history",historyList:[]},effect(c,a,b){this.defaults[c]=a;this.effects[c]=b},event(c,a,b){void 0!=this.events[c]&&(this.events[c][a]=b)},blend(c,a){this.blends[c]=a},shape(c,a){this.shapes[c]=a},colormap(c,a){this.colormaps[c]=a},init(c,a,b){var d=this,h=[],g={},n=0,f=null,e={shape:d.shapes,effects:Object.keys(d.effects),
layers:[],normalize:b?b:"limitless"},k=()=>{void 0==c&&(c=256);1>c&&(c=256);1>a&&(a=256);1024<c&&(c=1024);1024<a&&(a=1024);void 0==a&&(a=c);f=(c+a)/2};k();e.clear=()=>{e.texture.clear();e.layers=[];h=[];n=0;g.start=(new Date).getTime();return e};e.buffer=function(b){this.data=null;this.components=4;this.width=c;this.height=a;this.wha=(this.width+this.height)/2;this.background=[0,0,0,255];"object"==typeof b&&(this.background=b);this.pixels=function(){return this.width*this.height};this.size=function(){return this.data.length};
this.export=function(){var a=this.size();switch(e.normalize){case "limitless":for(var b=new Float32Array(a);a--;)b[a]=this.data[a];break;case "clamped":for(b=new Uint8ClampedArray(a);a--;)b[a]=this.data[a];break;case "pingpong":for(b=new Uint8ClampedArray(a);a--;)b[a]=e.calc.pingpong(this.data[a],0,255)}return b};this.clear=function(a){this.data=new Float32Array(this.width*this.height*this.components);void 0==a&&(a=this.background);for(var b=this.size();b;)this.data[b-1]=a[3],this.data[b-2]=a[2],
this.data[b-3]=a[1],this.data[b-4]=a[0],b-=this.components};this.pattern=(a,b)=>{var c=a/b;if(a>=b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,c=b-Math.abs(a-c),c>=b&&(c-=b),c};this.offset=function(a,b){a=parseInt(a,10);b=parseInt(b,10);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.components+a*this.components};this.set=function(a,b,c){a=this.offset(a,b);this.data[a]=c[0];this.data[a+1]=c[1];this.data[a+
2]=c[2];this.data[a+3]=c[3]};this.get=function(a,b){var c=this.offset(a,b);return[this.data[c],this.data[c+1],this.data[c+2],this.data[c+3]]};this.canvas=function(a){var b=this.size();for(a=a.getContext("2d").getImageData(0,0,this.width,this.height).data;b--;)e.texture.data[b]=a[b]};null===this.data&&this.clear()};e.texture=new e.buffer;e.layerCopy=function(a){var b=[];a=this.layers[a];for(var c=a.length;c--;)b[c]=a[c];return b};var m=(a,b)=>{var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c};
e.clone=function(a,b){for(var c in b)"object"===typeof b[c]&&null!==b[c]&&a[c]?this.clone(a[c],b[c]):a[c]=b[c]};e.randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;e.randIntSeed=(a,b)=>Math.floor(e.calc.randomseed()*(b-a+1))+a;e.randReal=(a,b)=>Math.random()*(b-a)+a;e.randRealSeed=(a,b)=>e.calc.randomseed()*(b-a)+a;e.randByArray=(a,b)=>{"object"==typeof a&&(a=void 0!=b?e.randReal(a[0],a[1]):e.randInt(a[0],a[1]));return a};e.randByArraySeed=(a,b)=>{"object"==typeof a&&(a=void 0!=b?e.randRealSeed(a[0],
a[1]):e.randIntSeed(a[0],a[1]));return a};var p=(a)=>{void 0===a&&(a=255);!0===a&&(a=128+e.randInt(0,128));return[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),a]};e.randItem=(a)=>{var b=e.randInt(0,a.length-1);return a[b]};var q=(a)=>{var b,c=0,d;for(d in a)Math.random()<1/++c&&(b=d);return b};e.rgba=(a,b)=>{if("random"===a)return p(b);if("randomalpha"===a)return p(!0);"object"==typeof a[0]&&(a[0]=e.randInt(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=e.randInt(a[1][0],a[1][1]));"object"==
typeof a[2]&&(a[2]=e.randInt(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=e.randInt(a[3][0],a[3][1]));0!==a[3]%1&&(a[3]=Math.round(255*a[3]));1==a[3]&&(a[3]=255);return a};e.findClosestIndex=(a,b,c)=>{for(;0<=b&&b<=a.length-1;b+=c)if(a[b])return b;return a.length-1};e.calc={pi:3.1415927,luminance(a){return.21*a[0]+.72*a[1]+.07*a[2]},randomseed(a){void 0==this.seed&&(this.seed=e.randInt(1,262140));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);return a-Math.floor(a)},normalize1(a){return e.calc.normalize(a,
0,1)},normalize(a,b,c){return a>c?c:a<b?b:a},pingpong(a,b,c){return a>c?c-(a-c):a<b?Math.abs(b):a},interpolate:{linear(a,b,c){return a*(1-c)+b*c},cosine(a,b,c){c=.5*(1-Math.cos(c*e.calc.pi));return a*(1-c)+b*c},catmullrom(a,b,c,d,e,h){e/=h;d=d-c-(a-b);a=d*e*e*e+(a-b-d)*e*e+(c-a)*e+b;0>a&&(a=0);1<a&&(a=1);return a}}};e.colormap={data:null,size:255,init(a,b,h){this.data=null;this.size=void 0==b?c:b;if(void 0==a||null==a)return a;if("object"==typeof a)if("object"==typeof a[0])for(key in a){var g=a[key];
g.rgba=e.rgba(g.rgba);a[key]=g}else a=e.randItem(a);if("random"===a){g=e.randInt(1,4);a=[];for(var f=0;f<=g;f++)a[f]={percent:parseInt(f/g*100),rgba:[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),255]}}"function"==typeof h&&h(a);"string"==typeof a&&(h=!1,"!"==a.charAt(0)&&(a=a.substring(1),h=!0),"function"==typeof d.colormaps[a]&&(b=d.colormaps[a](b),this.data=this.render(b,h)));"object"==typeof a&&(this.data=this.render(a))},render(a,b){for(var c=[],d=0;d<a.length-1;d++)for(var e=a[d],h=a[d+
1],g=Math.round(e.percent/100*this.size),f=Math.round(h.percent/100*this.size),n=g;n<=f;n++)c[b?this.size-n:n]=[e.rgba[0]+(n-g)/(f-g)*(h.rgba[0]-e.rgba[0]),e.rgba[1]+(n-g)/(f-g)*(h.rgba[1]-e.rgba[1]),e.rgba[2]+(n-g)/(f-g)*(h.rgba[2]-e.rgba[2]),e.rgba[3]+(n-g)/(f-g)*(h.rgba[3]-e.rgba[3])];return c},get(a,b){if(void 0==a)return this.data;a=e.calc.pingpong(parseInt(a),0,this.size);var c=this.data[a];void 0!==b&&(c[3]=b[3]);return c}};e.wrapx=(a)=>a&c-1;e.wrapy=(b)=>b&a-1;e.point={rgba:[],mixed:[],blend:"opacity",
colorize(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:255]},opacity(a,b){if(255==a[3])return a[3]=b[3],a;if(0==b[3])return b;var c=a[3]/255;return[a[0]*c+b[0]*(1-c),a[1]*c+b[1]*(1-c),a[2]*c+b[2]*(1-c),b[3]]},set(a,b){var c=e.texture.get(a,b);void 0!==d.blends[this.blend]?(this.rgba=d.blends[this.blend](e,c,this.rgba),this.mixed=this.opacity(this.rgba,c)):this.mixed=this.rgba;switch(e.normalize){case "clamped":this.mixed[0]=Math.max(0,
Math.min(255,this.mixed[0]));this.mixed[1]=Math.max(0,Math.min(255,this.mixed[1]));this.mixed[2]=Math.max(0,Math.min(255,this.mixed[2]));this.mixed[3]=Math.max(0,Math.min(255,this.mixed[3]));break;case "pingpong":this.mixed[0]=e.calc.pingpong(this.mixed[0],0,255),this.mixed[1]=e.calc.pingpong(this.mixed[1],0,255),this.mixed[2]=e.calc.pingpong(this.mixed[2],0,255),this.mixed[3]=e.calc.pingpong(this.mixed[3],0,255)}e.texture.set(a,b,this.mixed)},get(a,b,c){return e.texture.get(a,b)}};e.walk=(b)=>{for(var d=
0;d<c;d++)for(var h=0;h<a;h++){var g=e.point.get(d,h),g=b(g,d,h);e.point.rgba=g;e.point.set(d,h)}};e.percent=(a,b)=>parseInt(a/100*b,10);e.percentX=(a)=>parseInt(a/100*c,10);e.percentY=(b)=>parseInt(b/100*a,10);e.percentXY=(a)=>parseInt(a/100*f,10);e.xysize=(b,d)=>{if(void 0!=d.elements)var h=d.elements[b].x,g=d.elements[b].y,f=d.elements[b].size;else"random"==d.origin?(h=e.randIntSeed(0,c),g=e.randIntSeed(0,a)):(h=d.origin[0],g=d.origin[1]),f=e.randByArraySeed(d.size);return{x:h,y:g,size:f}};e.toContext=
(b,d)=>{for(var e=b.createImageData(c,a),h=e.data,g=d.length,f=0;f<g;f+=4)h[f]=d[f],h[f+1]=d[f+1],h[f+2]=d[f+2],h[f+3]=d[f+3];return e};e.toCanvas=function(b){void 0==b&&(b=e.texture.data);var d=document.createElement("canvas");d.width=c;d.height=a;var h=d.getContext("2d");b=this.toContext(h,b);h.putImageData(b,0,0);return d};e.getCanvas=function(a){if(a){var b=this.toCanvas(this.layers[this.layers.length-1]);a(b)}return this};e.getPhases=function(a){if(a){for(var b=[],c=e.layers.length,d=0;d<c;d++)b.push(this.toCanvas(this.layers[d]));
a(b)}return this};e.stat=function(a){g.stop=(new Date).getTime();g.elapsed=(g.stop-g.start)/1E3;a&&a(g);return this};e.history={available(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(a){return!1}},list(){return this.available()?JSON.parse(window.localStorage.getItem(d.config.historyName))||[]:[]},last(){return this.available()?d.config.historyList[d.config.historyList.length-1]:[]},get(a){return this.available()?d.config.historyList[a]?d.config.historyList[a]:
null:[]},add(a){if(d.config.historyLast){if(!this.available())return[];a=e.params(a);d.config.historyList=JSON.parse(window.localStorage.getItem(d.config.historyName))||[];d.config.historyList.length>=d.config.historyLast&&d.config.historyList.shift();d.config.historyList.push(a);window.localStorage.setItem(d.config.historyName,JSON.stringify(d.config.historyList))}}};e.params=(b)=>{void 0==b&&(b=new Date,b=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+" l"+e.layers.length+" i"+h.length);return{name:b,
version:d.version,width:c,height:a,normalize:e.normalize,items:h}};e.render=function(b,h){e.event("beforeRender",b);var g=0;void 0!=b.width&&(c=b.width);void 0!=b.height&&(a=b.height);e.normalize=void 0!=b.normalize?b.normalize:"limitless";k();e.texture=new e.buffer(b.background);1!=h&&e.clear();for(var f in b.items){n=b.items[f][0];var p=b.items[f][1],l=b.items[f][2];"random"==p&&(p=q(e.defaults));"object"==typeof p&&(p=e.randItem(p));g!=n&&(void 0!=e.layers[n]?e.texture.data=e.layers[n]:e.texture.clear(),
g=n);if(void 0!=e[p])e[p](l);else void 0!=d.effects[p]?e.do(p,l):console.warn("undefined effect: "+p);e.layers[n]=e.texture.export()}e.event("afterRender",e.params());e.history.add();return this};e.event=(a,b)=>{for(var c in d.events[a]){var h=d.events[a][c];"function"==typeof h&&h(e,b)}};e.do=(a,b)=>{var c=b;void 0===b?b=m({},d.defaults[a]):"object"==typeof b&&(b=m(d.defaults[a],b));var g=b;"object"==typeof g.count&&(g.count=e.randInt(g.count[0],g.count[1]));"random"===g.blend&&(g.blend=q(d.blends));
"object"==typeof g.blend&&(g.blend=g.blend[e.randInt(0,g.blend.length-1)]);e.point.blend=void 0!==g.blend?g.blend:"";g.rgba&&(g.rgba=e.rgba(g.rgba),e.point.rgba=[g.rgba[0],g.rgba[1],g.rgba[2],g.rgba[3]]);g.rgb&&(g.rgb=e.rgba(g.rgb),e.point.rgba=[g.rgb[0],g.rgb[1],g.rgb[2],255]);b=g;e.event("beforeEffect",{layer:n,name:a,params:b});"function"==typeof d.effects[a]?b=d.effects[a](e,b):console.warn("effect not callable: "+a);void 0===b&&(b=c);e.event("afterEffect",{layer:n,name:a,params:b});!1!==b.store&&
h.push([n,a,b]);return e};return e}}})("tgen");((f)=>{f=window[f];f.colormap("blackwhite",()=>[{percent:0,rgba:[0,0,0,255]},{percent:25,rgba:[255,255,255,255]},{percent:50,rgba:[0,0,0,255]},{percent:75,rgba:[255,255,255,255]},{percent:100,rgba:[0,0,0,255]}]);f.colormap("dawn",()=>[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,128,255]},{percent:75,rgba:[128,0,128,255]},{percent:100,rgba:[0,0,128,255]}]);f.colormap("dusk",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,128,255,255]},
{percent:50,rgba:[128,0,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]);f.colormap("kryptonite",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,0,255]},{percent:75,rgba:[0,128,0,255]},{percent:100,rgba:[0,0,0,255]}]);f.colormap("ice",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[128,255,255,255]},{percent:50,rgba:[0,128,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]);f.colormap("fire",
()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,0,255]},{percent:75,rgba:[128,0,0,255]},{percent:100,rgba:[0,0,0,255]}]);f.colormap("redblue",()=>[{percent:0,rgba:[96,0,0,255]},{percent:25,rgba:[192,0,0,255]},{percent:50,rgba:[255,255,255,255]},{percent:75,rgba:[0,0,192,255]},{percent:100,rgba:[0,0,96,255]}]);f.colormap("seashore",()=>[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,128,255]},{percent:75,
rgba:[0,128,128,255]},{percent:100,rgba:[0,0,128,255]}])})("tgen");((f)=>{f=window[f];f.blend("opacity",(c,a,b)=>b);f.blend("multiply",(c,a,b)=>{b[0]=a[0]*b[0]/255;b[1]=a[1]*b[1]/255;b[2]=a[2]*b[2]/255;return b});f.blend("difference",(c,a,b)=>{b[0]=Math.abs(b[0]-a[0]);b[1]=Math.abs(b[1]-a[1]);b[2]=Math.abs(b[2]-a[2]);return b});f.blend("screen",(c,a,b)=>{b[0]=255-(255-a[0])*(255-b[0])/255;b[1]=255-(255-a[1])*(255-b[1])/255;b[2]=255-(255-a[2])*(255-b[2])/255;return b});f.blend("overlay",(c,a,b)=>{b[0]=128<a[0]?255-2*(255-b[0])*(255-a[0])/255:a[0]*b[0]*2/255;b[1]=
128<a[1]?255-2*(255-b[1])*(255-a[1])/255:a[1]*b[1]*2/255;b[2]=128<a[2]?255-2*(255-b[2])*(255-a[2])/255:a[2]*b[2]*2/255;return b});f.blend("exclusion",(c,a,b)=>{b[0]=128-2*(a[0]-128)*(b[0]-128)/255;b[1]=128-2*(a[1]-128)*(b[1]-128)/255;b[2]=128-2*(a[2]-128)*(b[2]-128)/255;return b});f.blend("darken",(c,a,b)=>{b[0]=b[0]<a[0]?b[0]:a[0];b[1]=b[1]<a[1]?b[1]:a[1];b[2]=b[2]<a[2]?b[2]:a[2];return b});f.blend("lighten",(c,a,b)=>{b[0]=b[0]>a[0]?b[0]:a[0];b[1]=b[1]>a[1]?b[1]:a[1];b[2]=b[2]>a[2]?b[2]:a[2];return b});
f.blend("lineardodge",(c,a,b)=>{b[0]=a[0]+b[0];b[1]=a[1]+b[1];b[2]=a[2]+b[2];return b});f.blend("linearlight",(c,a,b)=>{b[0]=a[0]+2*b[0]-255;b[1]=a[1]+2*b[1]-255;b[2]=a[2]+2*b[2]-255;return b});f.blend("linearburn",(c,a,b)=>{b[0]=a[0]+b[0]-255;b[1]=a[1]+b[1]-255;b[2]=a[2]+b[2]-255;return b});f.blend("softlight",(c,a,b)=>{b[0]=128<a[0]?255-(255-a[0])*(255-(b[0]-128))/255:a[0]*(b[0]+128)/255;b[1]=128<a[1]?255-(255-a[1])*(255-(b[1]-128))/255:a[1]*(b[1]+128)/255;b[2]=128<a[2]?255-(255-a[2])*(255-(b[2]-
128))/255:a[2]*(b[2]+128)/255;return b})})("tgen");((f)=>{f=window[f];f.effect("fill",{blend:"",rgba:[128,128,128,255]},(c,a)=>{c.shape.rect(c,1,1,c.texture.width,c.texture.height);return a});f.effect("copy",{layer:null},(c,a)=>{"number"==typeof a&&(a={layer:a});null===a.layer&&(a.layer=c.layers.length-1);void 0!=c.layers[a.layer]&&(c.texture.data=c.layerCopy(a.layer));return a});f.effect("merge",{blend:"opacity",layer:0,opacity:null},function(c,a){if(void 0===c.layers[a.layer])return this;for(var b=c.layers[a.layer],d=0;d<c.texture.height;d++)for(var h=
0;h<c.texture.width;h++){var g=c.texture.offset(h,d);c.point.rgba=[b[g],b[g+1],b[g+2],a.opacity?a.opacity:b[g+3]];c.point.set(h,d)}return a});f.effect("noise",{blend:"softlight",mode:"monochrome",opacity:128},(c,a)=>{"color"==a.mode?c.walk((b)=>b=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),a.opacity]):c.walk((b)=>{b=c.randInt(0,255);return b=[b,b,b,a.opacity]});return a});f.effect("spheres",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,70],seed:[1,262140]},(c,
a)=>{a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.sphere(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});f.effect("pyramids",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[21,100],seed:[1,262140]},(c,a)=>{a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.pyramid(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),
c.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});f.effect("squares",{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50],seed:[1,262140]},(c,a)=>{a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.rect(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),c.percentXY(d.size),!1)}return a});f.effect("circles",{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15],seed:[1,262140]},(c,a)=>{a.seed=c.randByArray(a.seed);
c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.circle(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),!0)}return a});f.effect("lines",{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},(c,a)=>{a.freq1s=c.randByArray(a.freq1s,!0);a.freq1c=c.randByArray(a.freq1c,!0);a.freq2s=c.randByArray(a.freq2s,!0);a.freq2c=c.randByArray(a.freq2c,!0);a.size=c.randByArray(a.size);for(var b=0;b<a.count;b++){var d=
c.texture.width/2+Math.sin(b/a.freq1s*c.calc.pi)*a.size,h=c.texture.height/2+Math.cos(b/a.freq1c*c.calc.pi)*a.size,g=c.texture.width/2+Math.sin(b/a.freq2s*c.calc.pi)*a.size,f=c.texture.height/2+Math.cos(b/a.freq2c*c.calc.pi)*a.size;c.shape.line(c,d,h,g,f)}return a});f.effect("lines2",{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,11],count:[4,21],seed:[1,262140]},(c,a)=>{var b=null;a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var d=0;d<a.count;d++)b=void 0!=
a.elements?a.elements[d]:{size:c.randByArraySeed(a.size,!0),d:c.randRealSeed(.1,100)},"vertical"==a.type?c.shape.rect(c,c.percentX(b.d),0,c.percentX(b.size),c.texture.height):c.shape.rect(c,0,c.percentX(b.d),c.texture.width,c.percentX(b.size));return a});f.effect("subplasma",{seed:[1,262140],size:[3,4],rgba:"random"},(c,a)=>{a.seed=c.randByArray(a.seed);a.size=c.randByArray(a.size);c.calc.randomseed(a.seed);var b=1<<a.size,d=c.texture.width,h=[],g,f;b>d&&(b=d);var l=d/b;for(f=0;f<b;f++)for(g=0;g<
b;g++)h[g*l+f*l*d]=c.calc.randomseed();for(f=0;f<b;f++)for(g=0;g<d;g++){var e=g&~(l-1),k=f*l*d;h[g+k]=c.calc.interpolate.catmullrom(h[(e-1*l&d-1)+k],h[(e-0*l&d-1)+k],h[(e+1*l&d-1)+k],h[(e+2*l&d-1)+k],g%l,l)}for(f=0;f<d;f++)for(g=0;g<d;g++)e=f&~(l-1),h[g+f*d]=c.calc.interpolate.catmullrom(h[g+(e-1*l&d-1)*d],h[g+(e-0*l&d-1)*d],h[g+(e+1*l&d-1)*d],h[g+(e+2*l&d-1)*d],f%l,l);for(g=0;g<c.texture.width;g++)for(f=0;f<c.texture.height;f++)b=255*h[g+f*d],c.point.rgba=c.point.colorize(a.rgba,[b,b,b,255]),c.point.set(g,
f);return a});f.effect("waves",{blend:"opacity",rgba:"random",level:50,xsines:[1,10],ysines:[1,10]},(c,a)=>{void 0===a.xsines?a.xsines=c.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=c.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=c.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=c.randInt(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=c.rgba([[0,255],[0,255],[0,255],void 0!==a.opacity?a.opacity:255]));for(var b=0;b<c.texture.width;b++)for(var d=0;d<c.texture.height;d++){var h=
127+63.5*Math.sin(b/c.texture.width*a.xsines*2*c.calc.pi)+63.5*Math.sin(d/c.texture.height*a.ysines*2*c.calc.pi);c.point.rgba="object"==typeof a.channels?[a.channels[0]?h:0,a.channels[1]?h:0,a.channels[2]?h:0,a.channels[3]?h:0]:c.point.colorize([h,h,h,255],a.rgba,a.level);c.point.set(b,d)}return a});f.effect("crosshatch",{blend:"random",level:50},(c,a)=>{void 0==a.xadjust&&(a.xadjust=c.randInt(1,10));void 0===a.yadjust&&(a.yadjust=c.randInt(1,10));void 0===a.rgba&&(a.rgba=[c.randInt(0,255),c.randInt(0,
255),c.randInt(0,255),255]);for(var b=0;b<c.texture.width;b++)for(var d=0;d<c.texture.height;d++){var h=127+63.5*Math.sin(b*b/a.xadjust)+63.5*Math.cos(d*d/a.yadjust);c.point.rgba=c.point.colorize([h,h,h,255],a.rgba,a.level);c.point.set(b,d)}return a});f.effect("map",{xamount:[5,255],yamount:[5,255],xchannel:[0,2],ychannel:[0,2],xlayer:0,ylayer:0},(c,a)=>{a.xamount=c.randByArray(a.xamount);a.yamount=c.randByArray(a.yamount);a.xchannel=c.randByArray(a.xchannel);a.ychannel=c.randByArray(a.ychannel);
a.xlayer=c.randByArray(a.xlayer);a.ylayer=c.randByArray(a.ylayer);for(var b=new c.buffer,d=c.texture.width,h=c.texture.height,g=c.layers[a.xlayer],f=c.layers[a.ylayer],l=0;l<d;l++)for(var e=0;e<h;e++){var k=c.texture.offset(l,e),m=g[k+a.xchannel],p=f[k+a.ychannel],m=0==d%16?c.wrapx(l+(m*a.xamount*d>>16)):l+m*a.xamount*d/(d*d),p=0==h%16?c.wrapy(e+(p*a.yamount*h>>16)):e+p*a.yamount*h/(h*h),p=c.point.get(m,p);b.data[k]=p[0];b.data[k+1]=p[1];b.data[k+2]=p[2];b.data[k+3]=p[3]}for(d=c.texture.size();d--;)c.texture.data[d]=
b.data[d];return a});f.effect("clouds",{blend:"opacity",rgba:"random",seed:[1,262140],roughness:[2,16],colormap:null},(c,a)=>{a.seed=c.randByArray(a.seed);a.roughness=c.randByArray(a.roughness);var b=c.texture.width,d=c.texture.height,h=[],g=(a,c,e)=>{0>a&&(a=b+a);a>=b&&(a-=b);0>c&&(c=d+c);c>=d&&(c-=d);return void 0!==e?h[a][c]=e:h[a][c]},f=(d)=>(c.calc.randomseed()-.5)*(d/(b+b))*a.roughness,l=(e)=>{var h=e/2;if(1>=h)return a;for(var k=h-h;k<=b+h;k+=h)for(var m=h-h;m<=d+h;m+=h){var r=g(k-h,m-h),y=
g(k,m-h),z=g(k-h,m),u=g(k,m),w=k-h/2,x=m-h/2,u=g(w,x,c.calc.normalize1((r+y+z+u)/4+f(e)));g(k-h,x,c.calc.normalize1((r+z+u+g(k-e+h/2,x))/4+f(e)));g(w,m-h,c.calc.normalize1((r+y+u+g(w,m-e+h/2))/4+f(e)))}l(h)};c.calc.randomseed(a.seed);(()=>{for(var a=0;a<=b;a++){h[a]=[];for(var c=0;c<=d;c++)h[a][c]=0}})();l(b);c.colormap.init(a.colormap,255,(b)=>{a.colormap=b});for(var e=0;e<b;e++)for(var k=0;k<d;k++){var m=parseInt(255*h[e][k],10);c.point.rgba=null!==c.colormap.data?c.colormap.get(m,a.rgba):c.point.colorize(a.rgba,
[m,m,m,255]);c.point.set(e,k)}return a});f.effect("colorbar",{type:"horizontal",mirror:!1,colormap:[{percent:0,rgba:[[0,255],[0,255],[0,255],255]},{percent:25,rgba:[[0,255],[0,255],[0,255],255]},{percent:50,rgba:[[0,255],[0,255],[0,255],255]},{percent:75,rgba:[[0,255],[0,255],[0,255],255]},{percent:100,rgba:[[0,255],[0,255],[0,255],255]}]},(c,a)=>{var b=c.texture.width,d=c.texture.height;c.colormap.init(a.colormap,"horizontal"==a.type?b:d,(b)=>{a.colormap=b});if("horizontal"==a.type)for(var h=0;h<
b;h++){if(a.mirror)var g=h<b/2?2*h:2*b-2*h;c.point.rgba=c.colormap.get(g);for(var f=0;f<d;f++)c.point.set(h,f)}else for(f=0;f<d;f++)for(a.mirror&&(g=f<d/2?2*f:2*d-2*f),c.point.rgba=c.colormap.get(g),h=0;h<b;h++)c.point.set(h,f);return a});f.effect("checkerboard",{size:[8,8],rgba:"randomalpha"},(c,a)=>{var b=c.texture.width,d=c.texture.height;if("object"==typeof a.size)var h=a.size[0]=c.randByArray(a.size[0]),g=a.size[1]=c.randByArray(a.size[1]);else g=h=a.size;for(var f=b/h,l=d/g,e=(a,e)=>{for(var h=
0;h<f;h++)for(var g=0;g<l;g++)h+a<b&&g+e<d&&c.point.set(h+a,g+e)},k=0;k<h;k++)if(0==k%2)for(var m=0;m<g;m++)0==m%2?e(k*f,m*l):e(k*f+f,m*l);return a})})("tgen");((f)=>{f=window[f];f.effect("opacity",{adjust:128},(c,a)=>{c.walk((b)=>{b[3]=a.adjust;return b});return a});f.effect("vibrance",{adjust:50},(c,a)=>{var b=-1*a.adjust;c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3,g=Math.max(a[0],a[1],a[2]),c=2*Math.abs(g-c)/255*b/100;a[0]!==g&&(a[0]+=(g-a[0])*c);a[1]!==g&&(a[1]+=(g-a[1])*c);a[2]!==g&&(a[2]+=(g-a[2])*c);return[a[0],a[1],a[2],a[3]]});return a});f.effect("brightness",{adjust:50,legacy:!0},(c,a)=>{!0===a.legacy?c.walk((b)=>[Math.min(b[0]+a.adjust,255),Math.min(b[1]+
a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]]):c.walk((b)=>[b[0]=Math.min(255/b[0]*(a.adjust/255),255),b[1]=Math.min(255/b[1]*(a.adjust/255),255),b[2]=Math.min(255/b[2]*(a.adjust/255),255),b[3]]);return a});f.effect("contrast",{adjust:50},(c,a)=>{var b=(100+a.adjust)/100;c.walk((a)=>{a[0]=255*((a[0]/255-.5)*b+.5);a[1]=255*((a[1]/255-.5)*b+.5);a[2]=255*((a[2]/255-.5)*b+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),Math.max(Math.min(a[2],255),0),a[3]]});return a});f.effect("threshold",
{adjust:128},(c,a)=>{c.walk((b)=>{b=.2126*b[0]+.7152*b[1]+.0722*b[2]<=a.adjust?0:255;return[b,b,b,1]});return a});f.effect("gamma",{adjust:.5},(c,a)=>{c.walk((b)=>{b[0]=255*Math.pow(b[0]/255,1/a.adjust);b[1]=255*Math.pow(b[1]/255,1/a.adjust);b[2]=255*Math.pow(b[2]/255,1/a.adjust);return[b[0],b[1],b[2],b[3]]});return a});f.effect("grayscale",{method:["ligthness","average","luminosity"]},(c,a)=>{"string"==typeof a&&(a={method:a});"object"==typeof a.method&&(a.method=c.randItem(a.method));switch(a.method){case "ligthness":c.walk((a)=>
{var c=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[c,c,c,a[3]]});break;case "average":c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3;return[c,c,c,a[3]]});break;case "luminosity":c.walk((a)=>{var d=c.calc.luminance(a);return[d,d,d,a[3]]})}return a});f.effect("colorize",{level:50,rgba:"random",colormap:null},(c,a)=>{c.colormap.init(a.colormap,255,(b)=>{a.colormap=b});c.walk((b)=>{if(c.colormap.data){var d=c.colormap.get((b[0]+b[1]+b[2])/3,a.rgba);d[3]=b[3];return d}return c.point.colorize(b,a.rgba,
a.level)});return a});f.effect("invert",{channels:[1,1,1]},(c,a)=>{c.walk((b)=>[a.channels[0]?255-b[0]:b[0],a.channels[1]?255-b[1]:b[1],a.channels[2]?255-b[2]:b[2],b[3]]);return a});f.effect("sobel",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,1,-2,0,2,-1,0,1]});return a});f.effect("emboss",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});return a});f.effect("edgedetect",
{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,0]});return a});f.effect("sharpen",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,-1,-1,-1,-1]});return a});f.effect("blur",{},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});return a});f.effect("sinecolor",{sines:[1,7],channel:[0,2]},(c,a)=>{a.sines=c.randByArray(a.sines);
a.channel=c.randByArray(a.channel);c.walk((b)=>{var d=parseInt(255*Math.sin(c.calc.pi/180*b[a.channel]*(255/360)*a.sines));b[a.channel]=Math.abs(d);return b});return a});f.effect("convolute",{blend:"opacity",transparent:!1,weights:[1,1,1,1,1,1,1,1,1]},(c,a)=>{if("object"!=typeof a.weights||null==a.weights)return a;var b=new c.buffer;b.clear();for(var d=Math.round(Math.sqrt(a.weights.length)),h=Math.floor(d/2),g=a.transparent?1:0,f=0;f<c.texture.height;f++)for(var l=0;l<c.texture.width;l++){for(var e=
0,k=0,m=0,p=0,q=0;q<d;q++)for(var t=0;t<d;t++)var v=a.weights[q*d+t],r=c.texture.get(l+t-h,f+q-h),e=e+r[0]*v,k=k+r[1]*v,m=m+r[2]*v,p=p+r[3];b.set(l,f,[e,k,m,p+g*(255-p)])}for(d=c.texture.size();d--;)c.texture.data[d]=b.data[d];return a})})("tgen");((f)=>{f=window[f];f.shape("rect",(c,a,b,d,h,f)=>{void 0!==f&&(a-=parseInt(d/2,10),b-=parseInt(h/2,10));for(f=0;f<d;f++)for(var n=0;n<h;n++)c.point.set(a+f,b+n)});f.shape("circle",(c,a,b,d,f)=>{void 0==f&&(a+=d,b+=d);for(f=-d;f<d;f++)for(var g=parseInt(Math.sqrt(d*d-f*f),10),n=-g;n<g;n++)c.point.set(a+f,b+n)});f.shape("line",(c,a,b,d,f)=>{var g=Math.sqrt((d-a)*(d-a)+(f-b)*(f-b));d=(d-a)/g;f=(f-b)/g;for(var n=0,l=0,e=0;e<g;e++)n=a+d*e,l=b+f*e,c.point.set(n,l)});f.shape("sphere",(c,a,b,d,f,g,n)=>{void 0==
f&&(a+=d,b+=d);for(f=-d;f<d;f++)for(var l=parseInt(Math.sqrt(d*d-f*f),10),e=-l;e<l;e++){var k=Math.min(255,Math.max(0,255-255*Math.sqrt(e*e+f*f)/(d/2)))/255;0<k&&(c.point.rgba=[g[0]*k,g[1]*k,g[2]*k,n?255*k:g[3]],c.point.set(a+f,b+e))}});f.shape("pyramid",(c,a,b,d,f,g,n,l)=>{var e=parseInt(d/2,10),k=parseInt(f/2,10);1!=g&&(a+=e,b+=k);for(g=-e;g<e;g++)for(var m=-k;m<k;m++){var p=255*(.25-Math.abs(g/d)),q=255*(.25-Math.abs(m/f)),p=p+q;1<p&&(c.point.rgba=[n[0]/255*p,n[1]/255*p,n[2]/255*p,l?p:n[3]],c.point.set(a+
g,b+m))}})})("tgen");
