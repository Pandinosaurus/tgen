var tgen=function(g,h){var e={},u=[],D=[],C={},y=0,z=[],B=null;e.blends="opacity multiply screen overlay difference exclusion darken lighten lineardodge linearlight linearburn softlight".split(" ");var J=function(){void 0==g&&(g=256);1>g&&(g=256);1>h&&(h=256);1024<g&&(g=1024);1024<h&&(h=1024);void 0==h&&(h=g);B=(g+h)/2};J();var K=function(){q.clear();u=[];D=[];y=0;C.start=(new Date).getTime()};e.buffer=function(a,b,c){this.data=null;this.size=a?a:4;this.width=b?b:g;this.height=c?c:h;this.pixels=function(){return this.width*
this.height*this.size};this.clear=function(){this.data=new Float32Array(this.width*this.height*this.size)};this.pattern=function(a,b){var c=a/b;if(a>=b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,c=b-Math.abs(a-c),c>=b&&(c-=b),c};this.offset=function(a,b){a=parseInt(a);b=parseInt(b);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.size+a*this.size};this.set=function(a,b,c){a=this.offset(a,b);for(b=0;b<
this.size;b++)this.data[a+b]=c[b]};this.get=function(a,b){for(var c=this.offset(a,b),g=[],h=0;h<this.size;h++)g[h]=this.data[c+h];return g};this.canvas=function(a){var b=this.pixels();for(a=a.getContext("2d").getImageData(0,0,this.width,this.height).data;b--;)q.data[b]=a[b]};this.opacity=function(a){void 0===a&&(a=.5);for(var b=this.pixels(),c=0;c<b;c+=this.size)q.data[c]=a;return this};null===this.data&&this.clear()};var q=new e.buffer;K();var L=function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=
b[d];return c},l=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},H=function(a,b){return Math.random()*(b-a)+a},t=function(a,b){"object"==typeof a&&(a=void 0!=b?H(a[0],a[1]):l(a[0],a[1]));return a},M=function(a){var b=l(0,a.length-1);return a[b]};e.defaults={fill:{blend:"opacity",rgba:[128,128,228,1]},merge:{blend:"opacity",opacity:.5},noise:{blend:"random",mode:"monochrome",opacity:.5},colorize:{level:50,rgb:"random"},vibrance:{adjust:50},contrast:{adjust:50},gamma:{adjust:.5},threshold:{threshold:96},
invert:{},brightness:{adjust:50,legacy:!0},convolute:{blend:"opacity",transparent:!1,weights:null},emboss:{type:1},blur:{type:1},sharpen:{type:1},edgedetect:{type:1},sobel:{type:1},waves:{blend:"random",level:50},crosshatch:{blend:"random",level:50},circles:{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15]},spheres:{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,70]},pyramids:{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[21,
100]},squares:{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50]},map:{xamount:[5,255],yamount:[5,255],xchannel:[0,3],ychannel:[0,3],xlayer:0,ylayer:0},lines:{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},lines2:{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,11],count:[4,21]},clouds:{blend:"opacity",rgba:"random",seed:[1,65535],roughness:[2,16]},subplasma:{seed:[1,65535],
size:[3,4],rgba:"random"},sinecolor:{sines:[1,7],channel:[0,2]}};var I=function(a){"random"===a&&(a=!0,void 0===a&&(a=1),!0===a&&(a=.5+Math.random()/2),a=[l(0,255),l(0,255),l(0,255),a]);"object"==typeof a[0]&&(a[0]=l(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=l(a[1][0],a[1][1]));"object"==typeof a[2]&&(a[2]=l(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=H(a[3][0],a[3][1]));return a},p=function(a,b,c){b=void 0===b?L({},e.defaults[a]):L(e.defaults[a],b);void 0!==c&&(b=c(b));"object"==typeof b.count&&
(b.count=l(b.count[0],b.count[1]));"random"===b.blend&&(b.blend=M(e.blends));"object"==typeof b.blend&&(b.blend=b.blend[l(0,b.blend.length-1)]);k.blend=void 0!==b.blend?b.blend:"";b.rgba&&(b.rgba=I(b.rgba),k.rgba=[b.rgba[0],b.rgba[1],b.rgba[2],b.rgba[3]]);b.rgb&&(b.rgb=I(b.rgb),k.rgba=[b.rgb[0],b.rgb[1],b.rgb[2],1]);return b},n=function(a,b){D.push([y,a,b]);console.log(y,a,b)},m={rect:function(a,b,c,d,f){void 0!==f&&(a-=parseInt(c/2),b-=parseInt(d/2));for(f=0;f<c;f++)for(var g=0;g<d;g++)k.set(a+f,
b+g)},circle:function(a,b,c,d){void 0==d&&(a+=c,b+=c);for(d=-c;d<c;d++)for(var f=parseInt(Math.sqrt(c*c-d*d)),g=-f;g<f;g++)k.set(a+d,b+g)},line:function(a,b,c,d){var f=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b));c=(c-a)/f;d=(d-b)/f;for(var g=0,h=0,e=0;e<f;e++)g=a+c*e,h=b+d*e,k.set(g,h)},sphere:function(a,b,c,d,f,g){void 0==d&&(a+=c,b+=c);for(d=-c;d<c;d++)for(var h=parseInt(Math.sqrt(c*c-d*d)),e=-h;e<h;e++){var w=Math.min(255,Math.max(0,255-255*Math.sqrt(e*e+d*d)/(c/2)));0<w&&(k.rgba=[f[0]/255*w,f[1]/255*w,
f[2]/255*w,g?w/255:f[3]],k.set(a+d,b+e))}},pyramid:function(a,b,c,d,f,g,h){var e=parseInt(c/2),w=parseInt(d/2);1!=f&&(a+=e,b+=w);for(f=-e;f<e;f++)for(var A=-w;A<w;A++){var n=255*(.25-Math.abs(f/c)),p=255*(.25-Math.abs(A/d)),n=n+p,p=h?n/255:g[3];0<n&&(k.rgba=[g[0]/255*n,g[1]/255*n,g[2]/255*n,p],k.set(a+f,b+A))}}},r={pi:3.1415927,luminance:function(a){return.21*a[0]+.72*a[1]+.07*a[2]},randomseed:function(a){void 0==this.seed&&(this.seed=l(1,65535));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);
return a-Math.floor(a)},normalize1:function(a){return r.normalize(a,0,1)},normalize255:function(a){return r.normalize(a,0,255)},normalize:function(a,b,c){return a>c?c:a<b?b:a},interpolate:{linear:function(a,b,c){return a*(1-c)+b*c},cosine:function(a,b,c){c=.5*(1-Math.cos(c*r.pi));return a*(1-c)+b*c},catmullrom:function(a,b,c,d,f,g){f/=g;d=d-c-(a-b);a=d*f*f*f+(a-b-d)*f*f+(c-a)*f+b;0>a&&(a=0);1<a&&(a=1);return a}}},k={rgba:[0,0,0,1],mixed:[0,0,0,1],blend:"opacity",normalize:function(a){a[0]=Math.round(a[0]);
a[1]=Math.round(a[1]);a[2]=Math.round(a[2]);return a},colorize:function(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:.5]},opacity:function(a,b){1<a[3]&&(a[3]/=255);return 1==a[3]?[a[0],a[1],a[2],a[3]]:[a[0]*a[3]+b[0]*(1-a[3]),a[1]*a[3]+b[1]*(1-a[3]),a[2]*a[3]+b[2]*(1-a[3]),a[3]]},calc:function(a,b){switch(this.blend){case "opacity":var c=this.opacity(a,b);break;case "multiply":a[0]=b[0]*a[0]/255;a[1]=b[1]*a[1]/255;a[2]=b[2]*a[2]/255;
c=this.opacity(a,b);break;case "screen":a[0]=255-(255-b[0])*(255-a[0])/255;a[1]=255-(255-b[1])*(255-a[1])/255;a[2]=255-(255-b[2])*(255-a[2])/255;c=this.opacity(a,b);break;case "overlay":a[0]=128<b[0]?255-2*(255-a[0])*(255-b[0])/255:b[0]*a[0]*2/255;a[1]=128<b[1]?255-2*(255-a[1])*(255-b[1])/255:b[1]*a[1]*2/255;a[2]=128<b[2]?255-2*(255-a[2])*(255-b[2])/255:b[2]*a[2]*2/255;c=this.opacity(a,b);break;case "difference":a[0]=Math.abs(a[0]-b[0]);a[1]=Math.abs(a[1]-b[1]);a[2]=Math.abs(a[2]-b[2]);c=this.opacity(a,
b);break;case "exclusion":a[0]=128-2*(b[0]-128)*(a[0]-128)/255;a[1]=128-2*(b[1]-128)*(a[1]-128)/255;a[2]=128-2*(b[2]-128)*(a[2]-128)/255;c=this.opacity(a,b);break;case "darken":a[0]=a[0]<b[0]?a[0]:b[0];a[1]=a[1]<b[1]?a[1]:b[1];a[2]=a[2]<b[2]?a[2]:b[2];c=this.opacity(a,b);break;case "lighten":a[0]=a[0]>b[0]?a[0]:b[0];a[1]=a[1]>b[1]?a[1]:b[1];a[2]=a[2]>b[2]?a[2]:b[2];c=this.opacity(a,b);break;case "lineardodge":a[0]=b[0]+a[0];a[1]=b[1]+a[1];a[2]=b[2]+a[2];c=this.opacity(a,b);break;case "linearlight":a[0]=
b[0]+2*a[0]-255;a[1]=b[1]+2*a[1]-255;a[2]=b[2]+2*a[2]-255;c=this.opacity(a,b);break;case "linearburn":a[0]=b[0]+a[0]-255;a[1]=b[1]+a[1]-255;a[2]=b[2]+a[2]-255;c=this.opacity(a,b);break;case "softlight":a[0]=128<b[0]?255-(255-b[0])*(255-(a[0]-128))/255:b[0]*(a[0]+128)/255;a[1]=128<b[1]?255-(255-b[1])*(255-(a[1]-128))/255:b[1]*(a[1]+128)/255;a[2]=128<b[2]?255-(255-b[2])*(255-(a[2]-128))/255:b[2]*(a[2]+128)/255;c=this.opacity(a,b);break;default:c=[a[0],a[1],a[2],a[3]]}return c},set:function(a,b){this.mixed=
this.calc(this.rgba,this.get(a,b));q.set(a,b,this.mixed)},get:function(a,b){return q.get(a,b)}},x=function(a){for(var b=0;b<g;b++)for(var c=0;c<h;c++){var d=k.get(b,c),d=a(d,b,c);k.rgba=d;k.set(b,c)}},F=function(a,b){if(void 0!=b.elements)var c=b.elements[a].x,d=b.elements[a].y,f=b.elements[a].size;else"random"==b.origin?(c=l(0,g),d=l(0,h)):(c=b.origin[0],d=b.origin[1]),f=t(b.size);return{x:c,y:d,size:f}};e.merge=function(a){a=p("merge",a);if(void 0===u[a.layer])return this;for(var b=u[a.layer].getContext("2d").getImageData(0,
0,g,h).data,c=0;c<h;c++)for(var d=0;d<g;d++){var f=q.offset(d,c);k.rgba=[b[f],b[f+1],b[f+2],b[f+3]];k.rgba[3]=1<k.rgba[3]?k.rgba[3]/255:k.rgba[3];k.set(d,c)}n("merge",a);return this};e.copy=function(a){for(var b=q.pixels(),c=u[a].getContext("2d").getImageData(0,0,g,h).data;b--;)q.data[b]=c[b];n("copy",a);return this};e.brightness=function(a){a=p("brightness",a);k.blend="";x(function(b){if(!0===a.legacy)return[Math.min(b[0]+a.adjust,255),Math.min(b[1]+a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]];
a.adjust=Math.pow((a.adjust+100)/100,2);return[255*((b[0]/255-.5)*a.adjust+.5),255*((b[1]/255-.5)*a.adjust+.5),255*((b[2]/255-.5)*a.adjust+.5),b[3]]});n("brightness",a);return this};e.contrast=function(a){a=p("contrast",a);var b=(100+a.adjust)/100;k.blend="";x(function(a){a[0]=255*((a[0]/255-.5)*b+.5);a[1]=255*((a[1]/255-.5)*b+.5);a[2]=255*((a[2]/255-.5)*b+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),Math.max(Math.min(a[2],255),0),a[3]]});n("contrast",a);return this};e.gamma=
function(a){a=p("gamma",a);var b=a.adjust;x(function(a){a[0]=255*Math.pow(a[0]/255,1/b);a[1]=255*Math.pow(a[1]/255,1/b);a[2]=255*Math.pow(a[2]/255,1/b);return[a[0],a[1],a[2],a[3]]});n("gamma",a);return this};e.grayscale=function(a){a||(a="average");k.blend="";switch(a){case "ligthness":x(function(a){var c=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[c,c,c,a[3]]});break;case "average":x(function(a){var c=(a[0]+a[1]+a[2])/3;return[c,c,c,a[3]]});break;case "luminosity":x(function(a){var c=
r.luminance(a);return[c,c,c,a[3]]})}n("grayscale",a);return this};e.colorize=function(a){a=p("colorize",a);k.blend="";x(function(b){return k.colorize(b,a.rgb,a.level)});n("colorize",a);return this};e.invert=function(){params=p("invert",{});k.blend="";x(function(a){return[255-a[0],255-a[1],255-a[2],a[3]]});n("invert",params);return this};e.threshold=function(a){params=p("threshold",{},function(b){void 0!==a&&(b.threshold=a);return b});k.blend="";x(function(a){a=.2126*a[0]+.7152*a[1]+.0722*a[2]<=params.threshold?
0:255;return[a,a,a,1]});n("threshold",params);return this};e.vibrance=function(a){a=p("vibrance",a);var b=-1*a.adjust;k.blend="";x(function(a){var d=(a[0]+a[1]+a[2])/3,f=Math.max(a[0],a[1],a[2]),d=2*Math.abs(f-d)/255*b/100;a[0]!==f&&(a[0]+=(f-a[0])*d);a[1]!==f&&(a[1]+=(f-a[1])*d);a[2]!==f&&(a[2]+=(f-a[2])*d);return[a[0],a[1],a[2],a[3]]});n("vibrance",a);return this};e.sharpen=function(a){a=p("sharpen",a);e.convolute({store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,
-1,-1,-1,-1]});n("sharpen",a);return this};e.blur=function(a){a=p("blur",a);e.convolute({store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});n("blur",a);return this};e.emboss=function(a){a=p("emboss",a);e.convolute({store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});n("emboss",a);return this};e.edgedetect=function(a){a=p("edgedetect",a);e.convolute({store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,
0]});n("edgedetect",a);return this};e.sobel=function(a){a=p("sobel",a);e.convolute({store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,1,-2,0,2,-1,0,1]});n("sobel",a);return this};e.convolute=function(a){a=p("convolute",a);if("object"!=typeof a.weights)return this;var b=new e.buffer;b.clear();for(var c=Math.round(Math.sqrt(a.weights.length)),d=Math.floor(c/2),f=a.transparent?1:0,k=0;k<h;k++)for(var v=0;v<g;v++){for(var G=0,w=0,A=0,l=0,m=0;m<c;m++)for(var r=0;r<c;r++)var t=a.weights[m*
c+r],u=q.get(v+r-d,k+m-d),G=G+u[0]*t,w=w+u[1]*t,A=A+u[2]*t,l=l+u[3]*t;b.set(v,k,[G,w,A,l+f*(255-l)])}for(c=q.pixels();c--;)q.data[c]=b.data[c];!1!==a.store&&n("convolute",a);return this};e.waves=function(a){a=p("waves",a,function(a){void 0===a.xsines?a.xsines=l(1,10):"object"==typeof a.xsines&&(a.xsines=l(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=l(1,10):"object"==typeof a.ysines&&(a.ysines=l(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=I([[0,255],[0,255],[0,255],void 0!==a.opacity?
a.opacity:1]));return a});for(var b=0;b<g;b++)for(var c=0;c<h;c++){var d=127+63.5*Math.sin(b/g*a.xsines*2*r.pi)+63.5*Math.sin(c/h*a.ysines*2*r.pi);k.rgba="object"==typeof a.channels?[a.channels[0]?d:0,a.channels[1]?d:0,a.channels[2]?d:0,a.channels[3]?d:0]:k.colorize([d,d,d,1],a.rgba,a.level);k.set(b,c)}n("waves",a);return this};e.spheres=function(a){a=p("spheres",a);for(var b=[],c=0;c<a.count;c++){var d=F(c,a);m.sphere(parseInt(d.x/100*g),parseInt(d.y/100*h),parseInt(d.size/100*B),!0,a.rgba,a.dynamic);
b.push(d)}a.elements=b;n("spheres",a);return this};e.pyramids=function(a){a=p("pyramids",a);for(var b=[],c=0;c<a.count;c++){var d=F(c,a);m.pyramid(parseInt(d.x/100*g),parseInt(d.y/100*h),parseInt(d.size/100*B),parseInt(d.size/100*B),!0,a.rgba,a.dynamic);b.push(d)}a.elements=b;n("pyramids",a);return this};e.crosshatch=function(a){params=p("crosshatch",a,function(a){void 0==a.xadjust&&(a.xadjust=l(1,10));void 0===a.yadjust&&(a.yadjust=l(1,10));void 0===a.rgba&&(a.rgba=[l(0,255),l(0,255),l(0,255),1]);
return a});for(a=0;a<g;a++)for(var b=0;b<h;b++){var c=127+63.5*Math.sin(a*a/params.xadjust)+63.5*Math.cos(b*b/params.yadjust);k.rgba=k.colorize([c,c,c,1],params.rgba,params.level);k.set(a,b)}n("crosshatch",params);return this};e.squares=function(a){a=p("squares",a);for(var b=[],c=0;c<a.count;c++){var d=F(c,a);m.rect(parseInt(d.x/100*g),parseInt(d.y/100*h),parseInt(d.size/100*B),parseInt(d.size/100*B),!1);b.push(d)}a.elements=b;n("squares",a);return this};e.circles=function(a){a=p("circles",a);for(var b=
[],c=0;c<a.count;c++){var d=F(c,a);m.circle(parseInt(d.x/100*g),parseInt(d.y/100*h),parseInt(d.size/100*B),!0);b.push(d)}a.elements=b;n("circles",a);return this};e.lines=function(a){a=p("lines",a,function(a){a.freq1s=t(a.freq1s,!0);a.freq1c=t(a.freq1c,!0);a.freq2s=t(a.freq2s,!0);a.freq2c=t(a.freq2c,!0);a.size=t(a.size);return a});for(var b=0;b<a.count;b++){var c=g/2+Math.sin(b/a.freq1s*r.pi)*a.size,d=h/2+Math.cos(b/a.freq1c*r.pi)*a.size,f=g/2+Math.sin(b/a.freq2s*r.pi)*a.size,e=h/2+Math.cos(b/a.freq2c*
r.pi)*a.size;m.line(c,d,f,e)}n("lines",a);return this};e.lines2=function(a){a=p("lines2",a);for(var b=[],c=null,d=0;d<a.count;d++)c=void 0!=a.elements?a.elements[d]:{size:t(a.size,!0),d:H(.1,100)},"vertical"==a.type?m.rect(parseInt(c.d/100*g),0,parseInt(c.size/100*g),h):m.rect(0,parseInt(c.d/100*g),g,parseInt(c.size/100*g)),b.push(c);a.elements=b;n("lines2",a);return this};e.noise=function(a){a=p("noise",a);for(var b=0;b<g;b++)for(var c=0;c<h;c++){if("color"==a.mode)k.rgba=[l(0,255),l(0,255),l(0,
255),a.opacity];else{var d=l(0,255);k.rgba=[d,d,d,a.opacity]}k.set(b,c)}n("noise",a);return this};e.clouds=function(a){a=p("clouds",a,function(a){a.seed=t(a.seed);a.roughness=t(a.roughness);return a});var b=[],c=function(a,c,d){0>a&&(a=g+a);a>=g&&(a-=g);0>c&&(c=h+c);c>=h&&(c-=h);return void 0!==d?b[a][c]=d:b[a][c]},d=function(b){return(r.randomseed()-.5)*(b/(g+g))*a.roughness},f=function(a){var b=a/2;if(!(1>=b)){for(var e=b-b;e<=g+b;e+=b)for(var k=b-b;k<=h+b;k+=b){var n=c(e-b,k-b),v=c(e,k-b),l=c(e-
b,k),E=c(e,k),p=e-b/2,m=k-b/2,E=c(p,m,r.normalize1((n+v+l+E)/4+d(a)));c(e-b,m,r.normalize1((n+l+E+c(e-a+b/2,m))/4+d(a)));c(p,k-b,r.normalize1((n+v+E+c(p,k-a+b/2))/4+d(a)))}f(b)}};r.randomseed(a.seed);(function(){for(var a=0;a<=g;a++){b[a]=[];for(var c=0;c<=h;c++)b[a][c]=0}})();f(g);for(var e=0;e<g;e++)for(var v=0;v<h;v++){var l=256*b[e][v];k.rgba=k.colorize(a.rgba,[l,l,l,1]);k.set(e,v)}n("clouds",a);return this};e.map=function(a){a=p("map",a,function(a){a.xamount=t(a.xamount);a.yamount=t(a.yamount);
a.xchannel=t(a.xchannel);a.ychannel=t(a.ychannel);a.xlayer=t(a.xlayer);a.ylayer=t(a.ylayer);return a});for(var b=new e.buffer,c=u[a.xlayer].getContext("2d").getImageData(0,0,g,h).data,d=u[a.ylayer].getContext("2d").getImageData(0,0,g,h).data,f=0;f<g;f++)for(var l=0;l<h;l++){var v=q.offset(f,l),m=c[v+a.xchannel],r=d[v+a.ychannel],m=k.get(0==g%16?f+(m*a.xamount*g>>16)&g-1:f+m*a.xamount*g/(g*g),0==h%16?l+(r*a.yamount*h>>16)&h-1:l+r*a.yamount*h/(h*h));b.data[v]=m[0];b.data[v+1]=m[1];b.data[v+2]=m[2];
b.data[v+3]=m[3]}for(c=q.pixels();c--;)q.data[c]=b.data[c];n("map",a);return this};e.sinecolor=function(a){a=p("sinecolor",a,function(a){a.sines=t(a.sines);a.channel=t(a.channel);return a});for(var b=0;b<h;b++)for(var c=0;c<g;c++){var d=q.get(c,b),f=parseInt(255*Math.sin(r.pi/180*d[a.channel]*(255/360)*a.sines));d[a.channel]=Math.abs(f);q.set(c,b,d)}n("sinecolor",a);return this};e.subplasma=function(a){a=p("subplasma",a,function(a){a.seed=t(a.seed);a.size=t(a.size);return a});r.randomseed(a.seed);
var b=1<<a.size,c=g,d=[],f,e;b>c&&(b=c);var l=c/b;for(e=0;e<b;e++)for(f=0;f<b;f++)d[f*l+e*l*c]=r.randomseed();for(e=0;e<b;e++)for(f=0;f<c;f++){var m=f&~(l-1),q=e*l*c;d[f+q]=r.interpolate.catmullrom(d[(m-1*l&c-1)+q],d[(m-0*l&c-1)+q],d[(m+1*l&c-1)+q],d[(m+2*l&c-1)+q],f%l,l)}for(e=0;e<c;e++)for(f=0;f<c;f++)m=e&~(l-1),d[f+e*c]=r.interpolate.catmullrom(d[f+(m-1*l&c-1)*c],d[f+(m-0*l&c-1)*c],d[f+(m+1*l&c-1)*c],d[f+(m+2*l&c-1)*c],e%l,l);for(f=0;f<g;f++)for(e=0;e<h;e++)b=256*d[f+e*c],k.rgba=k.colorize(a.rgba,
[b,b,b,1]),k.set(f,e);n("subplasma",a);return this};e.test=function(){k.blend="opacity";k.rgba=[255,255,155,1];m.rect(1,1,g-2,h-2);var a=20;k.rgba=[0,150,0,.6];m.rect(2,2,a,a);m.rect(g-a-2,2,a,a);m.rect(2,h-2-a,a,a);m.rect(g-2-a,h-2-a,a,a);k.rgba=[20,20,10,.2];m.rect(g/2,h/2,178,178,!0);k.rgba=[10,20,210,.7];m.rect(g-5,h-5,10,10);a=20;k.rgba=[0,0,0,1];m.line(a,a,g-a,h-a);m.line(g-a,a,a,h-a);m.line(0,h/2,g,h/2);m.line(g/2,0,g/2,h);k.rgba=[255,55,55,.5];m.rect(10,10,g-20,h-20);k.rgba=[0,0,255,.3];m.rect(g-
2,h-2,4,4);k.rgba=[255,255,255,1];k.set(0,0);k.set(g-1,0);k.set(0,h-1);k.set(g-1,h-1);k.rgba=[25,25,0,.2];m.circle(g/4,h/4,g/4,!0);k.rgba=[255,255,0,.1];m.circle(g,h,g,!0);this.brightness(50,!0);this.vibrance(100);this.contrast(20);return this};e.fill=function(a){a=p("fill",a);m.rect(1,1,g,h);n("fill",a);return this};e.toContext=function(a){a=a.createImageData(g,h);for(var b=a.data,c=q.pixels(),d=0;d<c;d+=4)b[d]=q.data[d],b[d+1]=q.data[d+1],b[d+2]=q.data[d+2],b[d+3]=255;return a};e.toCanvas=function(){var a=
document.createElement("canvas");a.width=g;a.height=h;var b=a.getContext("2d"),c=this.toContext(b);b.putImageData(c,0,0);return a};e.getCanvas=function(a){a&&a(u[u.length-1]);return this};e.getPhases=function(a){if(a){for(var b=[],c=u.length,d=0;d<c;d++)b.push(u[d]);a(b)}return this};e.stat=function(a){C.stop=(new Date).getTime();C.elapsed=(C.stop-C.start)/1E3;a&&a(C);return this};e.history={available:function(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(a){return!1}},
list:function(){return this.available()?JSON.parse(localStorage.getItem("history"))||[]:[]},last:function(){return this.available()?z[z.length-1]:[]},get:function(a){return this.available()?z[a]?z[a]:null:[]},add:function(a){if(!this.available())return[];a=e.params(a);z=JSON.parse(localStorage.getItem("history"))||[];15<=z.length&&z.shift();z.push(a);localStorage.setItem("history",JSON.stringify(z))}};e.params=function(a){if(void 0==a){a=new Date;var b=D.length,c=u.length;a=a.getHours()+":"+a.getMinutes()+
":"+a.getSeconds()+" l"+c+" i"+b}return{name:a,version:"0.2.0",width:g,height:h,items:D}};e.render=function(a,b){var c=0;void 0!=a.width&&(g=a.width);void 0!=a.height&&(h=a.height);J();q=new e.buffer;1!=b&&K();for(var d in a.items){y=a.items[d][0];var f=a.items[d][1],k=a.items[d][2];if("random"==f){var f=e.defaults,l=void 0,m=0,n=void 0;for(n in f)Math.random()<1/++m&&(l=n);f=l}"object"==typeof f&&(f=M(f));c!=y&&(void 0!=u[y]?q.canvas(u[y]):q.clear(),c=y);switch(f){default:if(void 0==e[f])console.warn("undefined effect: "+
f);else e[f](k)}u[y]=e.toCanvas()}e.history.add();return this};return e};
