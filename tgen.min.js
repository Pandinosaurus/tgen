var tgen=function(a,d){var G="0.1";var I={};var A=[];var B=[];var D={};var f=0;var F=true;var s=15;var r="history";var u=[];var m=null;I.blends=["opacity","multiply","screen","overlay","difference","exclusion","darken","lighten","lineardodge","linearlight","linearburn","softlight"];var q=function(){if(a==undefined){a=256}if(a<1){a=256}if(d<1){d=256}if(a>1024){a=1024}if(d>1024){d=1024}if(d==undefined){d=a}m=(a+d)/2};q();var z=function(){o.clear();A=[];B=[];f=0;D.start=new Date().getTime()};I.buffer=function(L,p,M){this.data=null;this.size=L?L:4;this.width=p?p:a;this.height=M?M:d;this.pixels=function(){return this.width*this.height*this.size};this.clear=function(){this.data=new Float32Array(this.width*this.height*this.size)};this.pattern=function(R,N){var P=R/N;if(R>=N){var Q=Math.floor(P)*(N);var O=(R-Q);return O}if(R<0){var Q=Math.ceil(P)*(N);var O=N-Math.abs((R-Q));if(O>=N){var O=(O-N);return O}return O}};this.offset=function(N,O){N=parseInt(N);O=parseInt(O);if(N<0||N>=this.width){N=this.pattern(N,this.width)}if(O<0||O>=this.height){O=this.pattern(O,this.height)}return O*this.width*this.size+N*this.size};this.set=function(N,R,O){var Q=this.offset(N,R);for(var P=0;P<this.size;P++){this.data[Q+P]=O[P]}};this.get=function(N,R){var Q=this.offset(N,R);var O=[];for(var P=0;P<this.size;P++){O[P]=this.data[Q+P]}return O};this.canvas=function(N){var R=this.pixels();var O=N.getContext("2d");var P=O.getImageData(0,0,this.width,this.height);var Q=P.data;while(R--){o.data[R]=Q[R]}};this.opacity=function(N){if(N===undefined){N=0.5}var P=this.pixels();for(var O=0;O<P;O=O+this.size){o.data[O]=N}return this};if(this.data===null){this.clear()}};var o=new I.buffer();z();var K=function(N,M){var L={};for(var p in N){L[p]=N[p]}for(var p in M){L[p]=M[p]}return L};var x=function(L,p){return Math.floor(Math.random()*(p-L+1))+L};var y=function(L,p){return Math.random()*(p-L)+L};var g=function(p,L){if(typeof p=="object"){if(L!=undefined){p=y(p[0],p[1])}else{p=x(p[0],p[1])}}return p};var n=function(p){if(p===undefined){p=1}if(p===true){p=0.5+(Math.random()/2)}return[x(0,255),x(0,255),x(0,255),p]};var w=function(){return b(I.blends)};var b=function(M){var L=M.length;var p=x(0,L-1);return M[p]};var t=function(M){var p;var L=0;for(var N in M){if(Math.random()<1/++L){p=N}}return p};I.defaults={fill:{blend:"opacity",rgba:[128,128,228,1]},merge:{blend:"opacity",opacity:0.5},noise:{blend:"random",mode:"monochrome",opacity:0.5},colorize:{level:50,rgb:"random"},vibrance:{adjust:50},contrast:{adjust:50},threshold:{threshold:96},invert:{},brightness:{adjust:50,legacy:true},waves:{blend:"random",level:50},crosshatch:{blend:"random",level:50},circles:{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15]},spheres:{blend:"lighten",rgba:"random",origin:"random",dynamic:false,count:21,size:[20,70]},pyramids:{blend:"lighten",rgba:"random",origin:"random",dynamic:false,count:21,size:[21,100]},squares:{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50]},map:{xamount:[5,255],yamount:[5,255],xchannel:[0,3],ychannel:[0,3],xlayer:0,ylayer:0},lines:{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},lines2:{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[0.1,11],count:[4,21]},clouds:{blend:"opacity",rgba:"random",seed:[1,65535],roughness:[2,16]},subplasma:{seed:[1,65535],size:[3,4],rgba:"random"}};var E=function(p){if(p==="random"){p=n(true)}if(typeof p[0]=="object"){p[0]=x(p[0][0],p[0][1])}if(typeof p[1]=="object"){p[1]=x(p[1][0],p[1][1])}if(typeof p[2]=="object"){p[2]=x(p[2][0],p[2][1])}if(typeof p[3]=="object"){p[3]=y(p[3][0],p[3][1])}return p};var e=function(L,N,M){if(N===undefined){N=K({},I.defaults[L])}else{N=K(I.defaults[L],N)}if(M!==undefined){N=M(N)}if(typeof N.count=="object"){N.count=x(N.count[0],N.count[1])}if(N.blend==="random"){N.blend=w()}if(typeof N.blend=="object"){var p=N.blend.length;N.blend=N.blend[x(0,p-1)]}if(N.blend!==undefined){v.blend=N.blend}else{v.blend=""}if(N.rgba){N.rgba=E(N.rgba);v.rgba=[N.rgba[0],N.rgba[1],N.rgba[2],N.rgba[3]]}if(N.rgb){N.rgb=E(N.rgb);v.rgba=[N.rgb[0],N.rgb[1],N.rgb[2],1]}return N};var k=function(p,L){if(F){console.log(f,p,L)}};var c=function(p,L){B.push([f,p,L]);k(p,L)};var H={rect:function(M,Q,L,P,O){if(O!==undefined){M=M-parseInt(L/2);Q=Q-parseInt(P/2)}for(var N=0;N<L;N++){for(var p=0;p<P;p++){v.set(M+N,Q+p)}}},circle:function(N,P,L,M){if(M==undefined){N=N+L;P=P+L}for(var p=-L;p<L;p++){var O=parseInt(Math.sqrt(L*L-p*p));for(var Q=-O;Q<O;Q++){v.set(N+p,P+Q)}}},line:function(L,Q,p,P){var N=Math.sqrt((p-L)*(p-L)+(P-Q)*(P-Q));var T=(p-L)/N;var S=(P-Q)/N;var R=0;var O=0;for(var M=0;M<N;M++){R=L+(T*M);O=Q+(S*M);v.set(R,O)}},sphere:function(p,T,P,Q,M,O){if(Q==undefined){p=p+P;T=T+P}for(var U=-P;U<P;U++){var N=parseInt(Math.sqrt(P*P-U*U));for(var S=-N;S<N;S++){var R=Math.min(255,Math.max(0,(255-255*Math.sqrt((S*S)+(U*U))/(P/2))));if(R>0){if(O){var L=(R/255)}else{var L=M[3]}v.rgba=[(M[0]/255)*R,(M[1]/255)*R,(M[2]/255)*R,L];v.set(p+U,T+S)}}}},pyramid:function(X,V,M,p,T,R,S){var Y=parseInt(M/2);var W=parseInt(p/2);if(T!=true){X=X+Y;V=V+W}for(var O=-Y;O<Y;O++){for(var N=-W;N<W;N++){var Q=(0.25-Math.abs(O/M))*255;var P=(0.25-Math.abs(N/p))*255;var U=Q+P;if(S){var L=(U/255)}else{var L=R[3]}if(U>0){v.rgba=[(R[0]/255)*U,(R[1]/255)*U,(R[2]/255)*U,L];v.set(X+O,V+N)}}}}};var h={luminance:function(p){return(0.21*p[0])+(0.72*p[1])+(0.07*p[2])},randomseed:function(L){if(this.seed==undefined){this.seed=x(1,65535)}if(L!==undefined){this.seed=L}var p=Math.sin(this.seed++)*10000;return p-Math.floor(p)},normalize1:function(p){return h.normalize(p,0,1)},normalize255:function(p){return h.normalize(p,0,255)},normalize:function(M,L,p){if(M>p){return p}if(M<L){return L}return M},interpolate:{linear:function(M,L,p){return M*(1-p)+L*p},cosine:function(M,L,p){var O=p*3.1415927;var N=(1-Math.cos(O))*0.5;return M*(1-N)+L*N},catmullrom:function(W,V,T,S,U,L){var p=U/L;var O=(S-T)-(W-V);var N=(W-V)-O;var M=T-W;var X=(O*p*p*p)+(N*p*p)+(M*p)+V;if(X<0){X=0}if(X>1){X=1}return X}}};var j=function(p){return p&(a-1)};var i=function(p){return p&(d-1)};var v={rgba:[0,0,0,1],mixed:[0,0,0,1],blend:"opacity",normalize:function(p){p[0]=Math.round(p[0]);p[1]=Math.round(p[1]);p[2]=Math.round(p[2]);return p},colorize:function(L,p,M){if(M===undefined){M=50}return[L[0]-(L[0]-p[0])*(M/100),L[1]-(L[1]-p[1])*(M/100),L[2]-(L[2]-p[2])*(M/100),p[3]?p[3]:0.5]},opacity:function(p,L){if(p[3]>1){p[3]=p[3]/255}if(p[3]==1){return[p[0],p[1],p[2],p[3]]}return[p[0]*(p[3])+L[0]*(1-p[3]),p[1]*(p[3])+L[1]*(1-p[3]),p[2]*(p[3])+L[2]*(1-p[3]),p[3]]},calc:function(p,M){switch(this.blend){case"opacity":var L=this.opacity(p,M);break;case"multiply":p[0]=(M[0]*p[0])/255;p[1]=(M[1]*p[1])/255;p[2]=(M[2]*p[2])/255;var L=this.opacity(p,M);break;case"screen":p[0]=255-(((255-M[0])*(255-p[0]))/255);p[1]=255-(((255-M[1])*(255-p[1]))/255);p[2]=255-(((255-M[2])*(255-p[2]))/255);var L=this.opacity(p,M);break;case"overlay":p[0]=(M[0]>128)?255-2*(255-p[0])*(255-M[0])/255:(M[0]*p[0]*2)/255;p[1]=(M[1]>128)?255-2*(255-p[1])*(255-M[1])/255:(M[1]*p[1]*2)/255;p[2]=(M[2]>128)?255-2*(255-p[2])*(255-M[2])/255:(M[2]*p[2]*2)/255;var L=this.opacity(p,M);break;case"difference":p[0]=Math.abs(p[0]-M[0]);p[1]=Math.abs(p[1]-M[1]);p[2]=Math.abs(p[2]-M[2]);var L=this.opacity(p,M);break;case"exclusion":p[0]=128-2*(M[0]-128)*(p[0]-128)/255;p[1]=128-2*(M[1]-128)*(p[1]-128)/255;p[2]=128-2*(M[2]-128)*(p[2]-128)/255;var L=this.opacity(p,M);break;case"darken":p[0]=(p[0]<M[0])?p[0]:M[0];p[1]=(p[1]<M[1])?p[1]:M[1];p[2]=(p[2]<M[2])?p[2]:M[2];var L=this.opacity(p,M);break;case"lighten":p[0]=(p[0]>M[0])?p[0]:M[0];p[1]=(p[1]>M[1])?p[1]:M[1];p[2]=(p[2]>M[2])?p[2]:M[2];var L=this.opacity(p,M);break;case"lineardodge":p[0]=M[0]+p[0];p[1]=M[1]+p[1];p[2]=M[2]+p[2];var L=this.opacity(p,M);break;case"linearlight":p[0]=M[0]+2*p[0]-255;p[1]=M[1]+2*p[1]-255;p[2]=M[2]+2*p[2]-255;var L=this.opacity(p,M);break;case"linearburn":p[0]=M[0]+p[0]-255;p[1]=M[1]+p[1]-255;p[2]=M[2]+p[2]-255;var L=this.opacity(p,M);break;case"softlight":p[0]=(M[0]>128)?255-((255-M[0])*(255-(p[0]-128)))/255:(M[0]*(p[0]+128))/255;p[1]=(M[1]>128)?255-((255-M[1])*(255-(p[1]-128)))/255:(M[1]*(p[1]+128))/255;p[2]=(M[2]>128)?255-((255-M[2])*(255-(p[2]-128)))/255:(M[2]*(p[2]+128))/255;var L=this.opacity(p,M);break;default:var L=[p[0],p[1],p[2],p[3]];break}return L},set:function(p,L){this.mixed=this.calc(this.rgba,this.get(p,L));o.set(p,L,this.mixed)},get:function(p,L){return o.get(p,L)}};var l=function(M){for(var p=0;p<a;p++){for(var N=0;N<d;N++){var L=v.get(p,N);L=M(L,p,N);v.rgba=L;v.set(p,N)}}};var C=function(L,p){return parseInt((L/100)*p)};var J=function(M,N){if(N.elements!=undefined){var p=N.elements[M].x;var O=N.elements[M].y;var L=N.elements[M].size}else{if(N.origin=="random"){var p=x(0,a);var O=x(0,d);var L=g(N.size)}else{var p=N.origin[0];var O=N.origin[1];var L=g(N.size)}}return{x:p,y:O,size:L}};I.merge=function(O){O=e("merge",O);if(A[O.layer]===undefined){return this}var L=A[O.layer].getContext("2d");var M=L.getImageData(0,0,a,d);var Q=M.data;for(var P=0;P<d;P++){for(var p=0;p<a;p++){var N=o.offset(p,P);v.rgba=[Q[N],Q[N+1],Q[N+2],Q[N+3]];v.rgba[3]=(v.rgba[3]>1)?v.rgba[3]/255:v.rgba[3];v.set(p,P)}}c("merge",O);return this};I.copy=function(L){var O=o.pixels();var p=A[L].getContext("2d");var M=p.getImageData(0,0,a,d);var N=M.data;while(O--){o.data[O]=N[O]}c("copy",L);return this};I.brightness=function(p){p=e("brightness",p);v.blend="";l(function(L){if(p.legacy===true){return[Math.min(L[0]+p.adjust,255),Math.min(L[1]+p.adjust,255),Math.min(L[2]+p.adjust,255),L[3]]}else{p.adjust=Math.pow((p.adjust+100)/100,2);return[((((L[0]/255)-0.5)*p.adjust)+0.5)*255,((((L[1]/255)-0.5)*p.adjust)+0.5)*255,((((L[2]/255)-0.5)*p.adjust)+0.5)*255,L[3]]}});c("brightness",p);return this};I.contrast=function(L){L=e("contrast",L);var p=(100+L.adjust)/100;v.blend="";l(function(M){M[0]=((((M[0]/255)-0.5)*p)+0.5)*255;M[1]=((((M[1]/255)-0.5)*p)+0.5)*255;M[2]=((((M[2]/255)-0.5)*p)+0.5)*255;return[Math.max(Math.min(M[0],255),0),Math.max(Math.min(M[1],255),0),Math.max(Math.min(M[2],255),0),M[3]]});c("contrast",L);return this};I.grayscale=function(p){if(!p){p="average"}v.blend="";switch(p){case"ligthness":l(function(L){var M=Math.max(L[0],L[1],L[2])+Math.min(L[0],L[1],L[2]);return[M,M,M,L[3]]});break;case"average":l(function(L){var M=(L[0]+L[1]+L[2])/3;return[M,M,M,L[3]]});break;case"luminosity":l(function(M){var L=h.luminance(M);return[L,L,L,M[3]]});break}c("grayscale",p);return this};I.colorize=function(p){p=e("colorize",p);v.blend="";l(function(L){return v.colorize(L,p.rgb,p.level)});c("colorize",p);return this};I.invert=function(){params=e("invert",{});v.blend="";l(function(p){return[255-p[0],255-p[1],255-p[2],p[3]]});c("invert",params);return this};I.threshold=function(p){params=e("threshold",{},function(L){if(p!==undefined){L.threshold=p}return L});v.blend="";l(function(L){var M=((0.2126*L[0])+(0.7152*L[1])+(0.0722*L[2])<=params.threshold)?0:255;return[M,M,M,1]});c("threshold",params);return this};I.vibrance=function(L){L=e("vibrance",L);var p=L.adjust*-1;v.blend="";l(function(N){var O=(N[0]+N[1]+N[2])/3;var M=Math.max(N[0],N[1],N[2]);var P=((Math.abs(M-O)*2/255)*p)/100;if(N[0]!==M){N[0]+=(M-N[0])*P}if(N[1]!==M){N[1]+=(M-N[1])*P}if(N[2]!==M){N[2]+=(M-N[2])*P}return[N[0],N[1],N[2],N[3]]});c("vibrance",L);return this};I.waves=function(L){L=e("waves",L,function(P){if(P.xsines===undefined){P.xsines=x(1,10)}else{if(typeof P.xsines=="object"){P.xsines=x(P.xsines[0],P.xsines[1])}}if(P.ysines===undefined){P.ysines=x(1,10)}else{if(typeof P.ysines=="object"){P.ysines=x(P.ysines[0],P.ysines[1])}}if(P.rgba===undefined){var O=(P.opacity!==undefined)?P.opacity:1;P.rgba=E([[0,255],[0,255],[0,255],O])}return P});for(var p=0;p<a;p++){for(var N=0;N<d;N++){var M=127+63.5*Math.sin(p/a*L.xsines*2*3.141592)+63.5*Math.sin(N/d*L.ysines*2*3.141592);if(typeof L.channels=="object"){v.rgba=[L.channels[0]?M:0,L.channels[1]?M:0,L.channels[2]?M:0,L.channels[3]?M:0]}else{v.rgba=v.colorize([M,M,M,1],L.rgba,L.level)}v.set(p,N)}}c("waves",L);return this};I.spheres=function(N){N=e("spheres",N);var L=[];for(var p=0;p<N.count;p++){var M=J(p,N);H.sphere(C(M.x,a),C(M.y,d),C(M.size,m),true,N.rgba,N.dynamic);L.push(M)}N.elements=L;c("spheres",N);return this};I.pyramids=function(N){N=e("pyramids",N);var L=[];for(var p=0;p<N.count;p++){var M=J(p,N);H.pyramid(C(M.x,a),C(M.y,d),C(M.size,m),C(M.size,m),true,N.rgba,N.dynamic);L.push(M)}N.elements=L;c("pyramids",N);return this};I.crosshatch=function(L){params=e("crosshatch",L,function(O){if(O.xadjust==undefined){O.xadjust=x(1,10)}if(O.yadjust===undefined){O.yadjust=x(1,10)}if(O.rgba===undefined){O.rgba=[x(0,255),x(0,255),x(0,255),1]}return O});for(var p=0;p<a;p++){for(var N=0;N<d;N++){var M=127+63.5*Math.sin(p*p/params.xadjust)+63.5*Math.cos(N*N/params.yadjust);v.rgba=v.colorize([M,M,M,1],params.rgba,params.level);v.set(p,N)}}c("crosshatch",params);return this};I.squares=function(N){N=e("squares",N);var L=[];for(var p=0;p<N.count;p++){var M=J(p,N);H.rect(C(M.x,a),C(M.y,d),C(M.size,m),C(M.size,m),false);L.push(M)}N.elements=L;c("squares",N);return this};I.circles=function(N){N=e("circles",N);var L=[];for(var p=0;p<N.count;p++){var M=J(p,N);H.circle(C(M.x,a),C(M.y,d),C(M.size,m),true);L.push(M)}N.elements=L;c("circles",N);return this};I.lines=function(P){P=e("lines",P,function(Q){Q.freq1s=g(Q.freq1s,true);Q.freq1c=g(Q.freq1c,true);Q.freq2s=g(Q.freq2s,true);Q.freq2c=g(Q.freq2c,true);Q.size=g(Q.size);return Q});for(var N=0;N<P.count;N++){var L=a/2+Math.sin(N/P.freq1s*3.141592)*P.size;var O=d/2+Math.cos(N/P.freq1c*3.141592)*P.size;var p=a/2+Math.sin(N/P.freq2s*3.141592)*P.size;var M=d/2+Math.cos(N/P.freq2c*3.141592)*P.size;H.line(L,O,p,M)}c("lines",P);return this};I.lines2=function(N){N=e("lines2",N);var M=[];var L=null;for(var p=0;p<N.count;p++){if(N.elements!=undefined){L=N.elements[p]}else{L={size:g(N.size,true),d:y(0.1,100)}}if(N.type=="vertical"){H.rect(C(L.d,a),0,C(L.size,a),d)}else{H.rect(0,C(L.d,a),a,C(L.size,a))}M.push(L)}N.elements=M;c("lines2",N);return this};I.noise=function(M){M=e("noise",M);for(var p=0;p<a;p++){for(var N=0;N<d;N++){if(M.mode=="color"){v.rgba=[x(0,255),x(0,255),x(0,255),M.opacity]}else{var L=x(0,255);v.rgba=[L,L,L,M.opacity]}v.set(p,N)}}c("noise",M);return this};I.clouds=function(N){N=e("clouds",N,function(T){T.seed=g(T.seed);T.roughness=g(T.roughness);return T});var p=[];var L=function(){for(var T=0;T<=a;T++){p[T]=[];for(var U=0;U<=d;U++){p[T][U]=0}}};var S=function(T,V,U){if(T<0){T=a+T}if(T>=a){T=T-a}if(V<0){V=d+V}if(V>=d){V=V-d}if(U!==undefined){return p[T][V]=U}else{return p[T][V]}};var Q=function(T){return(h.randomseed()-0.5)*(T/(a+a)*N.roughness)};var O=function(V){var ae=V/2;if(ae<=1){return}for(var Y=ae-ae;Y<=(a+ae);Y+=ae){for(var X=ae-ae;X<=(d+ae);X+=ae){var af=S(Y-ae,X-ae);var W=S(Y,X-ae);var ab=S(Y-ae,X);var Z=S(Y,X);var ad=Y-(ae/2);var ac=X-(ae/2);var U=S(ad,ac,h.normalize1((af+W+ab+Z)/4+Q(V)));var T=Y-(V)+(ae/2);S(Y-ae,ac,h.normalize1((af+ab+U+S(T,ac))/4+Q(V)));var aa=X-(V)+(ae/2);S(ad,X-ae,h.normalize1((af+W+U+S(ad,aa))/4+Q(V)))}}O(ae)};h.randomseed(N.seed);L();O(a);for(var R=0;R<a;R++){for(var P=0;P<d;P++){var M=256*p[R][P];v.rgba=v.colorize(N.rgba,[M,M,M,1]);v.set(R,P)}}c("clouds",N);return this};I.map=function(P){P=e("map",P,function(ab){ab.xamount=g(ab.xamount);ab.yamount=g(ab.yamount);ab.xchannel=g(ab.xchannel);ab.ychannel=g(ab.ychannel);ab.xlayer=g(ab.xlayer);ab.ylayer=g(ab.ylayer);return ab});var U=new I.buffer();var V=A[P.xlayer].getContext("2d");var p=V.getImageData(0,0,a,d);var Q=p.data;var R=A[P.ylayer].getContext("2d");var T=R.getImageData(0,0,a,d);var aa=T.data;for(var Z=0;Z<a;Z++){for(var X=0;X<d;X++){var S=o.offset(Z,X);var Y=Q[S+P.xchannel];var W=aa[S+P.ychannel];if((a%16)==0){var M=j(Z+((Y*P.xamount*a)>>16))}else{var M=Z+((Y*P.xamount*a)/(a*a))}if((d%16)==0){var L=i(X+((W*P.yamount*d)>>16))}else{var L=X+((W*P.yamount*d)/(d*d))}var O=v.get(M,L);U.data[S]=O[0];U.data[S+1]=O[1];U.data[S+2]=O[2];U.data[S+3]=O[3]}}var N=o.pixels();while(N--){o.data[N]=U.data[N]}c("map",P);return this};I.subplasma=function(Q){Q=e("subplasma",Q,function(p){p.seed=g(p.seed);p.size=g(p.size);return p});h.randomseed(Q.seed);var U=1<<Q.size;var N=a;var L=N;var R=[];var T,S;if(U>N){U=N}var V=N/U;for(S=0;S<U;S++){for(T=0;T<U;T++){R[T*V+S*V*N]=h.randomseed()}}for(S=0;S<U;S++){for(T=0;T<N;T++){var M=T&(~(V-1));var O=S*V*N;R[T+O]=h.interpolate.catmullrom(R[((M-V*1)&(N-1))+O],R[((M-V*0)&(N-1))+O],R[((M+V*1)&(N-1))+O],R[((M+V*2)&(N-1))+O],T%V,V)}}for(S=0;S<L;S++){for(T=0;T<N;T++){var M=S&(~(V-1));R[T+S*N]=h.interpolate.catmullrom(R[T+((M-V*1)&(L-1))*N],R[T+((M-V*0)&(L-1))*N],R[T+((M+V*1)&(L-1))*N],R[T+((M+V*2)&(L-1))*N],S%V,V)}}for(var T=0;T<a;T++){for(var S=0;S<d;S++){var P=256*R[T+S*N];v.rgba=v.colorize(Q.rgba,[P,P,P,1]);v.set(T,S)}}c("subplasma",Q);return this};I.test=function(){v.blend="opacity";v.rgba=[255,255,155,1];H.rect(1,1,a-2,d-2);var p=20;v.rgba=[0,150,0,0.6];H.rect(2,2,p,p);H.rect(a-p-2,2,p,p);H.rect(2,d-2-p,p,p);H.rect(a-2-p,d-2-p,p,p);v.rgba=[20,20,10,0.2];H.rect(a/2,d/2,178,178,true);v.rgba=[10,20,210,0.7];H.rect(a-5,d-5,10,10);var p=20;v.rgba=[0,0,0,1];H.line(p,p,a-p,d-p);H.line(a-p,p,p,d-p);H.line(0,d/2,a,d/2);H.line(a/2,0,a/2,d);v.rgba=[255,55,55,0.5];H.rect(10,10,a-20,d-20);v.rgba=[0,0,255,0.3];H.rect(a-2,d-2,4,4);v.rgba=[255,255,255,1];v.set(0,0);v.set(a-1,0);v.set(0,d-1);v.set(a-1,d-1);v.rgba=[25,25,0,0.2];H.circle(a/4,d/4,a/4,true);v.rgba=[255,255,0,0.1];H.circle(a,d,a,true);this.brightness(50,true);this.vibrance(100);this.contrast(20);return this};I.fill=function(p){p=e("fill",p);H.rect(1,1,a,d);c("fill",p);return this};I.toContext=function(L){var N=L.createImageData(a,d);var M=N.data;var O=o.pixels();for(var p=0;p<O;p+=4){M[p]=o.data[p];M[p+1]=o.data[p+1];M[p+2]=o.data[p+2];M[p+3]=255}return N};I.toCanvas=function(){var p=document.createElement("canvas");p.width=a;p.height=d;var L=p.getContext("2d");var M=this.toContext(L);L.putImageData(M,0,0);return p};I.getCanvas=function(p){if(p){p(A[A.length-1])}return this};I.getPhases=function(N){if(N){var p=[];var M=A.length;for(var L=0;L<M;L++){p.push(A[L])}N(p)}return this};I.stat=function(p){D.stop=new Date().getTime();D.elapsed=(D.stop-D.start)/1000;if(p){p(D)}return this};I.history={available:function(){try{return"localStorage" in window&&window.localStorage!==null&&window.localStorage!==undefined}catch(p){return false}},list:function(){if(!this.available()){return[]}return JSON.parse(localStorage.getItem(r))||[]},last:function(){if(!this.available()){return[]}return u[u.length-1]},get:function(p){if(!this.available()){return[]}if(!u[p]){return null}return u[p]},add:function(p){if(!s){return}if(!this.available()){return[]}var L=I.params(p);u=JSON.parse(localStorage.getItem(r))||[];if(u.length>=s){u.shift()}u.push(L);localStorage.setItem(r,JSON.stringify(u))}};I.params=function(p){if(p==undefined){var N=new Date();var L=B.length;var M=A.length;p=N.getHours()+":"+N.getMinutes()+":"+N.getSeconds()+" l"+M+" i"+L}return{name:p,version:G,width:a,height:d,items:B}};I.render=function(M,L){var P=0;if(M.width!=undefined){a=M.width}if(M.height!=undefined){d=M.height}q();o=new I.buffer();if(L!=true){z()}for(var N in M.items){f=M.items[N][0];var O=M.items[N][1];var p=M.items[N][2];if(O=="random"){O=t(I.defaults)}if(typeof O=="object"){O=b(O)}if(P!=f){if(A[f]!=undefined){o.canvas(A[f])}else{o.clear()}P=f}switch(O){default:if(I[O]==undefined){console.warn("undefined effect: "+O)}else{I[O](p)}break}A[f]=I.toCanvas()}I.history.add();return this};return I};