/*
 tgen.js - the seamless texture generator
 https://github.com/schalkt/tgen/
 http://seamless-texture.com/

 Copyright (c) 2015 Tamas Schalk
 MIT license

 @version 0.3.0
*/
((e)=>{window[e]={version:"0.3.0",defaults:{},effects:{},blends:{},shapes:{},events:{beforeRender:{},beforeEffect:{},afterEffect:{},afterRender:{}},config:{historyLast:15,historyName:"history",historyList:[]},effect(c,a,b){this.defaults[c]=a;this.effects[c]=b},event(c,a,b){void 0!=this.events[c]&&(this.events[c][a]=b)},blend(c,a){this.blends[c]=a},shape(c,a){this.shapes[c]=a},init(c,a){var b=this,d=[],g={},h=0,e=null,f={shape:b.shapes,effects:Object.keys(b.effects),canvases:[]},l=()=>{void 0==c&&
(c=256);1>c&&(c=256);1>a&&(a=256);1024<c&&(c=1024);1024<a&&(a=1024);void 0==a&&(a=c);e=(c+a)/2};l();f.clear=()=>{f.texture.clear();f.canvases=[];d=[];h=0;g.start=(new Date).getTime();return f};f.buffer=function(b,d,g){this.data=null;this.size=b?b:4;this.width=d?d:c;this.height=g?g:a;this.wha=(this.width+this.height)/2;this.pixels=function(){return this.width*this.height*this.size};this.clear=function(){this.data=new Float32Array(this.width*this.height*this.size)};this.pattern=(a,b)=>{var c=a/b;if(a>=
b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,c=b-Math.abs(a-c),c>=b&&(c-=b),c};this.offset=function(a,b){a=parseInt(a,10);b=parseInt(b,10);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.size+a*this.size};this.set=function(a,b,c){a=this.offset(a,b);for(b=0;b<this.size;b++)this.data[a+b]=c[b]};this.get=function(a,b){for(var c=this.offset(a,b),p=[],d=0;d<this.size;d++)p[d]=this.data[c+d];return p};this.canvas=
function(a){var b=this.pixels();for(a=a.getContext("2d").getImageData(0,0,this.width,this.height).data;b--;)f.texture.data[b]=a[b]};null===this.data&&this.clear()};f.texture=new f.buffer;f.clear();var k=(a,b)=>{var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c};f.randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;f.randReal=(a,b)=>Math.random()*(b-a)+a;f.randByArray=(a,b)=>{"object"==typeof a&&(a=void 0!=b?f.randReal(a[0],a[1]):f.randInt(a[0],a[1]));return a};f.randItem=(a)=>{var b=f.randInt(0,
a.length-1);return a[b]};var n=(a)=>{var b,c=0,d;for(d in a)Math.random()<1/++c&&(b=d);return b};f.rgba=(a)=>{"random"===a&&(a=!0,void 0===a&&(a=1),!0===a&&(a=.5+Math.random()/2),a=[f.randInt(0,255),f.randInt(0,255),f.randInt(0,255),a]);"object"==typeof a[0]&&(a[0]=f.randInt(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=f.randInt(a[1][0],a[1][1]));"object"==typeof a[2]&&(a[2]=f.randInt(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=f.randReal(a[3][0],a[3][1]));return a};f.calc={pi:3.1415927,luminance(a){return.21*
a[0]+.72*a[1]+.07*a[2]},randomseed(a){void 0==this.seed&&(this.seed=f.randInt(1,65535));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);return a-Math.floor(a)},normalize1(a){return f.calc.normalize(a,0,1)},normalize255(a){return f.calc.normalize(a,0,255)},normalize(a,b,c){return a>c?c:a<b?b:a},interpolate:{linear(a,b,c){return a*(1-c)+b*c},cosine(a,b,c){c=.5*(1-Math.cos(c*f.calc.pi));return a*(1-c)+b*c},catmullrom(a,b,c,d,f,g){f/=g;d=d-c-(a-b);a=d*f*f*f+(a-b-d)*f*f+(c-a)*f+b;0>a&&(a=0);1<a&&
(a=1);return a}}};f.wrapx=(a)=>a&c-1;f.wrapy=(b)=>b&a-1;f.point={rgba:[0,0,0,1],mixed:[0,0,0,1],blend:"opacity",normalize(a){a[0]=Math.round(a[0]);a[1]=Math.round(a[1]);a[2]=Math.round(a[2]);return a},colorize(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:.5]},opacity(a,b){1<a[3]&&(a[3]/=255);return 1==a[3]?[a[0],a[1],a[2],a[3]]:[a[0]*a[3]+b[0]*(1-a[3]),a[1]*a[3]+b[1]*(1-a[3]),a[2]*a[3]+b[2]*(1-a[3]),a[3]]},calc(a,c){return void 0!==
b.blends[this.blend]?(a=b.blends[this.blend](f,c,a),this.opacity(a,c)):a},set(a,b){this.mixed=this.calc(this.rgba,this.get(a,b));f.texture.set(a,b,this.mixed)},get(a,b){return f.texture.get(a,b)}};f.walk=(b)=>{for(var d=0;d<c;d++)for(var g=0;g<a;g++){var h=f.point.get(d,g),h=b(h,d,g);f.point.rgba=h;f.point.set(d,g)}};f.percent=(a,b)=>parseInt(a/100*b,10);f.percentX=(a)=>parseInt(a/100*c,10);f.percentY=(b)=>parseInt(b/100*a,10);f.percentXY=(a)=>parseInt(a/100*e,10);f.xysize=(b,d)=>{if(void 0!=d.elements)var g=
d.elements[b].x,h=d.elements[b].y,e=d.elements[b].size;else"random"==d.origin?(g=f.randInt(0,c),h=f.randInt(0,a)):(g=d.origin[0],h=d.origin[1]),e=f.randByArray(d.size);return{x:g,y:h,size:e}};f.toContext=(b)=>{b=b.createImageData(c,a);for(var d=b.data,g=f.texture.pixels(),h=0;h<g;h+=4)d[h]=f.texture.data[h],d[h+1]=f.texture.data[h+1],d[h+2]=f.texture.data[h+2],d[h+3]=255;return b};f.toCanvas=function(){var b=document.createElement("canvas");b.width=c;b.height=a;var d=b.getContext("2d"),f=this.toContext(d);
d.putImageData(f,0,0);return b};f.getCanvas=function(a){a&&a(f.canvases[f.canvases.length-1]);return this};f.getPhases=function(a){if(a){for(var b=[],c=f.canvases.length,d=0;d<c;d++)b.push(f.canvases[d]);a(b)}return this};f.stat=function(a){g.stop=(new Date).getTime();g.elapsed=(g.stop-g.start)/1E3;a&&a(g);return this};f.history={available(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(a){return!1}},list(){return this.available()?JSON.parse(window.localStorage.getItem(b.config.historyName))||
[]:[]},last(){return this.available()?b.config.historyList[b.config.historyList.length-1]:[]},get(a){return this.available()?b.config.historyList[a]?b.config.historyList[a]:null:[]},add(a){if(b.config.historyLast){if(!this.available())return[];a=f.params(a);b.config.historyList=JSON.parse(window.localStorage.getItem(b.config.historyName))||[];b.config.historyList.length>=b.config.historyLast&&b.config.historyList.shift();b.config.historyList.push(a);window.localStorage.setItem(b.config.historyName,
JSON.stringify(b.config.historyList))}}};f.params=(g)=>{if(void 0==g){g=new Date;var h=d.length,e=f.canvases.length;g=g.getHours()+":"+g.getMinutes()+":"+g.getSeconds()+" l"+e+" i"+h}return{name:g,version:b.version,width:c,height:a,items:d}};f.render=function(d,g){var e=0;void 0!=d.width&&(c=d.width);void 0!=d.height&&(a=d.height);l();f.texture=new f.buffer;1!=g&&f.clear();for(var m in d.items){h=d.items[m][0];var k=d.items[m][1],t=d.items[m][2];"random"==k&&(k=n(f.defaults));"object"==typeof k&&
(k=f.randItem(k));e!=h&&(void 0!=f.canvases[h]?f.texture.canvas(f.canvases[h]):f.texture.clear(),e=h);if(void 0!=f[k])f[k](t);else void 0!=b.effects[k]?f.do(k,t):console.warn("undefined effect: "+k);f.canvases[h]=f.toCanvas()}f.history.add();return this};f.event=(a,c)=>{for(var d in b.events[a]){var g=b.events[a][d];"function"==typeof g&&g(f,c)}};f.do=(a,c)=>{var g=c;void 0===c?c=k({},b.defaults[a]):"object"==typeof c&&(c=k(b.defaults[a],c));var e=c;"object"==typeof e.count&&(e.count=f.randInt(e.count[0],
e.count[1]));"random"===e.blend&&(e.blend=n(b.blends));"object"==typeof e.blend&&(e.blend=e.blend[f.randInt(0,e.blend.length-1)]);f.point.blend=void 0!==e.blend?e.blend:"";e.rgba&&(e.rgba=f.rgba(e.rgba),f.point.rgba=[e.rgba[0],e.rgba[1],e.rgba[2],e.rgba[3]]);e.rgb&&(e.rgb=f.rgba(e.rgb),f.point.rgba=[e.rgb[0],e.rgb[1],e.rgb[2],1]);c=e;f.event("beforeEffect",{layer:h,name:a,params:c});"function"==typeof b.effects[a]?c=b.effects[a](f,c):console.warn("effect not callable: "+a);void 0===c&&(c=g);f.event("afterEffect",
{layer:h,name:a,params:c});!1!==c.store&&d.push([h,a,c]);return f};return f}}})("tgen");((e)=>{e=window[e];e.blend("opacity",(c,a,b)=>b);e.blend("multiply",(c,a,b)=>{b[0]=a[0]*b[0]/255;b[1]=a[1]*b[1]/255;b[2]=a[2]*b[2]/255;return b});e.blend("difference",(c,a,b)=>{b[0]=Math.abs(b[0]-a[0]);b[1]=Math.abs(b[1]-a[1]);b[2]=Math.abs(b[2]-a[2]);return b});e.blend("screen",(c,a,b)=>{b[0]=255-(255-a[0])*(255-b[0])/255;b[1]=255-(255-a[1])*(255-b[1])/255;b[2]=255-(255-a[2])*(255-b[2])/255;return b});e.blend("overlay",(c,a,b)=>{b[0]=128<a[0]?255-2*(255-b[0])*(255-a[0])/255:a[0]*b[0]*2/255;b[1]=
128<a[1]?255-2*(255-b[1])*(255-a[1])/255:a[1]*b[1]*2/255;b[2]=128<a[2]?255-2*(255-b[2])*(255-a[2])/255:a[2]*b[2]*2/255;return b});e.blend("exclusion",(c,a,b)=>{b[0]=128-2*(a[0]-128)*(b[0]-128)/255;b[1]=128-2*(a[1]-128)*(b[1]-128)/255;b[2]=128-2*(a[2]-128)*(b[2]-128)/255;return b});e.blend("darken",(c,a,b)=>{b[0]=b[0]<a[0]?b[0]:a[0];b[1]=b[1]<a[1]?b[1]:a[1];b[2]=b[2]<a[2]?b[2]:a[2];return b});e.blend("lighten",(c,a,b)=>{b[0]=b[0]>a[0]?b[0]:a[0];b[1]=b[1]>a[1]?b[1]:a[1];b[2]=b[2]>a[2]?b[2]:a[2];return b});
e.blend("lineardodge",(c,a,b)=>{b[0]=a[0]+b[0];b[1]=a[1]+b[1];b[2]=a[2]+b[2];return b});e.blend("linearlight",(c,a,b)=>{b[0]=a[0]+2*b[0]-255;b[1]=a[1]+2*b[1]-255;b[2]=a[2]+2*b[2]-255;return b});e.blend("linearburn",(c,a,b)=>{b[0]=a[0]+b[0]-255;b[1]=a[1]+b[1]-255;b[2]=a[2]+b[2]-255;return b});e.blend("softlight",(c,a,b)=>{b[0]=128<a[0]?255-(255-a[0])*(255-(b[0]-128))/255:a[0]*(b[0]+128)/255;b[1]=128<a[1]?255-(255-a[1])*(255-(b[1]-128))/255:a[1]*(b[1]+128)/255;b[2]=128<a[2]?255-(255-a[2])*(255-(b[2]-
128))/255:a[2]*(b[2]+128)/255;return b})})("tgen");((e)=>{e=window[e];e.effect("fill",{blend:"",rgba:[128,128,228,.5]},(c,a)=>{c.shape.rect(c,1,1,c.texture.width,c.texture.height);return a});e.effect("copy",{layer:null},(c,a)=>{"number"==typeof a&&(a={layer:a});null===a.layer&&(a.layer=c.canvases.length-1);if(void 0==c.canvases[a.layer])return a;for(var b=c.texture.pixels(),d=c.canvases[a.layer].getContext("2d").getImageData(0,0,c.texture.width,c.texture.height).data;b--;)c.texture.data[b]=d[b];return a});e.effect("merge",{blend:"opacity",opacity:.5,
layer:0},function(c,a){if(void 0===c.canvases[a.layer])return this;for(var b=c.canvases[a.layer].getContext("2d").getImageData(0,0,c.texture.width,c.texture.height).data,d=0;d<c.texture.height;d++)for(var g=0;g<c.texture.width;g++){var h=c.texture.offset(g,d);c.point.rgba=[b[h],b[h+1],b[h+2],b[h+3]];c.point.rgba[3]=1<c.point.rgba[3]?c.point.rgba[3]/255:c.point.rgba[3];c.point.set(g,d)}return a});e.effect("noise",{blend:"softlight",mode:"monochrome",opacity:.5},(c,a)=>{"color"==a.mode?c.walk((b)=>
b=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),a.opacity]):c.walk((b)=>{b=c.randInt(0,255);return b=[b,b,b,a.opacity]});return a});e.effect("spheres",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,70]},(c,a)=>{for(var b=[],d=0;d<a.count;d++){var g=c.xysize(d,a);c.shape.sphere(c,c.percentX(g.x),c.percentY(g.y),c.percentXY(g.size),!0,a.rgba,a.dynamic);b.push(g)}a.elements=b;return a});e.effect("pyramids",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,
size:[21,100]},(c,a)=>{for(var b=[],d=0;d<a.count;d++){var g=c.xysize(d,a);c.shape.pyramid(c,c.percentX(g.x),c.percentY(g.y),c.percentXY(g.size),c.percentXY(g.size),!0,a.rgba,a.dynamic);b.push(g)}a.elements=b;return a});e.effect("squares",{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50]},(c,a)=>{for(var b=[],d=0;d<a.count;d++){var g=c.xysize(d,a);c.shape.rect(c,c.percentX(g.x),c.percentY(g.y),c.percentXY(g.size),c.percentXY(g.size),!1);b.push(g)}a.elements=b;return a});e.effect("circles",
{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15]},(c,a)=>{for(var b=[],d=0;d<a.count;d++){var g=c.xysize(d,a);c.shape.circle(c,c.percentX(g.x),c.percentY(g.y),c.percentXY(g.size),!0);b.push(g)}a.elements=b;return a});e.effect("lines",{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},(c,a)=>{a.freq1s=c.randByArray(a.freq1s,!0);a.freq1c=c.randByArray(a.freq1c,!0);a.freq2s=c.randByArray(a.freq2s,!0);a.freq2c=
c.randByArray(a.freq2c,!0);a.size=c.randByArray(a.size);for(var b=0;b<a.count;b++){var d=c.texture.width/2+Math.sin(b/a.freq1s*c.calc.pi)*a.size,g=c.texture.height/2+Math.cos(b/a.freq1c*c.calc.pi)*a.size,h=c.texture.width/2+Math.sin(b/a.freq2s*c.calc.pi)*a.size,e=c.texture.height/2+Math.cos(b/a.freq2c*c.calc.pi)*a.size;c.shape.line(c,d,g,h,e)}return a});e.effect("lines2",{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,11],count:[4,21]},(c,a)=>{for(var b=[],d=null,g=0;g<
a.count;g++)d=void 0!=a.elements?a.elements[g]:{size:c.randByArray(a.size,!0),d:c.randReal(.1,100)},"vertical"==a.type?c.shape.rect(c,c.percentX(d.d),0,c.percentX(d.size),c.texture.height):c.shape.rect(c,0,c.percentX(d.d),c.texture.width,c.percentX(d.size)),b.push(d);a.elements=b;return a});e.effect("subplasma",{seed:[1,65535],size:[3,4],rgba:"random"},(c,a)=>{a.seed=c.randByArray(a.seed);a.size=c.randByArray(a.size);c.calc.randomseed(a.seed);var b=1<<a.size,d=c.texture.width,g=[],h,e;b>d&&(b=d);
var f=d/b;for(e=0;e<b;e++)for(h=0;h<b;h++)g[h*f+e*f*d]=c.calc.randomseed();for(e=0;e<b;e++)for(h=0;h<d;h++){var l=h&~(f-1),k=e*f*d;g[h+k]=c.calc.interpolate.catmullrom(g[(l-1*f&d-1)+k],g[(l-0*f&d-1)+k],g[(l+1*f&d-1)+k],g[(l+2*f&d-1)+k],h%f,f)}for(e=0;e<d;e++)for(h=0;h<d;h++)l=e&~(f-1),g[h+e*d]=c.calc.interpolate.catmullrom(g[h+(l-1*f&d-1)*d],g[h+(l-0*f&d-1)*d],g[h+(l+1*f&d-1)*d],g[h+(l+2*f&d-1)*d],e%f,f);for(h=0;h<c.texture.width;h++)for(e=0;e<c.texture.height;e++)b=256*g[h+e*d],c.point.rgba=c.point.colorize(a.rgba,
[b,b,b,1]),c.point.set(h,e);return a});e.effect("waves",{blend:"opacity",rgba:"random",level:50,xsines:[1,10],ysines:[1,10]},(c,a)=>{void 0===a.xsines?a.xsines=c.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=c.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=c.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=c.randInt(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=c.rgba([[0,255],[0,255],[0,255],void 0!==a.opacity?a.opacity:1]));for(var b=0;b<c.texture.width;b++)for(var d=0;d<
c.texture.height;d++){var g=127+63.5*Math.sin(b/c.texture.width*a.xsines*2*c.calc.pi)+63.5*Math.sin(d/c.texture.height*a.ysines*2*c.calc.pi);c.point.rgba="object"==typeof a.channels?[a.channels[0]?g:0,a.channels[1]?g:0,a.channels[2]?g:0,a.channels[3]?g:0]:c.point.colorize([g,g,g,1],a.rgba,a.level);c.point.set(b,d)}return a});e.effect("crosshatch",{blend:"random",level:50},(c,a)=>{void 0==a.xadjust&&(a.xadjust=c.randInt(1,10));void 0===a.yadjust&&(a.yadjust=c.randInt(1,10));void 0===a.rgba&&(a.rgba=
[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),1]);for(var b=0;b<c.texture.width;b++)for(var d=0;d<c.texture.height;d++){var g=127+63.5*Math.sin(b*b/a.xadjust)+63.5*Math.cos(d*d/a.yadjust);c.point.rgba=c.point.colorize([g,g,g,1],a.rgba,a.level);c.point.set(b,d)}return a});e.effect("map",{xamount:[5,255],yamount:[5,255],xchannel:[0,3],ychannel:[0,3],xlayer:0,ylayer:0},(c,a)=>{a.xamount=c.randByArray(a.xamount);a.yamount=c.randByArray(a.yamount);a.xchannel=c.randByArray(a.xchannel);a.ychannel=
c.randByArray(a.ychannel);a.xlayer=c.randByArray(a.xlayer);a.ylayer=c.randByArray(a.ylayer);for(var b=new c.buffer,d=c.texture.width,g=c.texture.height,e=c.canvases[a.xlayer].getContext("2d").getImageData(0,0,d,g).data,m=c.canvases[a.ylayer].getContext("2d").getImageData(0,0,d,g).data,f=0;f<d;f++)for(var l=0;l<g;l++){var k=c.texture.offset(f,l),n=e[k+a.xchannel],p=m[k+a.ychannel],n=0==d%16?c.wrapx(f+(n*a.xamount*d>>16)):f+n*a.xamount*d/(d*d),p=0==g%16?c.wrapy(l+(p*a.yamount*g>>16)):l+p*a.yamount*
g/(g*g),p=c.point.get(n,p);b.data[k]=p[0];b.data[k+1]=p[1];b.data[k+2]=p[2];b.data[k+3]=p[3]}for(d=c.texture.pixels();d--;)c.texture.data[d]=b.data[d];return a});e.effect("clouds",{blend:"opacity",rgba:"random",seed:[1,65535],roughness:[2,16]},(c,a)=>{a.seed=c.randByArray(a.seed);a.roughness=c.randByArray(a.roughness);var b=c.texture.width,d=c.texture.height,g=[],e=(a,c,f)=>{0>a&&(a=b+a);a>=b&&(a-=b);0>c&&(c=d+c);c>=d&&(c-=d);return void 0!==f?g[a][c]=f:g[a][c]},m=(d)=>(c.calc.randomseed()-.5)*(d/
(b+b))*a.roughness,f=(g)=>{var k=g/2;if(1>=k)return a;for(var l=k-k;l<=b+k;l+=k)for(var n=k-k;n<=d+k;n+=k){var r=e(l-k,n-k),t=e(l,n-k),z=e(l-k,n),w=e(l,n),x=l-k/2,y=n-k/2,w=e(x,y,c.calc.normalize1((r+t+z+w)/4+m(g)));e(l-k,y,c.calc.normalize1((r+z+w+e(l-g+k/2,y))/4+m(g)));e(x,n-k,c.calc.normalize1((r+t+w+e(x,n-g+k/2))/4+m(g)))}f(k)};c.calc.randomseed(a.seed);(()=>{for(var a=0;a<=b;a++){g[a]=[];for(var c=0;c<=d;c++)g[a][c]=0}})();f(b);for(var l=0;l<b;l++)for(var k=0;k<d;k++){var n=256*g[l][k];c.point.rgba=
c.point.colorize(a.rgba,[n,n,n,1]);c.point.set(l,k)}return a})})("tgen");((e)=>{e=window[e];e.effect("opacity",{adjust:.5},(c,a)=>{c.walk((b)=>{b[3]=a.adjust;return b});return a});e.effect("vibrance",{adjust:50},(c,a)=>{var b=-1*a.adjust;c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3,e=Math.max(a[0],a[1],a[2]),c=2*Math.abs(e-c)/255*b/100;a[0]!==e&&(a[0]+=(e-a[0])*c);a[1]!==e&&(a[1]+=(e-a[1])*c);a[2]!==e&&(a[2]+=(e-a[2])*c);return[a[0],a[1],a[2],a[3]]});return a});e.effect("brightness",{adjust:50,legacy:!0},(c,a)=>{c.walk((b)=>{if(!0===a.legacy)return[Math.min(b[0]+a.adjust,255),
Math.min(b[1]+a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]];a.adjust=Math.pow((a.adjust+100)/100,2);return[255*((b[0]/255-.5)*a.adjust+.5),255*((b[1]/255-.5)*a.adjust+.5),255*((b[2]/255-.5)*a.adjust+.5),b[3]]});return a});e.effect("contrast",{adjust:50},(c,a)=>{var b=(100+a.adjust)/100;c.walk((a)=>{a[0]=255*((a[0]/255-.5)*b+.5);a[1]=255*((a[1]/255-.5)*b+.5);a[2]=255*((a[2]/255-.5)*b+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),Math.max(Math.min(a[2],255),0),a[3]]});return a});
e.effect("threshold",{adjust:128},(c,a)=>{c.walk((b)=>{b=.2126*b[0]+.7152*b[1]+.0722*b[2]<=a.adjust?0:255;return[b,b,b,1]});return a});e.effect("gamma",{adjust:.5},(c,a)=>{c.walk((b)=>{b[0]=255*Math.pow(b[0]/255,1/a.adjust);b[1]=255*Math.pow(b[1]/255,1/a.adjust);b[2]=255*Math.pow(b[2]/255,1/a.adjust);return[b[0],b[1],b[2],b[3]]});return a});e.effect("grayscale",{method:["ligthness","average","luminosity"]},(c,a)=>{"object"==typeof a.method&&(a.method=c.randItem(a.method));switch(a.method){case "ligthness":c.walk((a)=>
{var c=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[c,c,c,a[3]]});break;case "average":c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3;return[c,c,c,a[3]]});break;case "luminosity":c.walk((a)=>{var d=c.calc.luminance(a);return[d,d,d,a[3]]})}return a});e.effect("colorize",{level:50,rgb:"random"},(c,a)=>{c.walk((b)=>c.point.colorize(b,a.rgb,a.level));return a});e.effect("invert",{channels:[1,1,1]},(c,a)=>{c.walk((b)=>[a.channels[0]?255-b[0]:b[0],a.channels[1]?255-b[1]:b[1],a.channels[2]?255-b[2]:b[2],
b[3]]);return a});e.effect("sobel",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,1,-2,0,2,-1,0,1]});return a});e.effect("emboss",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});return a});e.effect("edgedetect",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,0]});return a});e.effect("sharpen",
{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,-1,-1,-1,-1]});return a});e.effect("blur",{},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});return a});e.effect("sinecolor",{sines:[1,7],channel:[0,2]},(c,a)=>{a.sines=c.randByArray(a.sines);a.channel=c.randByArray(a.channel);c.walk((b)=>{var d=parseInt(255*Math.sin(c.calc.pi/180*b[a.channel]*(255/360)*a.sines));b[a.channel]=Math.abs(d);
return b});return a});e.effect("convolute",{blend:"opacity",transparent:!1,weights:[1,1,1,1,1,1,1,1,1]},(c,a)=>{if("object"!=typeof a.weights||null==a.weights)return a;var b=new c.buffer;b.clear();for(var d=Math.round(Math.sqrt(a.weights.length)),g=Math.floor(d/2),e=a.transparent?1:0,m=0;m<c.texture.height;m++)for(var f=0;f<c.texture.width;f++){for(var l=0,k=0,n=0,p=0,q=0;q<d;q++)for(var u=0;u<d;u++)var v=a.weights[q*d+u],r=c.texture.get(f+u-g,m+q-g),l=l+r[0]*v,k=k+r[1]*v,n=n+r[2]*v,p=p+r[3]*v;b.set(f,
m,[l,k,n,p+e*(255-p)])}for(d=c.texture.pixels();d--;)c.texture.data[d]=b.data[d];return a})})("tgen");((e)=>{e=window[e];e.shape("rect",(c,a,b,d,g,e)=>{void 0!==e&&(a-=parseInt(d/2,10),b-=parseInt(g/2,10));for(e=0;e<d;e++)for(var m=0;m<g;m++)c.point.set(a+e,b+m)});e.shape("circle",(c,a,b,d,g)=>{void 0==g&&(a+=d,b+=d);for(g=-d;g<d;g++)for(var e=parseInt(Math.sqrt(d*d-g*g),10),m=-e;m<e;m++)c.point.set(a+g,b+m)});e.shape("line",(c,a,b,d,e)=>{var h=Math.sqrt((d-a)*(d-a)+(e-b)*(e-b));d=(d-a)/h;e=(e-b)/h;for(var m=0,f=0,l=0;l<h;l++)m=a+d*l,f=b+e*l,c.point.set(m,f)});e.shape("sphere",(c,a,b,d,e,h,m)=>{void 0==
e&&(a+=d,b+=d);for(e=-d;e<d;e++)for(var f=parseInt(Math.sqrt(d*d-e*e),10),l=-f;l<f;l++){var k=Math.min(255,Math.max(0,255-255*Math.sqrt(l*l+e*e)/(d/2)));0<k&&(c.point.rgba=[h[0]/255*k,h[1]/255*k,h[2]/255*k,m?k/255:h[3]],c.point.set(a+e,b+l))}});e.shape("pyramid",(c,a,b,d,e,h,m,f)=>{var l=parseInt(d/2,10),k=parseInt(e/2,10);1!=h&&(a+=l,b+=k);for(h=-l;h<l;h++)for(var n=-k;n<k;n++){var p=255*(.25-Math.abs(h/d)),q=255*(.25-Math.abs(n/e)),p=p+q,q=f?p/255:m[3];0<p&&(c.point.rgba=[m[0]/255*p,m[1]/255*p,
m[2]/255*p,q],c.point.set(a+h,b+n))}})})("tgen");
