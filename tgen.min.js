/*
 tgen.js - the seamless texture generator
 https://github.com/schalkt/tgen/
 http://seamless-texture.com/

 Copyright (c) 2015 Tamas Schalk
 MIT license

 @version 0.4.0
*/
((d)=>{window[d]={version:"0.4.0",defaults:{},effects:{},blends:{},shapes:{},colormaps:{},events:{beforeEffect:{},afterEffect:{}},config:{historyLast:15,historyName:"history",historyList:[]},effect(c,a,b){this.defaults[c]=a;this.effects[c]=b},event(c,a,b){void 0!=this.events[c]&&(this.events[c][a]=b)},blend(c,a){this.blends[c]=a},shape(c,a){this.shapes[c]=a},colormap(c,a){this.colormaps[c]=a},init(c,a){var b=this,e=[],f={},l=0,d=null,g={shape:b.shapes,effects:Object.keys(b.effects),layers:[]},m=()=>
{void 0==c&&(c=256);1>c&&(c=256);1>a&&(a=256);1024<c&&(c=1024);1024<a&&(a=1024);void 0==a&&(a=c);d=(c+a)/2};m();g.clear=()=>{g.texture.clear();g.layers=[];e=[];l=0;f.start=(new Date).getTime();return g};g.buffer=function(b){this.data=null;this.components=4;this.width=c;this.height=a;this.wha=(this.width+this.height)/2;this.background=[0,0,0,255];"object"==typeof b&&(this.background=b);this.pixels=function(){return this.width*this.height};this.size=function(){return this.data.length};this.export=function(){for(var a=
this.size(),b=new Uint8ClampedArray(a);a--;)b[a]=this.data[a];return b};this.clear=function(a){this.data=new Uint8ClampedArray(this.width*this.height*this.components);void 0==a&&(a=this.background);for(var b=this.size();b;)this.data[b-1]=a[3],this.data[b-2]=a[2],this.data[b-3]=a[1],this.data[b-4]=a[0],b-=this.components};this.pattern=(a,b)=>{var c=a/b;if(a>=b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,c=b-Math.abs(a-c),c>=b&&(c-=b),c};this.offset=function(a,b){a=parseInt(a,10);b=
parseInt(b,10);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.components+a*this.components};this.set=function(a,b,c){a=this.offset(a,b);this.data[a]=c[0];this.data[a+1]=c[1];this.data[a+2]=c[2];this.data[a+3]=c[3]};this.get=function(a,b){var c=this.offset(a,b);return[this.data[c],this.data[c+1],this.data[c+2],this.data[c+3]]};this.canvas=function(a){var b=this.size();for(a=a.getContext("2d").getImageData(0,0,this.width,
this.height).data;b--;)g.texture.data[b]=a[b]};null===this.data&&this.clear()};g.texture=new g.buffer;g.layerCopy=function(a){var b=[];a=this.layers[a];for(var c=a.length;c--;)b[c]=a[c];return b};var h=(a,b)=>{var c={},e;for(e in a)c[e]=a[e];for(e in b)c[e]=b[e];return c};g.clone=function(a,b){for(var c in b)"object"===typeof b[c]&&null!==b[c]&&a[c]?this.clone(a[c],b[c]):a[c]=b[c]};g.randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;g.randReal=(a,b)=>Math.random()*(b-a)+a;g.randByArray=(a,b)=>{"object"==
typeof a&&(a=void 0!=b?g.randReal(a[0],a[1]):g.randInt(a[0],a[1]));return a};var n=(a)=>{void 0===a&&(a=255);!0===a&&(a=128+g.randInt(0,128));return[g.randInt(0,255),g.randInt(0,255),g.randInt(0,255),a]};g.randItem=(a)=>{var b=g.randInt(0,a.length-1);return a[b]};var p=(a)=>{var b,c=0,e;for(e in a)Math.random()<1/++c&&(b=e);return b};g.rgba=(a,b)=>{if("random"===a)return n(b);if("randomalpha"===a)return n(!0);"object"==typeof a[0]&&(a[0]=g.randInt(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=g.randInt(a[1][0],
a[1][1]));"object"==typeof a[2]&&(a[2]=g.randInt(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=g.randInt(a[3][0],a[3][1]));0!==a[3]%1&&(a[3]=Math.round(255*a[3]));1==a[3]&&(a[3]=255);return a};g.findClosestIndex=(a,b,c)=>{for(;0<=b&&b<=a.length-1;b+=c)if(a[b])return b;return a.length-1};g.calc={pi:3.1415927,luminance(a){return.21*a[0]+.72*a[1]+.07*a[2]},randomseed(a){void 0==this.seed&&(this.seed=g.randInt(1,65535));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);return a-Math.floor(a)},normalize1(a){return g.calc.normalize(a,
0,1)},normalize255(a){return g.calc.normalize(a,0,255)},normalize(a,b,c){return a>c?c:a<b?b:a},interpolate:{linear(a,b,c){return a*(1-c)+b*c},cosine(a,b,c){c=.5*(1-Math.cos(c*g.calc.pi));return a*(1-c)+b*c},catmullrom(a,b,c,e,g,f){g/=f;e=e-c-(a-b);a=e*g*g*g+(a-b-e)*g*g+(c-a)*g+b;0>a&&(a=0);1<a&&(a=1);return a}}};g.colormap={data:null,size:255,init(a,e,f){this.data=null;this.size=void 0==e?c:e;if(void 0==a||null==a)return a;if("object"==typeof a)if("object"==typeof a[0])for(key in a){var l=a[key];
l.rgba=g.rgba(l.rgba);a[key]=l}else a=g.randItem(a);if("random"===a){l=g.randInt(1,4);a=[];for(var d=0;d<=l;d++)a[d]={percent:parseInt(d/l*100),rgba:[g.randInt(0,255),g.randInt(0,255),g.randInt(0,255),255]}}"function"==typeof f&&f(a);"function"==typeof b.colormaps[a]&&(e=b.colormaps[a](e),this.data=this.render(e));"object"==typeof a&&(this.data=this.render(a))},render(a){for(var b=[],c=0;c<a.length-1;c++)for(var e=a[c],g=a[c+1],f=Math.round(e.percent/100*this.size),l=Math.round(g.percent/100*this.size),
d=f;d<=l;d++)b[d]=[e.rgba[0]+(d-f)/(l-f)*(g.rgba[0]-e.rgba[0]),e.rgba[1]+(d-f)/(l-f)*(g.rgba[1]-e.rgba[1]),e.rgba[2]+(d-f)/(l-f)*(g.rgba[2]-e.rgba[2]),e.rgba[3]+(d-f)/(l-f)*(g.rgba[3]-e.rgba[3])];return b},get(a,b){if(void 0==a)return this.data;a=parseInt(a);a>this.size&&(a-=this.size);0>a&&(a+=this.size);var c=this.data[a];void 0!==b&&(c[3]=b[3]);return c}};g.wrapx=(a)=>a&c-1;g.wrapy=(b)=>b&a-1;g.point={rgba:[],mixed:[],blend:"opacity",colorize(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),
a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:255]},opacity(a,b){if(255==a[3])return a[3]=b[3],a;if(0==b[3])return b;var c=a[3]/255;return[a[0]*c+b[0]*(1-c),a[1]*c+b[1]*(1-c),a[2]*c+b[2]*(1-c),b[3]]},set(a,c){var e=g.texture.get(a,c);void 0!==b.blends[this.blend]?(this.rgba=b.blends[this.blend](g,e,this.rgba),this.mixed=this.opacity(this.rgba,e)):this.mixed=this.rgba;g.texture.set(a,c,this.mixed)},get(a,b,c){return g.texture.get(a,b)}};g.walk=(b)=>{for(var e=0;e<c;e++)for(var f=0;f<a;f++){var l=
g.point.get(e,f),l=b(l,e,f);g.point.rgba=l;g.point.set(e,f)}};g.percent=(a,b)=>parseInt(a/100*b,10);g.percentX=(a)=>parseInt(a/100*c,10);g.percentY=(b)=>parseInt(b/100*a,10);g.percentXY=(a)=>parseInt(a/100*d,10);g.xysize=(b,e)=>{if(void 0!=e.elements)var f=e.elements[b].x,l=e.elements[b].y,d=e.elements[b].size;else"random"==e.origin?(f=g.randInt(0,c),l=g.randInt(0,a)):(f=e.origin[0],l=e.origin[1]),d=g.randByArray(e.size);return{x:f,y:l,size:d}};g.toContext=(b,e)=>{for(var g=b.createImageData(c,a),
f=g.data,l=e.length,d=0;d<l;d+=4)f[d]=e[d],f[d+1]=e[d+1],f[d+2]=e[d+2],f[d+3]=e[d+3];return g};g.toCanvas=function(b){void 0==b&&(b=g.texture.data);var e=document.createElement("canvas");e.width=c;e.height=a;var f=e.getContext("2d");b=this.toContext(f,b);f.putImageData(b,0,0);return e};g.getCanvas=function(a){if(a){var b=this.toCanvas(this.layers[this.layers.length-1]);a(b)}return this};g.getPhases=function(a){if(a){for(var b=[],c=g.layers.length,e=0;e<c;e++)b.push(this.toCanvas(this.layers[e]));
a(b)}return this};g.stat=function(a){f.stop=(new Date).getTime();f.elapsed=(f.stop-f.start)/1E3;a&&a(f);return this};g.history={available(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(a){return!1}},list(){return this.available()?JSON.parse(window.localStorage.getItem(b.config.historyName))||[]:[]},last(){return this.available()?b.config.historyList[b.config.historyList.length-1]:[]},get(a){return this.available()?b.config.historyList[a]?b.config.historyList[a]:
null:[]},add(a){if(b.config.historyLast){if(!this.available())return[];a=g.params(a);b.config.historyList=JSON.parse(window.localStorage.getItem(b.config.historyName))||[];b.config.historyList.length>=b.config.historyLast&&b.config.historyList.shift();b.config.historyList.push(a);window.localStorage.setItem(b.config.historyName,JSON.stringify(b.config.historyList))}}};g.params=(f)=>{void 0==f&&(f=new Date,f=f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+" l"+g.layers.length+" i"+e.length);return{name:f,
version:b.version,width:c,height:a,items:e}};g.render=function(e,f){var d=0;void 0!=e.width&&(c=e.width);void 0!=e.height&&(a=e.height);m();g.texture=new g.buffer(e.background);1!=f&&g.clear();for(var k in e.items){l=e.items[k][0];var h=e.items[k][1],n=e.items[k][2];"random"==h&&(h=p(g.defaults));"object"==typeof h&&(h=g.randItem(h));d!=l&&(void 0!=g.layers[l]?g.texture.data=g.layers[l]:g.texture.clear(),d=l);if(void 0!=g[h])g[h](n);else void 0!=b.effects[h]?g.do(h,n):console.warn("undefined effect: "+
h);g.layers[l]=g.texture.data}g.history.add();return this};g.event=(a,c)=>{for(var e in b.events[a]){var f=b.events[a][e];"function"==typeof f&&f(g,c)}};g.do=(a,c)=>{var f=c;void 0===c?c=h({},b.defaults[a]):"object"==typeof c&&(c=h(b.defaults[a],c));var d=c;"object"==typeof d.count&&(d.count=g.randInt(d.count[0],d.count[1]));"random"===d.blend&&(d.blend=p(b.blends));"object"==typeof d.blend&&(d.blend=d.blend[g.randInt(0,d.blend.length-1)]);g.point.blend=void 0!==d.blend?d.blend:"";d.rgba&&(d.rgba=
g.rgba(d.rgba),g.point.rgba=[d.rgba[0],d.rgba[1],d.rgba[2],d.rgba[3]]);d.rgb&&(d.rgb=g.rgba(d.rgb),g.point.rgba=[d.rgb[0],d.rgb[1],d.rgb[2],255]);c=d;g.event("beforeEffect",{layer:l,name:a,params:c});"function"==typeof b.effects[a]?c=b.effects[a](g,c):console.warn("effect not callable: "+a);void 0===c&&(c=f);g.event("afterEffect",{layer:l,name:a,params:c});!1!==c.store&&e.push([l,a,c]);return g};return g}}})("tgen");((d)=>{d=window[d];d.colormap("dawn",()=>[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,128,255]},{percent:75,rgba:[128,0,128,255]},{percent:100,rgba:[0,0,128,255]}]);d.colormap("dusk",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,128,255,255]},{percent:50,rgba:[128,0,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]);d.colormap("kryptonite",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,
128,255]},{percent:50,rgba:[128,255,0,255]},{percent:75,rgba:[0,128,0,255]},{percent:100,rgba:[0,0,0,255]}]);d.colormap("ice",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[128,255,255,255]},{percent:50,rgba:[0,128,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]);d.colormap("fire",()=>[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,0,255]},{percent:75,rgba:[128,0,0,255]},{percent:100,rgba:[0,0,0,255]}]);d.colormap("redblue",
()=>[{percent:0,rgba:[96,0,0,255]},{percent:25,rgba:[192,0,0,255]},{percent:50,rgba:[255,255,255,255]},{percent:75,rgba:[0,0,192,255]},{percent:100,rgba:[0,0,96,255]}]);d.colormap("seashore",()=>[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,128,255]},{percent:75,rgba:[0,128,128,255]},{percent:100,rgba:[0,0,128,255]}])})("tgen");((d)=>{d=window[d];d.blend("opacity",(c,a,b)=>b);d.blend("multiply",(c,a,b)=>{b[0]=a[0]*b[0]/255;b[1]=a[1]*b[1]/255;b[2]=a[2]*b[2]/255;return b});d.blend("difference",(c,a,b)=>{b[0]=Math.abs(b[0]-a[0]);b[1]=Math.abs(b[1]-a[1]);b[2]=Math.abs(b[2]-a[2]);return b});d.blend("screen",(c,a,b)=>{b[0]=255-(255-a[0])*(255-b[0])/255;b[1]=255-(255-a[1])*(255-b[1])/255;b[2]=255-(255-a[2])*(255-b[2])/255;return b});d.blend("overlay",(c,a,b)=>{b[0]=128<a[0]?255-2*(255-b[0])*(255-a[0])/255:a[0]*b[0]*2/255;b[1]=
128<a[1]?255-2*(255-b[1])*(255-a[1])/255:a[1]*b[1]*2/255;b[2]=128<a[2]?255-2*(255-b[2])*(255-a[2])/255:a[2]*b[2]*2/255;return b});d.blend("exclusion",(c,a,b)=>{b[0]=128-2*(a[0]-128)*(b[0]-128)/255;b[1]=128-2*(a[1]-128)*(b[1]-128)/255;b[2]=128-2*(a[2]-128)*(b[2]-128)/255;return b});d.blend("darken",(c,a,b)=>{b[0]=b[0]<a[0]?b[0]:a[0];b[1]=b[1]<a[1]?b[1]:a[1];b[2]=b[2]<a[2]?b[2]:a[2];return b});d.blend("lighten",(c,a,b)=>{b[0]=b[0]>a[0]?b[0]:a[0];b[1]=b[1]>a[1]?b[1]:a[1];b[2]=b[2]>a[2]?b[2]:a[2];return b});
d.blend("lineardodge",(c,a,b)=>{b[0]=a[0]+b[0];b[1]=a[1]+b[1];b[2]=a[2]+b[2];return b});d.blend("linearlight",(c,a,b)=>{b[0]=a[0]+2*b[0]-255;b[1]=a[1]+2*b[1]-255;b[2]=a[2]+2*b[2]-255;return b});d.blend("linearburn",(c,a,b)=>{b[0]=a[0]+b[0]-255;b[1]=a[1]+b[1]-255;b[2]=a[2]+b[2]-255;return b});d.blend("softlight",(c,a,b)=>{b[0]=128<a[0]?255-(255-a[0])*(255-(b[0]-128))/255:a[0]*(b[0]+128)/255;b[1]=128<a[1]?255-(255-a[1])*(255-(b[1]-128))/255:a[1]*(b[1]+128)/255;b[2]=128<a[2]?255-(255-a[2])*(255-(b[2]-
128))/255:a[2]*(b[2]+128)/255;return b})})("tgen");((d)=>{d=window[d];d.effect("fill",{blend:"",rgba:[128,128,128,255]},(c,a)=>{c.shape.rect(c,1,1,c.texture.width,c.texture.height);return a});d.effect("copy",{layer:null},(c,a)=>{"number"==typeof a&&(a={layer:a});null===a.layer&&(a.layer=c.layers.length-1);void 0!=c.layers[a.layer]&&(c.texture.data=c.layerCopy(a.layer));return a});d.effect("merge",{blend:"opacity",layer:0,opacity:null},function(c,a){if(void 0===c.layers[a.layer])return this;for(var b=c.layers[a.layer],e=0;e<c.texture.height;e++)for(var f=
0;f<c.texture.width;f++){var d=c.texture.offset(f,e);c.point.rgba=[b[d],b[d+1],b[d+2],a.opacity?a.opacity:b[d+3]];c.point.set(f,e)}return a});d.effect("noise",{blend:"softlight",mode:"monochrome",opacity:128},(c,a)=>{"color"==a.mode?c.walk((b)=>b=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),a.opacity]):c.walk((b)=>{b=c.randInt(0,255);return b=[b,b,b,a.opacity]});return a});d.effect("spheres",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,70]},(c,a)=>{for(var b=
[],e=0;e<a.count;e++){var f=c.xysize(e,a);c.shape.sphere(c,c.percentX(f.x),c.percentY(f.y),c.percentXY(f.size),!0,a.rgba,a.dynamic);b.push(f)}a.elements=b;return a});d.effect("pyramids",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[21,100]},(c,a)=>{for(var b=[],e=0;e<a.count;e++){var f=c.xysize(e,a);c.shape.pyramid(c,c.percentX(f.x),c.percentY(f.y),c.percentXY(f.size),c.percentXY(f.size),!0,a.rgba,a.dynamic);b.push(f)}a.elements=b;return a});d.effect("squares",{blend:"lighten",
rgba:"random",origin:"random",count:[4,7],size:[2,50]},(c,a)=>{for(var b=[],e=0;e<a.count;e++){var f=c.xysize(e,a);c.shape.rect(c,c.percentX(f.x),c.percentY(f.y),c.percentXY(f.size),c.percentXY(f.size),!1);b.push(f)}a.elements=b;return a});d.effect("circles",{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15]},(c,a)=>{for(var b=[],e=0;e<a.count;e++){var f=c.xysize(e,a);c.shape.circle(c,c.percentX(f.x),c.percentY(f.y),c.percentXY(f.size),!0);b.push(f)}a.elements=b;return a});d.effect("lines",
{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},(c,a)=>{a.freq1s=c.randByArray(a.freq1s,!0);a.freq1c=c.randByArray(a.freq1c,!0);a.freq2s=c.randByArray(a.freq2s,!0);a.freq2c=c.randByArray(a.freq2c,!0);a.size=c.randByArray(a.size);for(var b=0;b<a.count;b++){var e=c.texture.width/2+Math.sin(b/a.freq1s*c.calc.pi)*a.size,f=c.texture.height/2+Math.cos(b/a.freq1c*c.calc.pi)*a.size,d=c.texture.width/2+Math.sin(b/a.freq2s*c.calc.pi)*
a.size,k=c.texture.height/2+Math.cos(b/a.freq2c*c.calc.pi)*a.size;c.shape.line(c,e,f,d,k)}return a});d.effect("lines2",{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,11],count:[4,21]},(c,a)=>{for(var b=[],e=null,f=0;f<a.count;f++)e=void 0!=a.elements?a.elements[f]:{size:c.randByArray(a.size,!0),d:c.randReal(.1,100)},"vertical"==a.type?c.shape.rect(c,c.percentX(e.d),0,c.percentX(e.size),c.texture.height):c.shape.rect(c,0,c.percentX(e.d),c.texture.width,c.percentX(e.size)),
b.push(e);a.elements=b;return a});d.effect("subplasma",{seed:[1,65535],size:[3,4],rgba:"random"},(c,a)=>{a.seed=c.randByArray(a.seed);a.size=c.randByArray(a.size);c.calc.randomseed(a.seed);var b=1<<a.size,e=c.texture.width,f=[],d,k;b>e&&(b=e);var g=e/b;for(k=0;k<b;k++)for(d=0;d<b;d++)f[d*g+k*g*e]=c.calc.randomseed();for(k=0;k<b;k++)for(d=0;d<e;d++){var m=d&~(g-1),h=k*g*e;f[d+h]=c.calc.interpolate.catmullrom(f[(m-1*g&e-1)+h],f[(m-0*g&e-1)+h],f[(m+1*g&e-1)+h],f[(m+2*g&e-1)+h],d%g,g)}for(k=0;k<e;k++)for(d=
0;d<e;d++)m=k&~(g-1),f[d+k*e]=c.calc.interpolate.catmullrom(f[d+(m-1*g&e-1)*e],f[d+(m-0*g&e-1)*e],f[d+(m+1*g&e-1)*e],f[d+(m+2*g&e-1)*e],k%g,g);for(d=0;d<c.texture.width;d++)for(k=0;k<c.texture.height;k++)b=255*f[d+k*e],c.point.rgba=c.point.colorize(a.rgba,[b,b,b,255]),c.point.set(d,k);return a});d.effect("waves",{blend:"opacity",rgba:"random",level:50,xsines:[1,10],ysines:[1,10]},(c,a)=>{void 0===a.xsines?a.xsines=c.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=c.randInt(a.xsines[0],a.xsines[1]));
void 0===a.ysines?a.ysines=c.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=c.randInt(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=c.rgba([[0,255],[0,255],[0,255],void 0!==a.opacity?a.opacity:255]));for(var b=0;b<c.texture.width;b++)for(var e=0;e<c.texture.height;e++){var f=127+63.5*Math.sin(b/c.texture.width*a.xsines*2*c.calc.pi)+63.5*Math.sin(e/c.texture.height*a.ysines*2*c.calc.pi);c.point.rgba="object"==typeof a.channels?[a.channels[0]?f:0,a.channels[1]?f:0,a.channels[2]?f:0,a.channels[3]?
f:0]:c.point.colorize([f,f,f,255],a.rgba,a.level);c.point.set(b,e)}return a});d.effect("crosshatch",{blend:"random",level:50},(c,a)=>{void 0==a.xadjust&&(a.xadjust=c.randInt(1,10));void 0===a.yadjust&&(a.yadjust=c.randInt(1,10));void 0===a.rgba&&(a.rgba=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),255]);for(var b=0;b<c.texture.width;b++)for(var e=0;e<c.texture.height;e++){var f=127+63.5*Math.sin(b*b/a.xadjust)+63.5*Math.cos(e*e/a.yadjust);c.point.rgba=c.point.colorize([f,f,f,255],a.rgba,a.level);
c.point.set(b,e)}return a});d.effect("map",{xamount:[5,255],yamount:[5,255],xchannel:[0,2],ychannel:[0,2],xlayer:0,ylayer:0},(c,a)=>{a.xamount=c.randByArray(a.xamount);a.yamount=c.randByArray(a.yamount);a.xchannel=c.randByArray(a.xchannel);a.ychannel=c.randByArray(a.ychannel);a.xlayer=c.randByArray(a.xlayer);a.ylayer=c.randByArray(a.ylayer);for(var b=new c.buffer,e=c.texture.width,f=c.texture.height,d=c.layers[a.xlayer],k=c.layers[a.ylayer],g=0;g<e;g++)for(var m=0;m<f;m++){var h=c.texture.offset(g,
m),n=d[h+a.xchannel],p=k[h+a.ychannel],n=0==e%16?c.wrapx(g+(n*a.xamount*e>>16)):g+n*a.xamount*e/(e*e),p=0==f%16?c.wrapy(m+(p*a.yamount*f>>16)):m+p*a.yamount*f/(f*f),p=c.point.get(n,p);b.data[h]=p[0];b.data[h+1]=p[1];b.data[h+2]=p[2];b.data[h+3]=p[3]}for(e=c.texture.size();e--;)c.texture.data[e]=b.data[e];return a});d.effect("clouds",{blend:"opacity",rgba:"random",seed:[1,65535],roughness:[2,16],colormap:null},(c,a)=>{a.seed=c.randByArray(a.seed);a.roughness=c.randByArray(a.roughness);var b=c.texture.width,
e=c.texture.height,f=[],d=(a,c,d)=>{0>a&&(a=b+a);a>=b&&(a-=b);0>c&&(c=e+c);c>=e&&(c-=e);return void 0!==d?f[a][c]=d:f[a][c]},k=(e)=>(c.calc.randomseed()-.5)*(e/(b+b))*a.roughness,g=(f)=>{var h=f/2;if(1>=h)return a;for(var m=h-h;m<=b+h;m+=h)for(var n=h-h;n<=e+h;n+=h){var q=d(m-h,n-h),y=d(m,n-h),z=d(m-h,n),u=d(m,n),w=m-h/2,x=n-h/2,u=d(w,x,c.calc.normalize1((q+y+z+u)/4+k(f)));d(m-h,x,c.calc.normalize1((q+z+u+d(m-f+h/2,x))/4+k(f)));d(w,n-h,c.calc.normalize1((q+y+u+d(w,n-f+h/2))/4+k(f)))}g(h)};c.calc.randomseed(a.seed);
(()=>{for(var a=0;a<=b;a++){f[a]=[];for(var c=0;c<=e;c++)f[a][c]=0}})();g(b);c.colormap.init(a.colormap,255,(b)=>{a.colormap=b});for(var m=0;m<b;m++)for(var h=0;h<e;h++){var n=parseInt(255*f[m][h],10);c.point.rgba=null!==c.colormap.data?c.colormap.get(n,a.rgba):c.point.colorize(a.rgba,[n,n,n,255]);c.point.set(m,h)}return a});d.effect("colorbar",{type:"horizontal",mirror:!1,colormap:[{percent:0,rgba:[[0,255],[0,255],[0,255],255]},{percent:25,rgba:[[0,255],[0,255],[0,255],255]},{percent:50,rgba:[[0,
255],[0,255],[0,255],255]},{percent:75,rgba:[[0,255],[0,255],[0,255],255]},{percent:100,rgba:[[0,255],[0,255],[0,255],255]}]},(c,a)=>{var b=c.texture.width,e=c.texture.height;c.colormap.init(a.colormap,"horizontal"==a.type?b:e,(b)=>{a.colormap=b});if("horizontal"==a.type)for(var f=0;f<b;f++){if(a.mirror)var d=f<b/2?2*f:2*b-2*f;c.point.rgba=c.colormap.get(d);for(var k=0;k<e;k++)c.point.set(f,k)}else for(k=0;k<e;k++)for(a.mirror&&(d=k<e/2?2*k:2*e-2*k),c.point.rgba=c.colormap.get(d),f=0;f<b;f++)c.point.set(f,
k);return a});d.effect("checkerboard",{size:[[4,32],[4,32]],rgba:"randomalpha"},(c,a)=>{var b=c.texture.width,e=c.texture.height;if("object"==typeof a.size)var f=c.randByArray(a.size[0]),d=c.randByArray(a.size[1]);else d=f=a.size;for(var k=b/f,g=e/d,m=(a,d)=>{for(var f=0;f<k;f++)for(var h=0;h<g;h++)f+a<b&&h+d<e&&c.point.set(f+a,h+d)},h=0;h<f;h++)if(0==h%2)for(var n=0;n<d;n++)0==n%2?m(h*k,n*g):m(h*k+k,n*g);return a})})("tgen");((d)=>{d=window[d];d.effect("opacity",{adjust:128},(c,a)=>{c.walk((b)=>{b[3]=a.adjust;return b});return a});d.effect("vibrance",{adjust:50},(c,a)=>{var b=-1*a.adjust;c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3,d=Math.max(a[0],a[1],a[2]),c=2*Math.abs(d-c)/255*b/100;a[0]!==d&&(a[0]+=(d-a[0])*c);a[1]!==d&&(a[1]+=(d-a[1])*c);a[2]!==d&&(a[2]+=(d-a[2])*c);return[a[0],a[1],a[2],a[3]]});return a});d.effect("brightness",{adjust:50,legacy:!0},(c,a)=>{!0===a.legacy?c.walk((b)=>[Math.min(b[0]+a.adjust,255),Math.min(b[1]+
a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]]):c.walk((b)=>[b[0]=Math.min(255/b[0]*(a.adjust/255),255),b[1]=Math.min(255/b[1]*(a.adjust/255),255),b[2]=Math.min(255/b[2]*(a.adjust/255),255),b[3]]);return a});d.effect("contrast",{adjust:50},(c,a)=>{var b=(100+a.adjust)/100;c.walk((a)=>{a[0]=255*((a[0]/255-.5)*b+.5);a[1]=255*((a[1]/255-.5)*b+.5);a[2]=255*((a[2]/255-.5)*b+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),Math.max(Math.min(a[2],255),0),a[3]]});return a});d.effect("threshold",
{adjust:128},(c,a)=>{c.walk((b)=>{b=.2126*b[0]+.7152*b[1]+.0722*b[2]<=a.adjust?0:255;return[b,b,b,1]});return a});d.effect("gamma",{adjust:.5},(c,a)=>{c.walk((b)=>{b[0]=255*Math.pow(b[0]/255,1/a.adjust);b[1]=255*Math.pow(b[1]/255,1/a.adjust);b[2]=255*Math.pow(b[2]/255,1/a.adjust);return[b[0],b[1],b[2],b[3]]});return a});d.effect("grayscale",{method:["ligthness","average","luminosity"]},(c,a)=>{"string"==typeof a&&(a={method:a});"object"==typeof a.method&&(a.method=c.randItem(a.method));switch(a.method){case "ligthness":c.walk((a)=>
{var c=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[c,c,c,a[3]]});break;case "average":c.walk((a)=>{var c=(a[0]+a[1]+a[2])/3;return[c,c,c,a[3]]});break;case "luminosity":c.walk((a)=>{var e=c.calc.luminance(a);return[e,e,e,a[3]]})}return a});d.effect("colorize",{level:50,rgba:"random",colormap:null},(c,a)=>{c.colormap.init(a.colormap,255,(b)=>{a.colormap=b});c.walk((b)=>{if(c.colormap.data){var e=c.colormap.get((b[0]+b[1]+b[2])/3,a.rgba);e[3]=b[3];return e}return c.point.colorize(b,a.rgba,
a.level)});return a});d.effect("invert",{channels:[1,1,1]},(c,a)=>{c.walk((b)=>[a.channels[0]?255-b[0]:b[0],a.channels[1]?255-b[1]:b[1],a.channels[2]?255-b[2]:b[2],b[3]]);return a});d.effect("sobel",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,1,-2,0,2,-1,0,1]});return a});d.effect("emboss",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});return a});d.effect("edgedetect",
{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,0]});return a});d.effect("sharpen",{type:1},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,-1,-1,-1,-1]});return a});d.effect("blur",{},(c,a)=>{c.do("convolute",{store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});return a});d.effect("sinecolor",{sines:[1,7],channel:[0,2]},(c,a)=>{a.sines=c.randByArray(a.sines);
a.channel=c.randByArray(a.channel);c.walk((b)=>{var e=parseInt(255*Math.sin(c.calc.pi/180*b[a.channel]*(255/360)*a.sines));b[a.channel]=Math.abs(e);return b});return a});d.effect("convolute",{blend:"opacity",transparent:!1,weights:[1,1,1,1,1,1,1,1,1]},(c,a)=>{if("object"!=typeof a.weights||null==a.weights)return a;var b=new c.buffer;b.clear();for(var e=Math.round(Math.sqrt(a.weights.length)),d=Math.floor(e/2),l=a.transparent?1:0,k=0;k<c.texture.height;k++)for(var g=0;g<c.texture.width;g++){for(var m=
0,h=0,n=0,p=0,r=0;r<e;r++)for(var t=0;t<e;t++)var v=a.weights[r*e+t],q=c.texture.get(g+t-d,k+r-d),m=m+q[0]*v,h=h+q[1]*v,n=n+q[2]*v,p=p+q[3];b.set(g,k,[m,h,n,p+l*(255-p)])}for(e=c.texture.size();e--;)c.texture.data[e]=b.data[e];return a})})("tgen");((d)=>{d=window[d];d.shape("rect",(c,a,b,e,d,l)=>{void 0!==l&&(a-=parseInt(e/2,10),b-=parseInt(d/2,10));for(l=0;l<e;l++)for(var k=0;k<d;k++)c.point.set(a+l,b+k)});d.shape("circle",(c,a,b,e,d)=>{void 0==d&&(a+=e,b+=e);for(d=-e;d<e;d++)for(var l=parseInt(Math.sqrt(e*e-d*d),10),k=-l;k<l;k++)c.point.set(a+d,b+k)});d.shape("line",(c,a,b,e,d)=>{var l=Math.sqrt((e-a)*(e-a)+(d-b)*(d-b));e=(e-a)/l;d=(d-b)/l;for(var k=0,g=0,m=0;m<l;m++)k=a+e*m,g=b+d*m,c.point.set(k,g)});d.shape("sphere",(c,a,b,d,f,l,k)=>{void 0==
f&&(a+=d,b+=d);for(f=-d;f<d;f++)for(var g=parseInt(Math.sqrt(d*d-f*f),10),m=-g;m<g;m++){var h=Math.min(255,Math.max(0,255-255*Math.sqrt(m*m+f*f)/(d/2)))/255;0<h&&(c.point.rgba=[l[0]*h,l[1]*h,l[2]*h,k?255*h:l[3]],c.point.set(a+f,b+m))}});d.shape("pyramid",(c,a,b,d,f,l,k,g)=>{var m=parseInt(d/2,10),h=parseInt(f/2,10);1!=l&&(a+=m,b+=h);for(l=-m;l<m;l++)for(var n=-h;n<h;n++){var p=255*(.25-Math.abs(l/d)),r=255*(.25-Math.abs(n/f)),p=p+r;1<p&&(c.point.rgba=[k[0]/255*p,k[1]/255*p,k[2]/255*p,g?p:k[3]],c.point.set(a+
l,b+n))}})})("tgen");
