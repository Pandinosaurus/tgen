var tgen=function(a,d){var H="0.1";var J={};var B=[];var C=[];var E={};var g=0;var G=true;var t=15;var s="history";var v=[];var n=null;J.blends=["opacity","multiply","screen","overlay","difference","exclusion","darken","lighten","lineardodge","linearlight","linearburn","softlight"];var r=function(){if(a==undefined){a=256}if(a<1){a=256}if(d<1){d=256}if(a>1024){a=1024}if(d>1024){d=1024}if(d==undefined){d=a}n=(a+d)/2};r();var A=function(){q.clear();B=[];C=[];g=0;E.start=new Date().getTime()};J.buffer=function(M,p,N){this.data=null;this.size=M?M:4;this.width=p?p:a;this.height=N?N:d;this.pixels=function(){return this.width*this.height*this.size};this.clear=function(){this.data=new Float32Array(this.width*this.height*this.size)};this.pattern=function(S,O){var Q=S/O;if(S>=O){var R=Math.floor(Q)*(O);var P=(S-R);return P}if(S<0){var R=Math.ceil(Q)*(O);var P=O-Math.abs((S-R));if(P>=O){var P=(P-O);return P}return P}};this.offset=function(O,P){O=parseInt(O);P=parseInt(P);if(O<0||O>=this.width){O=this.pattern(O,this.width)}if(P<0||P>=this.height){P=this.pattern(P,this.height)}return P*this.width*this.size+O*this.size};this.set=function(O,S,P){var R=this.offset(O,S);for(var Q=0;Q<this.size;Q++){this.data[R+Q]=P[Q]}};this.get=function(O,S){var R=this.offset(O,S);var P=[];for(var Q=0;Q<this.size;Q++){P[Q]=this.data[R+Q]}return P};this.canvas=function(O){var S=this.pixels();var P=O.getContext("2d");var Q=P.getImageData(0,0,this.width,this.height);var R=Q.data;while(S--){q.data[S]=R[S]}};this.opacity=function(O){if(O===undefined){O=0.5}var Q=this.pixels();for(var P=0;P<Q;P=P+this.size){q.data[P]=O}return this};if(this.data===null){this.clear()}};var q=new J.buffer();A();var L=function(O,N){var M={};for(var p in O){M[p]=O[p]}for(var p in N){M[p]=N[p]}return M};var y=function(M,p){return Math.floor(Math.random()*(p-M+1))+M};var z=function(M,p){return Math.random()*(p-M)+M};var h=function(p,M){if(typeof p=="object"){if(M!=undefined){p=z(p[0],p[1])}else{p=y(p[0],p[1])}}return p};var o=function(p){if(p===undefined){p=1}if(p===true){p=0.5+(Math.random()/2)}return[y(0,255),y(0,255),y(0,255),p]};var x=function(){return b(J.blends)};var b=function(N){var M=N.length;var p=y(0,M-1);return N[p]};var u=function(N){var p;var M=0;for(var O in N){if(Math.random()<1/++M){p=O}}return p};J.defaults={fill:{blend:"opacity",rgba:[128,128,228,1]},merge:{blend:"opacity",opacity:0.5},noise:{blend:"random",mode:"monochrome",opacity:0.5},colorize:{level:50,rgb:"random"},vibrance:{adjust:50},contrast:{adjust:50},threshold:{threshold:96},invert:{},brightness:{adjust:50,legacy:true},waves:{blend:"random",level:50},crosshatch:{blend:"random",level:50},circles:{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15]},spheres:{blend:"lighten",rgba:"random",origin:"random",dynamic:false,count:21,size:[20,70]},pyramids:{blend:"lighten",rgba:"random",origin:"random",dynamic:false,count:21,size:[21,100]},squares:{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50]},map:{xamount:[5,255],yamount:[5,255],xchannel:[0,3],ychannel:[0,3],xlayer:0,ylayer:0},lines:{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},lines2:{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[0.1,11],count:[4,21]},clouds:{blend:"opacity",rgba:"random",seed:[1,65535],roughness:[2,16]}};var F=function(p){if(p==="random"){p=o(true)}if(typeof p[0]=="object"){p[0]=y(p[0][0],p[0][1])}if(typeof p[1]=="object"){p[1]=y(p[1][0],p[1][1])}if(typeof p[2]=="object"){p[2]=y(p[2][0],p[2][1])}if(typeof p[3]=="object"){p[3]=z(p[3][0],p[3][1])}return p};var e=function(M,O,N){if(O===undefined){O=L({},J.defaults[M])}else{O=L(J.defaults[M],O)}if(N!==undefined){O=N(O)}if(typeof O.count=="object"){O.count=y(O.count[0],O.count[1])}if(O.blend==="random"){O.blend=x()}if(typeof O.blend=="object"){var p=O.blend.length;O.blend=O.blend[y(0,p-1)]}if(O.blend!==undefined){w.blend=O.blend}else{w.blend=""}if(O.rgba){O.rgba=F(O.rgba);w.rgba=[O.rgba[0],O.rgba[1],O.rgba[2],O.rgba[3]]}if(O.rgb){O.rgb=F(O.rgb);w.rgba=[O.rgb[0],O.rgb[1],O.rgb[2],1]}return O};var l=function(p,M){if(G){console.log(g,p,M)}};var c=function(p,M){C.push([g,p,M]);l(p,M)};var I={rect:function(N,R,M,Q,P){if(P!==undefined){N=N-parseInt(M/2);R=R-parseInt(Q/2)}for(var O=0;O<M;O++){for(var p=0;p<Q;p++){w.set(N+O,R+p)}}},circle:function(O,Q,M,N){if(N==undefined){O=O+M;Q=Q+M}for(var p=-M;p<M;p++){var P=parseInt(Math.sqrt(M*M-p*p));for(var R=-P;R<P;R++){w.set(O+p,Q+R)}}},line:function(M,R,p,Q){var O=Math.sqrt((p-M)*(p-M)+(Q-R)*(Q-R));var U=(p-M)/O;var T=(Q-R)/O;var S=0;var P=0;for(var N=0;N<O;N++){S=M+(U*N);P=R+(T*N);w.set(S,P)}},sphere:function(p,U,Q,R,N,P){if(R==undefined){p=p+Q;U=U+Q}for(var V=-Q;V<Q;V++){var O=parseInt(Math.sqrt(Q*Q-V*V));for(var T=-O;T<O;T++){var S=Math.min(255,Math.max(0,(255-255*Math.sqrt((T*T)+(V*V))/(Q/2))));if(S>0){if(P){var M=(S/255)}else{var M=N[3]}w.rgba=[(N[0]/255)*S,(N[1]/255)*S,(N[2]/255)*S,M];w.set(p+V,U+T)}}}},pyramid:function(Y,W,N,p,U,S,T){var Z=parseInt(N/2);var X=parseInt(p/2);if(U!=true){Y=Y+Z;W=W+X}for(var P=-Z;P<Z;P++){for(var O=-X;O<X;O++){var R=(0.25-Math.abs(P/N))*255;var Q=(0.25-Math.abs(O/p))*255;var V=R+Q;if(T){var M=(V/255)}else{var M=S[3]}if(V>0){w.rgba=[(S[0]/255)*V,(S[1]/255)*V,(S[2]/255)*V,M];w.set(Y+P,W+O)}}}}};var i={luminance:function(p){return(0.21*p[0])+(0.72*p[1])+(0.07*p[2])},randomseed:function(M){if(this.seed==undefined){this.seed=y(1,65535)}if(M!==undefined){this.seed=M}var p=Math.sin(this.seed++)*10000;return p-Math.floor(p)},normalize:function(N,M,p){if(N>p){return p}if(N<M){return M}return N},interpolate:{linear:function(N,M,p){return N*(1-p)+M*p},cosine:function(N,M,p){ft=p*3.1415927;f=(1-Math.cos(ft))*0.5;return N*(1-f)+M*f}}};var k=function(p){return p&(a-1)};var j=function(p){return p&(d-1)};var w={rgba:[0,0,0,1],mixed:[0,0,0,1],blend:"opacity",normalize:function(p){p[0]=Math.round(p[0]);p[1]=Math.round(p[1]);p[2]=Math.round(p[2]);return p},colorize:function(M,p,N){if(N===undefined){N=50}return[M[0]-(M[0]-p[0])*(N/100),M[1]-(M[1]-p[1])*(N/100),M[2]-(M[2]-p[2])*(N/100),p[3]?p[3]:0.5]},opacity:function(p,M){if(p[3]>1){p[3]=p[3]/255}if(p[3]==1){return[p[0],p[1],p[2],p[3]]}return[p[0]*(p[3])+M[0]*(1-p[3]),p[1]*(p[3])+M[1]*(1-p[3]),p[2]*(p[3])+M[2]*(1-p[3]),p[3]]},calc:function(p,N){switch(this.blend){case"opacity":var M=this.opacity(p,N);break;case"multiply":p[0]=(N[0]*p[0])/255;p[1]=(N[1]*p[1])/255;p[2]=(N[2]*p[2])/255;var M=this.opacity(p,N);break;case"screen":p[0]=255-(((255-N[0])*(255-p[0]))/255);p[1]=255-(((255-N[1])*(255-p[1]))/255);p[2]=255-(((255-N[2])*(255-p[2]))/255);var M=this.opacity(p,N);break;case"overlay":p[0]=(N[0]>128)?255-2*(255-p[0])*(255-N[0])/255:(N[0]*p[0]*2)/255;p[1]=(N[1]>128)?255-2*(255-p[1])*(255-N[1])/255:(N[1]*p[1]*2)/255;p[2]=(N[2]>128)?255-2*(255-p[2])*(255-N[2])/255:(N[2]*p[2]*2)/255;var M=this.opacity(p,N);break;case"difference":p[0]=Math.abs(p[0]-N[0]);p[1]=Math.abs(p[1]-N[1]);p[2]=Math.abs(p[2]-N[2]);var M=this.opacity(p,N);break;case"exclusion":p[0]=128-2*(N[0]-128)*(p[0]-128)/255;p[1]=128-2*(N[1]-128)*(p[1]-128)/255;p[2]=128-2*(N[2]-128)*(p[2]-128)/255;var M=this.opacity(p,N);break;case"darken":p[0]=(p[0]<N[0])?p[0]:N[0];p[1]=(p[1]<N[1])?p[1]:N[1];p[2]=(p[2]<N[2])?p[2]:N[2];var M=this.opacity(p,N);break;case"lighten":p[0]=(p[0]>N[0])?p[0]:N[0];p[1]=(p[1]>N[1])?p[1]:N[1];p[2]=(p[2]>N[2])?p[2]:N[2];var M=this.opacity(p,N);break;case"lineardodge":p[0]=N[0]+p[0];p[1]=N[1]+p[1];p[2]=N[2]+p[2];var M=this.opacity(p,N);break;case"linearlight":p[0]=N[0]+2*p[0]-255;p[1]=N[1]+2*p[1]-255;p[2]=N[2]+2*p[2]-255;var M=this.opacity(p,N);break;case"linearburn":p[0]=N[0]+p[0]-255;p[1]=N[1]+p[1]-255;p[2]=N[2]+p[2]-255;var M=this.opacity(p,N);break;case"softlight":p[0]=(N[0]>128)?255-((255-N[0])*(255-(p[0]-128)))/255:(N[0]*(p[0]+128))/255;p[1]=(N[1]>128)?255-((255-N[1])*(255-(p[1]-128)))/255:(N[1]*(p[1]+128))/255;p[2]=(N[2]>128)?255-((255-N[2])*(255-(p[2]-128)))/255:(N[2]*(p[2]+128))/255;var M=this.opacity(p,N);break;default:var M=[p[0],p[1],p[2],p[3]];break}return M},set:function(p,M){this.mixed=this.calc(this.rgba,this.get(p,M));q.set(p,M,this.mixed)},get:function(p,M){return q.get(p,M)}};var m=function(N){for(var p=0;p<a;p++){for(var O=0;O<d;O++){var M=w.get(p,O);M=N(M,p,O);w.rgba=M;w.set(p,O)}}};var D=function(M,p){return parseInt((M/100)*p)};var K=function(N,O){if(O.elements!=undefined){var p=O.elements[N].x;var P=O.elements[N].y;var M=O.elements[N].size}else{if(O.origin=="random"){var p=y(0,a);var P=y(0,d);var M=h(O.size)}else{var p=O.origin[0];var P=O.origin[1];var M=h(O.size)}}return{x:p,y:P,size:M}};J.merge=function(P){P=e("merge",P);if(B[P.layer]===undefined){return this}var M=B[P.layer].getContext("2d");var N=M.getImageData(0,0,a,d);var R=N.data;for(var Q=0;Q<d;Q++){for(var p=0;p<a;p++){var O=q.offset(p,Q);w.rgba=[R[O],R[O+1],R[O+2],R[O+3]];w.rgba[3]=(w.rgba[3]>1)?w.rgba[3]/255:w.rgba[3];w.set(p,Q)}}c("merge",P);return this};J.copy=function(M){var P=q.pixels();var p=B[M].getContext("2d");var N=p.getImageData(0,0,a,d);var O=N.data;while(P--){q.data[P]=O[P]}c("copy",M);return this};J.brightness=function(p){p=e("brightness",p);w.blend="";m(function(M){if(p.legacy===true){return[Math.min(M[0]+p.adjust,255),Math.min(M[1]+p.adjust,255),Math.min(M[2]+p.adjust,255),M[3]]}else{p.adjust=Math.pow((p.adjust+100)/100,2);return[((((M[0]/255)-0.5)*p.adjust)+0.5)*255,((((M[1]/255)-0.5)*p.adjust)+0.5)*255,((((M[2]/255)-0.5)*p.adjust)+0.5)*255,M[3]]}});c("brightness",p);return this};J.contrast=function(M){M=e("contrast",M);var p=(100+M.adjust)/100;w.blend="";m(function(N){N[0]=((((N[0]/255)-0.5)*p)+0.5)*255;N[1]=((((N[1]/255)-0.5)*p)+0.5)*255;N[2]=((((N[2]/255)-0.5)*p)+0.5)*255;return[Math.max(Math.min(N[0],255),0),Math.max(Math.min(N[1],255),0),Math.max(Math.min(N[2],255),0),N[3]]});c("contrast",M);return this};J.grayscale=function(p){if(!p){p="average"}w.blend="";switch(p){case"ligthness":m(function(M){var N=Math.max(M[0],M[1],M[2])+Math.min(M[0],M[1],M[2]);return[N,N,N,M[3]]});break;case"average":m(function(M){var N=(M[0]+M[1]+M[2])/3;return[N,N,N,M[3]]});break;case"luminosity":m(function(N){var M=i.luminance(N);return[M,M,M,N[3]]});break}c("grayscale",p);return this};J.colorize=function(p){p=e("colorize",p);w.blend="";m(function(M){return w.colorize(M,p.rgb,p.level)});c("colorize",p);return this};J.invert=function(){params=e("invert",{});w.blend="";m(function(p){return[255-p[0],255-p[1],255-p[2],p[3]]});c("invert",params);return this};J.threshold=function(p){params=e("threshold",{},function(M){if(p!==undefined){M.threshold=p}return M});w.blend="";m(function(M){var N=((0.2126*M[0])+(0.7152*M[1])+(0.0722*M[2])<=params.threshold)?0:255;return[N,N,N,1]});c("threshold",params);return this};J.vibrance=function(M){M=e("vibrance",M);var p=M.adjust*-1;w.blend="";m(function(O){var P=(O[0]+O[1]+O[2])/3;var N=Math.max(O[0],O[1],O[2]);var Q=((Math.abs(N-P)*2/255)*p)/100;if(O[0]!==N){O[0]+=(N-O[0])*Q}if(O[1]!==N){O[1]+=(N-O[1])*Q}if(O[2]!==N){O[2]+=(N-O[2])*Q}return[O[0],O[1],O[2],O[3]]});c("vibrance",M);return this};J.waves=function(M){M=e("waves",M,function(Q){if(Q.xsines===undefined){Q.xsines=y(1,10)}else{if(typeof Q.xsines=="object"){Q.xsines=y(Q.xsines[0],Q.xsines[1])}}if(Q.ysines===undefined){Q.ysines=y(1,10)}else{if(typeof Q.ysines=="object"){Q.ysines=y(Q.ysines[0],Q.ysines[1])}}if(Q.rgba===undefined){var P=(Q.opacity!==undefined)?Q.opacity:1;Q.rgba=F([[0,255],[0,255],[0,255],P])}return Q});for(var p=0;p<a;p++){for(var O=0;O<d;O++){var N=127+63.5*Math.sin(p/a*M.xsines*2*3.1415)+63.5*Math.sin(O/d*M.ysines*2*3.1415);if(typeof M.channels=="object"){w.rgba=[M.channels[0]?N:0,M.channels[1]?N:0,M.channels[2]?N:0,M.channels[3]?N:0]}else{w.rgba=w.colorize([N,N,N,1],M.rgba,M.level)}w.set(p,O)}}c("waves",M);return this};J.spheres=function(O){O=e("spheres",O);var M=[];for(var p=0;p<O.count;p++){var N=K(p,O);I.sphere(D(N.x,a),D(N.y,d),D(N.size,n),true,O.rgba,O.dynamic);M.push(N)}O.elements=M;c("spheres",O);return this};J.pyramids=function(O){O=e("pyramids",O);var M=[];for(var p=0;p<O.count;p++){var N=K(p,O);I.pyramid(D(N.x,a),D(N.y,d),D(N.size,n),D(N.size,n),true,O.rgba,O.dynamic);M.push(N)}O.elements=M;c("pyramids",O);return this};J.crosshatch=function(M){params=e("crosshatch",M,function(P){if(P.xadjust==undefined){P.xadjust=y(1,10)}if(P.yadjust===undefined){P.yadjust=y(1,10)}if(P.rgba===undefined){P.rgba=[y(0,255),y(0,255),y(0,255),1]}return P});for(var p=0;p<a;p++){for(var O=0;O<d;O++){var N=127+63.5*Math.sin(p*p/params.xadjust)+63.5*Math.cos(O*O/params.yadjust);w.rgba=w.colorize([N,N,N,1],params.rgba,params.level);w.set(p,O)}}c("crosshatch",params);return this};J.squares=function(O){O=e("squares",O);var M=[];for(var p=0;p<O.count;p++){var N=K(p,O);I.rect(D(N.x,a),D(N.y,d),D(N.size,n),D(N.size,n),false);M.push(N)}O.elements=M;c("squares",O);return this};J.circles=function(O){O=e("circles",O);var M=[];for(var p=0;p<O.count;p++){var N=K(p,O);I.circle(D(N.x,a),D(N.y,d),D(N.size,n),true);M.push(N)}O.elements=M;c("circles",O);return this};J.lines=function(Q){Q=e("lines",Q,function(R){R.freq1s=h(R.freq1s,true);R.freq1c=h(R.freq1c,true);R.freq2s=h(R.freq2s,true);R.freq2c=h(R.freq2c,true);R.size=h(R.size);return R});for(var O=0;O<Q.count;O++){var M=a/2+Math.sin(O/Q.freq1s*Math.PI)*Q.size;var P=d/2+Math.cos(O/Q.freq1c*Math.PI)*Q.size;var p=a/2+Math.sin(O/Q.freq2s*Math.PI)*Q.size;var N=d/2+Math.cos(O/Q.freq2c*Math.PI)*Q.size;I.line(M,P,p,N)}c("lines",Q);return this};J.lines2=function(O){O=e("lines2",O);var N=[];var M=null;for(var p=0;p<O.count;p++){if(O.elements!=undefined){M=O.elements[p]}else{M={size:h(O.size,true),d:z(0.1,100)}}if(O.type=="vertical"){I.rect(D(M.d,a),0,D(M.size,a),d)}else{I.rect(0,D(M.d,a),a,D(M.size,a))}N.push(M)}O.elements=N;c("lines2",O);return this};J.noise=function(N){N=e("noise",N);for(var p=0;p<a;p++){for(var O=0;O<d;O++){if(N.mode=="color"){w.rgba=[y(0,255),y(0,255),y(0,255),N.opacity]}else{var M=y(0,255);w.rgba=[M,M,M,N.opacity]}w.set(p,O)}}c("noise",N);return this};J.clouds=function(O){O=e("clouds",O,function(U){U.seed=h(U.seed);U.roughness=h(U.roughness);return U});var p=[];var M=function(){for(var U=0;U<=a;U++){p[U]=[];for(var V=0;V<=d;V++){p[U][V]=0}}};var T=function(U,W,V){if(U<0){U=a+U}if(U>=a){U=U-a}if(W<0){W=d+W}if(W>=d){W=W-d}if(V!==undefined){return p[U][W]=V}else{return p[U][W]}};var R=function(U){return(i.randomseed()-0.5)*(U/(a+a)*O.roughness)};var P=function(W){var af=W/2;if(af<=1){return}for(var Z=af-af;Z<=(a+af);Z+=af){for(var Y=af-af;Y<=(d+af);Y+=af){var ag=T(Z-af,Y-af);var X=T(Z,Y-af);var ac=T(Z-af,Y);var aa=T(Z,Y);var ae=Z-(af/2);var ad=Y-(af/2);var V=T(ae,ad,i.normalize((ag+X+ac+aa)/4+R(W),0,1));var U=Z-(W)+(af/2);T(Z-af,ad,i.normalize((ag+ac+V+T(U,ad))/4+R(W),0,1));var ab=Y-(W)+(af/2);T(ae,Y-af,i.normalize((ag+X+V+T(ae,ab))/4+R(W),0,1))}}P(af)};i.randomseed(O.seed);M();P(a);for(var S=0;S<a;S++){for(var Q=0;Q<d;Q++){var N=256*p[S][Q];w.rgba=w.colorize(O.rgba,[N,N,N,1]);w.set(S,Q)}}c("clouds",O);return this};J.map=function(Q){Q=e("map",Q,function(ac){ac.xamount=h(ac.xamount);ac.yamount=h(ac.yamount);ac.xchannel=h(ac.xchannel);ac.ychannel=h(ac.ychannel);ac.xlayer=h(ac.xlayer);ac.ylayer=h(ac.ylayer);return ac});var V=new J.buffer();var W=B[Q.xlayer].getContext("2d");var p=W.getImageData(0,0,a,d);var R=p.data;var S=B[Q.ylayer].getContext("2d");var U=S.getImageData(0,0,a,d);var ab=U.data;for(var aa=0;aa<a;aa++){for(var Y=0;Y<d;Y++){var T=q.offset(aa,Y);var Z=R[T+Q.xchannel];var X=ab[T+Q.ychannel];if((a%16)==0){var N=k(aa+((Z*Q.xamount*a)>>16))}else{var N=aa+((Z*Q.xamount*a)/(a*a))}if((d%16)==0){var M=j(Y+((X*Q.yamount*d)>>16))}else{var M=Y+((X*Q.yamount*d)/(d*d))}var P=w.get(N,M);V[T]=P[0];V[T+1]=P[1];V[T+2]=P[2];V[T+3]=P[3]}}var O=q.pixels();while(O--){q.data[O]=V[O]}c("map",Q);return this};J.test=function(){a=200;d=200;w.blend="opacity";w.rgba=[255,255,155,1];I.rect(1,1,a-2,d-2);var p=20;w.rgba=[0,150,0,0.6];I.rect(2,2,p,p);I.rect(a-p-2,2,p,p);I.rect(2,d-2-p,p,p);I.rect(a-2-p,d-2-p,p,p);w.rgba=[20,20,10,0.2];I.rect(a/2,d/2,178,178,true);w.rgba=[10,20,210,0.7];I.rect(a-5,d-5,10,10);var p=20;w.rgba=[0,0,0,1];I.line(p,p,a-p,d-p);I.line(a-p,p,p,d-p);I.line(0,d/2,a,d/2);I.line(a/2,0,a/2,d);w.rgba=[255,55,55,0.5];I.rect(10,10,a-20,d-20);w.rgba=[0,0,255,0.3];I.rect(a-2,d-2,4,4);w.rgba=[255,255,255,1];w.set(0,0);w.set(a-1,0);w.set(0,d-1);w.set(a-1,d-1);w.rgba=[25,25,0,0.2];I.circle(a/4,d/4,a/4,true);w.rgba=[255,255,0,0.1];I.circle(a,d,a,true);this.brightness(50,true);this.vibrance(100);this.contrast(20);return this};J.fill=function(p){e("fill",p);I.rect(1,1,a,d);c("fill",p);return this};J.toContext=function(M){var O=M.createImageData(a,d);var N=O.data;var P=q.pixels();for(var p=0;p<P;p+=4){N[p]=q.data[p];N[p+1]=q.data[p+1];N[p+2]=q.data[p+2];N[p+3]=255}return O};J.toCanvas=function(){var p=document.createElement("canvas");p.width=a;p.height=d;var M=p.getContext("2d");var N=this.toContext(M);M.putImageData(N,0,0);return p};J.getCanvas=function(p){if(p){p(B[B.length-1])}return this};J.getPhases=function(O){if(O){var p=[];var N=B.length;for(var M=0;M<N;M++){p.push(B[M])}O(p)}return this};J.stat=function(p){E.stop=new Date().getTime();E.elapsed=(E.stop-E.start)/1000;if(p){p(E)}return this};J.history={available:function(){try{return"localStorage" in window&&window.localStorage!==null&&window.localStorage!==undefined}catch(p){return false}},list:function(){if(!this.available()){return[]}return JSON.parse(localStorage.getItem(s))||[]},last:function(){if(!this.available()){return[]}return v[v.length-1]},get:function(p){if(!this.available()){return[]}if(!v[p]){return null}return v[p]},add:function(p){if(!t){return}if(!this.available()){return[]}var M=J.params(p);v=JSON.parse(localStorage.getItem(s))||[];if(v.length>=t){v.shift()}v.push(M);localStorage.setItem(s,JSON.stringify(v))}};J.params=function(p){if(p==undefined){var O=new Date();var M=C.length;var N=B.length;p=O.getHours()+":"+O.getMinutes()+":"+O.getSeconds()+" l"+N+" i"+M}return{name:p,version:H,width:a,height:d,items:C}};J.render=function(N,M){var Q=0;if(N.width!=undefined){a=N.width}if(N.height!=undefined){d=N.height}r();q=new J.buffer();if(M!=true){A()}for(var O in N.items){g=N.items[O][0];var P=N.items[O][1];var p=N.items[O][2];if(P=="random"){P=u(J.defaults)}if(typeof P=="object"){P=b(P)}if(Q!=g){if(B[g]!=undefined){q.canvas(B[g])}else{q.clear()}Q=g}switch(P){default:if(J[P]==undefined){console.warn("undefined effect: "+P)}else{J[P](p)}break}B[g]=J.toCanvas()}J.history.add();return this};return J};