<html>
<head>
    <link type="text/css" rel="stylesheet" media="all" href="tgen.css"/>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.8/ace.js" type="text/javascript"></script>
    <script src="tgen.min.js"></script>
</head>
<body>

<script type="text/javascript" id="3waves" class="preset" name="3 random waves">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "waves"],
            [0, "waves", {"blend": "difference", "xsines": [1, 3], "ysines": [1, 4]}],
            [0, "waves", {"blend": "linearburn", "xsines": [1, 3], "ysines": [1, 4]}],
            [0, "brightness", {"adjust": 80, "legacy": true}],
            [0, "vibrance", {"adjust": 20}]
        ]
    }
</script>
<script type="text/javascript" id="4waves" class="preset" name="4 random waves">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "waves"],
            [0, "waves", {"blend": "softlight"}],
            [0, "waves", {"blend": "difference"}],
            [0, "waves", {"blend": "linearburn"}],
            [0, "brightness", {"adjust": 40, "legacy": true}],
            [0, "vibrance", {"adjust": 10}]
        ]
    }
</script>
<script type="text/javascript" id="5waves" class="preset" name="5 random waves">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "waves"],
            [0, "waves", {"blend": "difference"}],
            [0, "waves", {"blend": "linearburn"}],
            [0, "waves", {"blend": "difference"}],
            [0, "waves", {"blend": "linearburn"}],
            [0, "brightness", {"adjust": 10, "legacy": true}],
            [0, "vibrance", {"adjust": 10}]
        ]
    }
</script>

<script type="text/javascript" id="bubbles" class="preset" name="bubbles">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "circles", {"blend": "lighten"}],
            [0, "circles", {"blend": "lighten"}],
            [0, "circles", {"blend": "lighten"}]
        ]
    }
</script>

<script type="text/javascript" id="circles" class="preset" name="circles">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "circles", {
                "blend": "opacity",
                "count": 7,
                "origin": [200, 200],
                "sizeMin": 2,
                "sizeMax": 100,
                "rgba": [
                    [1, 255],
                    [1, 255],
                    [1, 255],
                    [0.05, 0.15]
                ]
            }],
            [0, "circles", {
                "blend": "lighten",
                "count": 7,
                "origin": [200, 200],
                "sizeMin": 2,
                "sizeMax": 50,
                "rgba": [
                    [1, 255],
                    [1, 255],
                    [1, 255],
                    [0.05, 0.15]
                ]
            }],
            [0, "brightness", {"adjust": -10, "legacy": true}],
            [0, "vibrance", {"adjust": 50}],
            [1, "copy", 0],
            [1, "contrast", {"adjust": 50}]
        ]
    }
</script>

<script type="text/javascript" id="squares" class="preset" name="squares">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "squares", {
                "blend": "opacity",
                "count": 7,
                "origin": [200, 200],
                "sizeMin": 2,
                "sizeMax": 200,
                "rgba": [
                    [1, 255],
                    [1, 255],
                    [1, 255],
                    [0.05, 0.15]
                ]
            }],
            [0, "squares", {
                "blend": "lighten",
                "count": 7,
                "origin": [200, 200],
                "sizeMin": 2,
                "sizeMax": 100,
                "rgba": [
                    [1, 255],
                    [1, 255],
                    [1, 255],
                    [0.05, 0.15]
                ]
            }],
            [0, "brightness", {"adjust": -10, "legacy": true}],
            [0, "vibrance", {"adjust": 50}],
            [1, "copy", 0],
            [1, "contrast", {"adjust": 50}]
        ]
    }
</script>

<script type="text/javascript" id="crosshatch" class="preset" name="crosshatch">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "crosshatch", {"blend": "opacity", "opacity": 0.5}],
            [0, "waves", {"blend": "difference"}],
            [0, "brightness", {"adjust": 20, "legacy": true}],
            [0, "contrast", {"adjust": 10}],
            [0, "vibrance", {"adjust": 100}]
        ]
    }
</script>

<script type="text/javascript" id="mergetest" class="preset" name="mergetest">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "waves", {"blend": ""}],
            [1, "waves", {"blend": ""}],
            [2, "circles", {
                "blend": "opacity",
                "count": 7,
                "origin": [200, 200],
                "sizeMin": 2,
                "sizeMax": 100,
                "rgba": [
                    [1, 255],
                    [1, 255],
                    [1, 255],
                    [0.1, 0.2]
                ]
            }],
            [3, "merge", [
                [0],
                [1, "difference"],
                [2, "difference"]
            ]],
            [3, "brightness", {"adjust": 10, "legacy": true}],
            [3, "vibrance", {"adjust": 10}],
            [3, "contrast", {"adjust": 20}]
        ]
    }
</script>

<script type="text/javascript" id="lines" class="preset" name="lines (under dev)">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "lines", {"blend": "lighten", "count": 200}],
            [0, "lines", {"blend": "lighten", "count": 200}]
        ]
    }
</script>
<script type="text/javascript" id="test" class="preset" name="test">
    var params = {
        "width": 200,
        "height": 200,
        "items": [
            [0, "test"]
        ]
    }
</script>

<div class="menu unselectable">
    <br/>
    tgen 0.1 on <a target="_blank" href="https://github.com/schalkt/tgen">github</a>
    <br/>
    <br/>
    <i>The seamless <br/>texture generator</i>
    <br/><br/>
    &copy; 2015<br/>
    <a target="_blank" href="https://github.com/schalkt/">tamas.schalk</a><br/>
    <br/>

    <div class="generate button">Generate</div>
    <select id="presets">
        <option>select preset</option>
    </select>

    <div class="editor button">Editor on/off</div>
    <!--<div class="edit button">Params to editor</div>-->
    <!--<div class="save button">Save params</div>-->
    <br/>
    <br/>

    <div class="info">rendered: <span class="rendercount"></span></div>
    <div class="info">render time: <span class="rendertime"></span></div>
    <div class="info">average time: <span class="averagetime"></span></div>
    <br/>

    LAYERS
    <br/><br/>

    <div class="phases"></div>
    <br/>
    <i>right click on the image and save/copy in original size</i>
</div>


<div id="panel">
    <div id="editor"></div>
</div>

<script>

    var texture = tgen();

    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.$blockScrolling = Infinity;
    editor.getSession().setMode("ace/mode/javascript");


    $('.editor').on('click', function () {
        $('#panel').toggleClass('show');
    });

    $('.generate').on('click', function () {
        generate();
    });

    $('#presets').on('change', function (v) {
        paramsToEditor($(this).val());
    });


    $('.save').on('click', function () {

        var params = texture.save();
        var date = new Date().toLocaleString();
        //var dateString = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDay();

        localStorage.setItem(date, params);

        console.log(params);

    });


    $('.preset').each(function () {
        var id = $(this).attr('id');
        var name = $(this).attr('name');
        $('#presets').append($("<option></option>").attr("value", id).text(name));

    });

    var loadLocalStore = function () {


    }


    var paramsToEditor = function (id) {
        editor.setValue($('#' + id).text());
    }

    var editorToParams = function () {

        var params = editor.getValue();
        return params.replace(/(var\sparams\s=\s|\s|\r\n|\r|\n)/gm, "");

    }


    var times = [];
    var count = 0;


    var generate = function () {

        $('.phases').html('');

        texture.params(JSON.parse(editorToParams()));

        texture.stat(function (time) {

            times.push(time.elapsed);
            var sum = 0;

            for (key in times) {
                sum += times[key];
            }

            $('.rendercount').text(++count);
            $('.rendertime').text(time.elapsed);
            $('.averagetime').text(Math.round((sum / times.length) * 100) / 100);

        });

        texture.getCanvas(function (canvas) {
            $('body').css('background-image', 'url(' + canvas.toDataURL("image/png") + ')');
        });

        texture.getPhases(function (phases) {

            for (var key in phases) {

                var img = $('<img>');
                img.attr('src', phases[key].toDataURL("image/png"));
                img.appendTo('body .phases');

            }

        });

        // one line mode :)
        //var canvas = tgen(200).waves().waves({blend: 'difference'}).contrast({"adjust": 50}).toCanvas();
        //$('body').css('background-image', 'url(' + canvas.toDataURL("image/png") + ')');


    };

    //$('#presets').val('squares');
    paramsToEditor('squares');
    generate();

</script>

</body>
</html>
