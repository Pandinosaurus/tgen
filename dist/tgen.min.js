/*
 tgen.js - the seamless texture generator
 https://github.com/schalkt/tgen/
 http://texture-generator.com/

 Copyright (c) 2015 Tamas Schalk
 MIT license

 @version 0.6.0
*/
(function(g){window[g]={version:"0.6.0",defaults:{},effects:{},blends:{},shapes:{},colormaps:{},events:{beforeEffect:{},afterEffect:{},beforeRender:{},afterRender:{}},config:{historyLast:15,historyName:"history",historyList:[]},effect:function(c,a,b){this.defaults[c]=a;this.effects[c]=b},event:function(c,a,b){void 0!=this.events[c]&&(this.events[c][a]=b)},blend:function(c,a){this.blends[c]=a},shape:function(c,a){this.shapes[c]=a},colormap:function(c,a){this.colormaps[c]=a},init:function(c,a,b){var d=
this,f=[],h={},l=0,g=null,e={shape:d.shapes,effects:Object.keys(d.effects),layers:[],normalize:b?b:"limitless"},k=function(){void 0==c&&(c=256);1>c&&(c=256);1>a&&(a=256);2048<c&&(c=2048);2048<a&&(a=2048);void 0==a&&(a=c);g=(c+a)/2};k();e.clear=function(){e.texture.clear();e.layers=[];f=[];l=0;h.start=(new Date).getTime();return e};e.buffer=function(b){this.data=null;this.components=4;this.width=c;this.height=a;this.wha=(this.width+this.height)/2;this.background=[0,0,0,255];"object"==typeof b&&(this.background=
b);this.pixels=function(){return this.width*this.height};this.size=function(){return this.data.length};this.export=function(){var a=this.size();switch(e.normalize){case "limitless":for(var b=new Float32Array(a);a--;)b[a]=this.data[a];break;case "clamped":for(b=new Uint8ClampedArray(a);a--;)b[a]=this.data[a];break;case "pingpong":for(b=new Uint8ClampedArray(a);a--;)b[a]=e.calc.pingpong(this.data[a],0,255)}return b};this.clear=function(a){this.data=new Float32Array(this.width*this.height*this.components);
void 0==a&&(a=this.background);for(var b=this.size();b;)this.data[b-1]=a[3],this.data[b-2]=a[2],this.data[b-3]=a[1],this.data[b-4]=a[0],b-=this.components};this.pattern=function(a,b){var c=a/b;if(a>=b)return c=Math.floor(c)*b,a-c;if(0>a)return c=Math.ceil(c)*b,a=b-Math.abs(a-c),a>=b&&(a-=b),a};this.offset=function(a,b){a=Math.round(a);b=Math.round(b);if(0>a||a>=this.width)a=this.pattern(a,this.width);if(0>b||b>=this.height)b=this.pattern(b,this.height);return b*this.width*this.components+a*this.components};
this.set=function(a,b,c){a=this.offset(a,b);this.data[a]=c[0];this.data[a+1]=c[1];this.data[a+2]=c[2];this.data[a+3]=c[3]};this.get=function(a,b){a=this.offset(a,b);return[this.data[a],this.data[a+1],this.data[a+2],this.data[a+3]]};this.canvas=function(a){var b=this.size();for(a=a.getContext("2d").getImageData(0,0,this.width,this.height).data;b--;)e.texture.data[b]=a[b]};null===this.data&&this.clear()};e.texture=new e.buffer;e.layerCopy=function(a){var b=[];a=this.layers[a];for(var c=a.length;c--;)b[c]=
a[c];return b};var p=function(a,b){var c={},m;for(m in a)c[m]=a[m];for(m in b)c[m]=b[m];return c};e.clone=function(a,b){for(var c in b)"object"===typeof b[c]&&null!==b[c]&&a[c]?this.clone(a[c],b[c]):a[c]=b[c]};e.randInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};e.randIntSeed=function(a,b){return Math.floor(e.calc.randomseed()*(b-a+1))+a};e.randReal=function(a,b){return Math.random()*(b-a)+a};e.randRealSeed=function(a,b){return e.calc.randomseed()*(b-a)+a};e.randByArray=function(a,
b){"object"==typeof a&&(a=void 0!=b?e.randReal(a[0],a[1]):e.randInt(a[0],a[1]));return a};e.randByArraySeed=function(a,b){"object"==typeof a&&(a=void 0!=b?e.randRealSeed(a[0],a[1]):e.randIntSeed(a[0],a[1]));return a};var q=function(a){void 0===a&&(a=255);!0===a&&(a=128+e.randInt(0,128));return[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),a]};e.randItem=function(a){var b=e.randInt(0,a.length-1);return a[b]};var t=function(a){var b,c=0,m;for(m in a)Math.random()<1/++c&&(b=m);return b};e.rgba=
function(a,b){if("random"===a)return q(b);if("randomalpha"===a)return q(!0);"object"==typeof a[0]&&(a[0]=e.randInt(a[0][0],a[0][1]));"object"==typeof a[1]&&(a[1]=e.randInt(a[1][0],a[1][1]));"object"==typeof a[2]&&(a[2]=e.randInt(a[2][0],a[2][1]));"object"==typeof a[3]&&(a[3]=e.randInt(a[3][0],a[3][1]));0!==a[3]%1&&(a[3]=Math.round(255*a[3]));1==a[3]&&(a[3]=255);return a};e.findClosestIndex=function(a,b,c){for(;0<=b&&b<=a.length-1;b+=c)if(a[b])return b;return a.length-1};e.calc={pi:3.1415927,luminance:function(a){return.21*
a[0]+.72*a[1]+.07*a[2]},randomseed:function(a){void 0==this.seed&&(this.seed=e.randInt(1,262140));void 0!==a&&(this.seed=a);a=1E4*Math.sin(this.seed++);return a-Math.floor(a)},normalize1:function(a){return e.calc.normalize(a,0,1)},normalize:function(a,b,c){return a>c?c:a<b?b:a},pingpong:function(a,b,c){return a>c?c-(a-c):a<b?Math.abs(a):a},interpolate:{linear:function(a,b,c){return a*(1-c)+b*c},cosine:function(a,b,c){c=.5*(1-Math.cos(c*e.calc.pi));return a*(1-c)+b*c},catmullrom:function(a,b,c,d,e,
f){e/=f;d=d-c-(a-b);a=d*e*e*e+(a-b-d)*e*e+(c-a)*e+b;0>a&&(a=0);1<a&&(a=1);return a}}};e.colormap={data:null,size:255,init:function(a,b,f){this.data=null;this.size=void 0==b?c:b;if(void 0==a||null==a)return a;if("object"==typeof a)if("object"==typeof a[0])for(key in a){var m=a[key];m.rgba=e.rgba(m.rgba);a[key]=m}else a=e.randItem(a);if("random"===a){m=e.randInt(1,4);a=[];for(var r=0;r<=m;r++)a[r]={percent:parseInt(r/m*100),rgba:[e.randInt(0,255),e.randInt(0,255),e.randInt(0,255),255]}}"function"==
typeof f&&f(a);"string"==typeof a&&(f=!1,"!"==a.charAt(0)&&(a=a.substring(1),f=!0),"function"==typeof d.colormaps[a]&&(b=d.colormaps[a](b),this.data=this.render(b,f)));"object"==typeof a&&(this.data=this.render(a))},render:function(a,b){for(var c=[],d=0;d<a.length-1;d++)for(var e=a[d],m=a[d+1],r=Math.round(e.percent/100*this.size),f=Math.round(m.percent/100*this.size),h=r;h<=f;h++)c[b?this.size-h:h]=[e.rgba[0]+(h-r)/(f-r)*(m.rgba[0]-e.rgba[0]),e.rgba[1]+(h-r)/(f-r)*(m.rgba[1]-e.rgba[1]),e.rgba[2]+
(h-r)/(f-r)*(m.rgba[2]-e.rgba[2]),e.rgba[3]+(h-r)/(f-r)*(m.rgba[3]-e.rgba[3])];return c},get:function(a,b){if(void 0==a)return this.data;a=e.calc.pingpong(parseInt(a),0,this.size);a=this.data[a];void 0!==b&&(a[3]=b[3]);return a}};e.wrapx=function(a){return a&c-1};e.wrapy=function(b){return b&a-1};e.point={rgba:[],mixed:[],blend:"opacity",colorize:function(a,b,c){void 0===c&&(c=50);return[a[0]-c/100*(a[0]-b[0]),a[1]-c/100*(a[1]-b[1]),a[2]-c/100*(a[2]-b[2]),b[3]?b[3]:255]},opacity:function(a,b){if(255==
a[3])return a[3]=b[3],a;if(0==b[3])return b;var c=a[3]/255;return[a[0]*c+b[0]*(1-c),a[1]*c+b[1]*(1-c),a[2]*c+b[2]*(1-c),b[3]]},set:function(a,b){var c=e.texture.get(a,b);void 0!==d.blends[this.blend]?(this.rgba=d.blends[this.blend](e,c,this.rgba),this.mixed=this.opacity(this.rgba,c)):this.mixed=this.rgba;switch(e.normalize){case "clamped":this.mixed[0]=Math.max(0,Math.min(255,this.mixed[0]));this.mixed[1]=Math.max(0,Math.min(255,this.mixed[1]));this.mixed[2]=Math.max(0,Math.min(255,this.mixed[2]));
this.mixed[3]=Math.max(0,Math.min(255,this.mixed[3]));break;case "pingpong":this.mixed[0]=e.calc.pingpong(this.mixed[0],0,255),this.mixed[1]=e.calc.pingpong(this.mixed[1],0,255),this.mixed[2]=e.calc.pingpong(this.mixed[2],0,255),this.mixed[3]=e.calc.pingpong(this.mixed[3],0,255)}e.texture.set(a,b,this.mixed)},get:function(a,b,c){return e.texture.get(a,b)}};e.walk=function(b){for(var d=0;d<c;d++)for(var f=0;f<a;f++){var m=e.point.get(d,f);m=b(m,d,f);e.point.rgba=m;e.point.set(d,f)}};e.percent=function(a,
b){return parseInt(a/100*b,10)};e.percentX=function(a){return parseInt(a/100*c,10)};e.percentY=function(b){return parseInt(b/100*a,10)};e.percentXY=function(a){return parseInt(a/100*g,10)};e.xysize=function(b,d){if(void 0!=d.elements){var f=d.elements[b].x,m=d.elements[b].y;b=d.elements[b].size}else"random"==d.origin?(f=e.randIntSeed(0,c),m=e.randIntSeed(0,a)):(f=d.origin[0],m=d.origin[1]),b=e.randByArraySeed(d.size);return{x:f,y:m,size:b}};e.toContext=function(b,d){b=b.createImageData(c,a);for(var e=
b.data,f=d.length,m=0;m<f;m+=4)e[m]=d[m],e[m+1]=d[m+1],e[m+2]=d[m+2],e[m+3]=d[m+3];return b};e.toCanvas=function(b){void 0==b&&(b=e.texture.data);var d=document.createElement("canvas");d.width=c;d.height=a;var f=d.getContext("2d");b=this.toContext(f,b);f.putImageData(b,0,0);return d};e.getCanvas=function(a){if(a){var b=this.toCanvas(this.layers[this.layers.length-1]);a(b)}return this};e.getPhases=function(a){if(a){for(var b=[],c=e.layers.length,d=0;d<c;d++)b.push(this.toCanvas(this.layers[d]));a(b)}return this};
e.stat=function(a){h.stop=(new Date).getTime();h.elapsed=(h.stop-h.start)/1E3;a&&a(h);return this};e.history={available:function(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(m){return!1}},list:function(){return this.available()?JSON.parse(window.localStorage.getItem(d.config.historyName))||[]:[]},last:function(){return this.available()?d.config.historyList[d.config.historyList.length-1]:[]},get:function(a){return this.available()?d.config.historyList[a]?
d.config.historyList[a]:null:[]},add:function(a){if(d.config.historyLast){if(!this.available())return[];a=e.params(a);d.config.historyList=JSON.parse(window.localStorage.getItem(d.config.historyName))||[];d.config.historyList.length>=d.config.historyLast&&d.config.historyList.shift();d.config.historyList.push(a);window.localStorage.setItem(d.config.historyName,JSON.stringify(d.config.historyList))}}};e.params=function(b){void 0==b&&(b=new Date,b=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+
" l"+e.layers.length+" i"+f.length);return{name:b,version:d.version,width:c,height:a,normalize:e.normalize,items:f}};e.render=function(b,f){e.event("beforeRender",b);var h=0;void 0!=b.width&&(c=b.width);void 0!=b.height&&(a=b.height);e.normalize=void 0!=b.normalize?b.normalize:"limitless";k();e.texture=new e.buffer(b.background);1!=f&&e.clear();for(var g in b.items){l=b.items[g][0];f=b.items[g][1];var m=b.items[g][2];"random"==f&&(f=t(e.defaults));"object"==typeof f&&(f=e.randItem(f));h!=l&&(void 0!=
e.layers[l]?e.texture.data=e.layers[l]:e.texture.clear(),h=l);if(void 0!=e[f])e[f](m);else void 0!=d.effects[f]?e.do(f,m):console.warn("undefined effect: "+f);e.layers[l]=e.texture.export()}e.event("afterRender",e.params());e.history.add();return this};e.event=function(a,b){for(var c in d.events[a]){var f=d.events[a][c];"function"==typeof f&&f(e,b)}};e.do=function(a,b){var c=b;void 0===b?b=p({},d.defaults[a]):"object"==typeof b&&(b=p(d.defaults[a],b));"object"==typeof b.count&&(b.count=e.randInt(b.count[0],
b.count[1]));"random"===b.blend&&(b.blend=t(d.blends));"object"==typeof b.blend&&(b.blend=b.blend[e.randInt(0,b.blend.length-1)]);e.point.blend=void 0!==b.blend?b.blend:"";b.rgba&&(b.rgba=e.rgba(b.rgba),e.point.rgba=[b.rgba[0],b.rgba[1],b.rgba[2],b.rgba[3]]);b.rgb&&(b.rgb=e.rgba(b.rgb),e.point.rgba=[b.rgb[0],b.rgb[1],b.rgb[2],255]);e.event("beforeEffect",{layer:l,name:a,params:b});"function"==typeof d.effects[a]?b=d.effects[a](e,b):console.warn("effect not callable: "+a);void 0===b&&(b=c);e.event("afterEffect",
{layer:l,name:a,params:b});!1!==b.store&&f.push([l,a,b]);return e};return e}}})("tgen");(function(g){g=window[g];g.colormap("blackwhite",function(){return[{percent:0,rgba:[0,0,0,255]},{percent:25,rgba:[255,255,255,255]},{percent:50,rgba:[0,0,0,255]},{percent:75,rgba:[255,255,255,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("dawn",function(){return[{percent:0,rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,128,255]},{percent:75,rgba:[128,0,128,255]},{percent:100,rgba:[0,0,128,255]}]});g.colormap("dusk",function(){return[{percent:0,rgba:[255,
255,255,255]},{percent:25,rgba:[255,128,255,255]},{percent:50,rgba:[128,0,255,255]},{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("kryptonite",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,0,255]},{percent:75,rgba:[0,128,0,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("ice",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[128,255,255,255]},{percent:50,rgba:[0,128,255,255]},
{percent:75,rgba:[0,0,128,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("fire",function(){return[{percent:0,rgba:[255,255,255,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[255,128,0,255]},{percent:75,rgba:[128,0,0,255]},{percent:100,rgba:[0,0,0,255]}]});g.colormap("redblue",function(){return[{percent:0,rgba:[96,0,0,255]},{percent:25,rgba:[192,0,0,255]},{percent:50,rgba:[255,255,255,255]},{percent:75,rgba:[0,0,192,255]},{percent:100,rgba:[0,0,96,255]}]});g.colormap("seashore",function(){return[{percent:0,
rgba:[255,255,192,255]},{percent:25,rgba:[255,255,128,255]},{percent:50,rgba:[128,255,128,255]},{percent:75,rgba:[0,128,128,255]},{percent:100,rgba:[0,0,128,255]}]})})("tgen");(function(g){g=window[g];g.blend("opacity",function(c,a,b){return b});g.blend("multiply",function(c,a,b){b[0]=a[0]*b[0]/255;b[1]=a[1]*b[1]/255;b[2]=a[2]*b[2]/255;return b});g.blend("linearburn",function(c,a,b){b[0]=a[0]+b[0]-255;b[1]=a[1]+b[1]-255;b[2]=a[2]+b[2]-255;return b});g.blend("difference",function(c,a,b){b[0]=Math.abs(b[0]-a[0]);b[1]=Math.abs(b[1]-a[1]);b[2]=Math.abs(b[2]-a[2]);return b});g.blend("difference-invert",function(c,a,b){b[0]=255-Math.abs(b[0]-a[0]);b[1]=255-Math.abs(b[1]-a[1]);
b[2]=255-Math.abs(b[2]-a[2]);return b});g.blend("screen",function(c,a,b){b[0]=255-(255-a[0])*(255-b[0])/255;b[1]=255-(255-a[1])*(255-b[1])/255;b[2]=255-(255-a[2])*(255-b[2])/255;return b});g.blend("overlay",function(c,a,b){b[0]=128<a[0]?255-2*(255-b[0])*(255-a[0])/255:a[0]*b[0]*2/255;b[1]=128<a[1]?255-2*(255-b[1])*(255-a[1])/255:a[1]*b[1]*2/255;b[2]=128<a[2]?255-2*(255-b[2])*(255-a[2])/255:a[2]*b[2]*2/255;return b});g.blend("exclusion",function(c,a,b){b[0]=128-2*(a[0]-128)*(b[0]-128)/255;b[1]=128-
2*(a[1]-128)*(b[1]-128)/255;b[2]=128-2*(a[2]-128)*(b[2]-128)/255;return b});g.blend("darken",function(c,a,b){b[0]=b[0]<a[0]?b[0]:a[0];b[1]=b[1]<a[1]?b[1]:a[1];b[2]=b[2]<a[2]?b[2]:a[2];return b});g.blend("lighten",function(c,a,b){b[0]=b[0]>a[0]?b[0]:a[0];b[1]=b[1]>a[1]?b[1]:a[1];b[2]=b[2]>a[2]?b[2]:a[2];return b});g.blend("lineardodge",function(c,a,b){b[0]=a[0]+b[0];b[1]=a[1]+b[1];b[2]=a[2]+b[2];return b});g.blend("lineardodge-invert",function(c,a,b){b[0]=255-(b[0]+a[0]);b[1]=255-(b[1]+a[1]);b[2]=
255-(b[2]+a[2]);return b});g.blend("linearlight",function(c,a,b){b[0]=a[0]+2*b[0]-255;b[1]=a[1]+2*b[1]-255;b[2]=a[2]+2*b[2]-255;return b});g.blend("linearburn",function(c,a,b){b[0]=a[0]+b[0]-255;b[1]=a[1]+b[1]-255;b[2]=a[2]+b[2]-255;return b});g.blend("softlight",function(c,a,b){b[0]=128<a[0]?255-(255-a[0])*(255-(b[0]-128))/255:a[0]*(b[0]+128)/255;b[1]=128<a[1]?255-(255-a[1])*(255-(b[1]-128))/255:a[1]*(b[1]+128)/255;b[2]=128<a[2]?255-(255-a[2])*(255-(b[2]-128))/255:a[2]*(b[2]+128)/255;return b});
g.blend("subbtract",function(c,a,b){b[0]=Math.max(a[0]-b[0],0);b[1]=Math.max(a[1]-b[1],0);b[2]=Math.max(a[2]-b[2],0);return b});g.blend("backlight",function(c,a,b){b[0]=255/a[0]*(255/b[0]);b[1]=255/a[1]*(255/b[1]);b[2]=255/a[2]*(255/b[2]);return b});g.blend("average",function(c,a,b){b[0]=(b[0]+a[0])/2;b[1]=(b[1]+a[1])/2;b[2]=(b[2]+a[2])/2;return b})})("tgen");(function(g){g=window[g];g.effect("fill",{blend:"",rgba:[128,128,128,255]},function(c,a){c.shape.rect(c,1,1,c.texture.width,c.texture.height);return a});g.effect("copy",{layer:null},function(c,a){"number"==typeof a&&(a={layer:a});null===a.layer&&(a.layer=c.layers.length-1);void 0!=c.layers[a.layer]&&(c.texture.data=c.layerCopy(a.layer));return a});g.effect("merge",{blend:"opacity",layer:0,opacity:null},function(c,a){if(void 0===c.layers[a.layer])return this;for(var b=c.layers[a.layer],d=0;d<c.texture.height;d++)for(var f=
0;f<c.texture.width;f++){var h=c.texture.offset(f,d);c.point.rgba=[b[h],b[h+1],b[h+2],a.opacity?a.opacity:b[h+3]];c.point.set(f,d)}return a});g.effect("noise",{blend:"softlight",mode:"monochrome",opacity:128},function(c,a){"color"==a.mode?c.walk(function(b){return b=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),a.opacity]}):c.walk(function(b){b=c.randInt(0,255);return b=[b,b,b,a.opacity]});return a});g.effect("spheres",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[20,
70],seed:[1,262140]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.sphere(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});g.effect("pyramids",{blend:"lighten",rgba:"random",origin:"random",dynamic:!1,count:21,size:[21,100],seed:[1,262140]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.pyramid(c,c.percentX(d.x),
c.percentY(d.y),c.percentXY(d.size),c.percentXY(d.size),!0,a.rgba,a.dynamic)}return a});g.effect("squares",{blend:"lighten",rgba:"random",origin:"random",count:[4,7],size:[2,50],seed:[1,262140]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.rect(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),c.percentXY(d.size),!1)}return a});g.effect("circles",{blend:"lighten",rgba:"random",origin:"random",count:21,size:[1,15],seed:[1,
262140]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);for(var b=0;b<a.count;b++){var d=c.xysize(b,a);c.shape.circle(c,c.percentX(d.x),c.percentY(d.y),c.percentXY(d.size),!0)}return a});g.effect("lines",{blend:"opacity",rgba:"random",size:[100,200],count:[100,400],freq1s:[21,150],freq1c:[21,150],freq2s:[21,150],freq2c:[21,150]},function(c,a){a.freq1s=c.randByArray(a.freq1s,!0);a.freq1c=c.randByArray(a.freq1c,!0);a.freq2s=c.randByArray(a.freq2s,!0);a.freq2c=c.randByArray(a.freq2c,
!0);a.size=c.randByArray(a.size);for(var b=0;b<a.count;b++)c.shape.line(c,c.texture.width/2+Math.sin(b/a.freq1s*c.calc.pi)*a.size,c.texture.height/2+Math.cos(b/a.freq1c*c.calc.pi)*a.size,c.texture.width/2+Math.sin(b/a.freq2s*c.calc.pi)*a.size,c.texture.height/2+Math.cos(b/a.freq2c*c.calc.pi)*a.size);return a});g.effect("lines2",{blend:["opacity","lighten","screen"],rgba:"random",type:"vertical",size:[.1,12],count:[2,32],seed:[1,262140]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);
for(var b=0;b<a.count;b++){var d=void 0!=a.elements?a.elements[b]:{size:c.randByArraySeed(a.size,!0),d:c.randRealSeed(.1,100)};"vertical"==a.type?c.shape.rect(c,c.percentX(d.d),0,c.percentX(d.size),c.texture.height):c.shape.rect(c,0,c.percentX(d.d),c.texture.width,c.percentX(d.size))}return a});g.effect("subplasma",{seed:[1,262140],size:[3,4],rgba:"random"},function(c,a){a.seed=c.randByArray(a.seed);a.size=c.randByArray(a.size);c.calc.randomseed(a.seed);var b=1<<a.size,d=c.texture.width,f=[],h,g;
b>d&&(b=d);var n=d/b;for(g=0;g<b;g++)for(h=0;h<b;h++)f[h*n+g*n*d]=c.calc.randomseed();for(g=0;g<b;g++)for(h=0;h<d;h++){var e=h&~(n-1),k=g*n*d;f[h+k]=c.calc.interpolate.catmullrom(f[(e-1*n&d-1)+k],f[(e-0*n&d-1)+k],f[(e+1*n&d-1)+k],f[(e+2*n&d-1)+k],h%n,n)}for(g=0;g<d;g++)for(h=0;h<d;h++)e=g&~(n-1),f[h+g*d]=c.calc.interpolate.catmullrom(f[h+(e-1*n&d-1)*d],f[h+(e-0*n&d-1)*d],f[h+(e+1*n&d-1)*d],f[h+(e+2*n&d-1)*d],g%n,n);for(h=0;h<c.texture.width;h++)for(g=0;g<c.texture.height;g++)b=255*f[h+g*d],c.point.rgba=
c.point.colorize(a.rgba,[b,b,b,255]),c.point.set(h,g);return a});g.effect("waves",{blend:"opacity",rgba:"random",level:50,xsines:[1,10],ysines:[1,10]},function(c,a){void 0===a.xsines?a.xsines=c.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=c.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=c.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=c.randInt(a.ysines[0],a.ysines[1]));void 0===a.rgba&&(a.rgba=c.rgba([[0,255],[0,255],[0,255],void 0!==a.opacity?a.opacity:255]));for(var b=0;b<
c.texture.width;b++)for(var d=0;d<c.texture.height;d++){var f=127+63.5*Math.sin(b/c.texture.width*a.xsines*2*c.calc.pi)+63.5*Math.sin(d/c.texture.height*a.ysines*2*c.calc.pi);c.point.rgba="object"==typeof a.channels?[a.channels[0]?f:0,a.channels[1]?f:0,a.channels[2]?f:0,a.channels[3]?f:0]:c.point.colorize([f,f,f,255],a.rgba,a.level);c.point.set(b,d)}return a});g.effect("crosshatch",{blend:"random",level:50},function(c,a){void 0==a.xadjust&&(a.xadjust=c.randInt(1,10));void 0===a.yadjust&&(a.yadjust=
c.randInt(1,10));void 0===a.rgba&&(a.rgba=[c.randInt(0,255),c.randInt(0,255),c.randInt(0,255),255]);for(var b=0;b<c.texture.width;b++)for(var d=0;d<c.texture.height;d++){var f=127+63.5*Math.sin(b*b/a.xadjust)+63.5*Math.cos(d*d/a.yadjust);c.point.rgba=c.point.colorize([f,f,f,255],a.rgba,a.level);c.point.set(b,d)}return a});g.effect("map",{xamount:[5,255],yamount:[5,255],xchannel:[0,2],ychannel:[0,2],xlayer:0,ylayer:0},function(c,a){a.xamount=c.randByArray(a.xamount);a.yamount=c.randByArray(a.yamount);
a.xchannel=c.randByArray(a.xchannel);a.ychannel=c.randByArray(a.ychannel);a.xlayer=c.randByArray(a.xlayer);a.ylayer=c.randByArray(a.ylayer);for(var b=new c.buffer,d=c.texture.width,f=c.texture.height,g=c.layers[a.xlayer],l=c.layers[a.ylayer],n=0;n<d;n++)for(var e=0;e<f;e++){var k=c.texture.offset(n,e),p=g[k+a.xchannel],q=l[k+a.ychannel];p=0==d%16?c.wrapx(n+(p*a.xamount*d>>16)):n+p*a.xamount*d/(d*d);q=0==f%16?c.wrapy(e+(q*a.yamount*f>>16)):e+q*a.yamount*f/(f*f);q=c.point.get(p,q);b.data[k]=q[0];b.data[k+
1]=q[1];b.data[k+2]=q[2];b.data[k+3]=q[3]}for(d=c.texture.size();d--;)c.texture.data[d]=b.data[d];return a});g.effect("clouds",{blend:"opacity",rgba:"random",seed:[1,262140],roughness:[2,16],colormap:null},function(c,a){a.seed=c.randByArray(a.seed);a.roughness=c.randByArray(a.roughness);var b=c.texture.width,d=c.texture.height,f=[],g=function(a,c,e){a=Math.round(a);c=Math.round(c);0>a&&(a=b+a);a>=b&&(a-=b);0>c&&(c=d+c);c>=d&&(c-=d);return void 0!==e?f[a][c]=e:f[a][c]},l=function(d){return(c.calc.randomseed()-
.5)*(d/(b+b))*a.roughness},n=function(e){var f=e/2;if(1>=f)return a;for(var h=f-f;h<=b+f;h+=f)for(var k=f-f;k<=d+f;k+=f){var q=g(h-f,k-f),p=g(h,k-f),x=g(h-f,k),w=g(h,k),v=h-f/2,z=k-f/2;w=g(v,z,c.calc.normalize1((q+p+x+w)/4+l(e)));g(h-f,z,c.calc.normalize1((q+x+w+g(h-e+f/2,z))/4+l(e)));g(v,k-f,c.calc.normalize1((q+p+w+g(v,k-e+f/2))/4+l(e)))}n(f)};c.calc.randomseed(a.seed);(function(){for(var a=0;a<=b;a++){f[a]=[];for(var c=0;c<=d;c++)f[a][c]=0}})();n(b);c.colormap.init(a.colormap,255,function(b){a.colormap=
b});for(var e=0;e<b;e++)for(var k=0;k<d;k++){var p=parseInt(255*f[e][k],10);c.point.rgba=null!==c.colormap.data?c.colormap.get(p,a.rgba):c.point.colorize(a.rgba,[p,p,p,255]);c.point.set(e,k)}return a});g.effect("colorbar",{type:"horizontal",mirror:!1,colormap:[{percent:0,rgba:[[0,255],[0,255],[0,255],255]},{percent:25,rgba:[[0,255],[0,255],[0,255],255]},{percent:50,rgba:[[0,255],[0,255],[0,255],255]},{percent:75,rgba:[[0,255],[0,255],[0,255],255]},{percent:100,rgba:[[0,255],[0,255],[0,255],255]}]},
function(c,a){var b=c.texture.width,d=c.texture.height;c.colormap.init(a.colormap,"horizontal"==a.type?b:d,function(b){a.colormap=b});if("horizontal"==a.type)for(var f=0;f<b;f++){if(a.mirror)var g=f<b/2?2*f:2*b-2*f;c.point.rgba=c.colormap.get(g);for(var l=0;l<d;l++)c.point.set(f,l)}else for(l=0;l<d;l++)for(a.mirror&&(g=l<d/2?2*l:2*d-2*l),c.point.rgba=c.colormap.get(g),f=0;f<b;f++)c.point.set(f,l);return a});g.effect("checkerboard",{size:[8,8],rgba:"randomalpha"},function(c,a){var b=c.texture.width,
d=c.texture.height;if("object"==typeof a.size)var f=a.size[0]=c.randByArray(a.size[0]),g=a.size[1]=c.randByArray(a.size[1]);else g=f=a.size;for(var l=b/f,n=d/g,e=function(a,e){for(var f=0;f<l;f++)for(var g=0;g<n;g++)f+a<b&&g+e<d&&c.point.set(f+a,g+e)},k=0;k<f;k++)if(0==k%2)for(var p=0;p<g;p++)0==p%2?e(k*l,p*n):e(k*l+l,p*n);return a});g.effect("dots",{blend:"opacity",gridX:[1,64],gridY:[1,64],size:[1,250],seed:[1,262140],rgba:"randomalpha",shape:"sphere",dynamic:!0,xsines:[1,16],ysines:[1,16]},function(c,
a){a.gridX=c.randByArray(a.gridX);a.gridY=c.randByArray(a.gridY);a.seed=c.randByArray(a.seed);void 0===a.xsines?a.xsines=c.randInt(1,10):"object"==typeof a.xsines&&(a.xsines=c.randInt(a.xsines[0],a.xsines[1]));void 0===a.ysines?a.ysines=c.randInt(1,10):"object"==typeof a.ysines&&(a.ysines=c.randInt(a.ysines[0],a.ysines[1]));c.calc.randomseed(a.seed);for(var b=c.randByArraySeed(a.size)/100,d=c.texture.width/a.gridX,f=c.texture.height/a.gridY,g=d/2,l=f/2,n=1;n<=a.gridX;n++)for(var e=1;e<=a.gridY;e++){var k=
b*(d+f)/2/2;k=k-k/2*Math.sin(n/a.gridX*a.xsines*2*c.calc.pi)+k/2*Math.sin(e/a.gridY*a.ysines*2*c.calc.pi);switch(a.shape){case "sphere":c.shape.sphere(c,n*d-g,e*f-l,2*k,!0,a.rgba,a.dynamic);break;case "pyramid":c.shape.pyramid(c,n*d-g,e*f-l,k,k,!0,a.rgba,a.dynamic);break;case "rect":c.shape.rect(c,n*d-g,e*f-l,k,k,!0,a.rgba,a.dynamic);break;default:k/=2,c.shape.circle(c,n*d-g,e*f-l,k,!0)}}return a});g.effect("mandelbrot",{blend:"opacity",rgba:"randomalpha",seed:[1,262140],iteration:[8,512],skip:[0,
8]},function(c,a){a.seed=c.randByArray(a.seed);c.calc.randomseed(a.seed);a.skip=c.randByArray(a.skip);a.iteration=c.randByArray(a.iteration);for(var b=c.texture.width,d=c.texture.height,f=a.rgba[0],g=a.rgba[1],l=a.rgba[2],n=256/f,e=256/g,k=256/l,p=a.iteration,q,t,m,r,u,y,x=0;x<d;x++){t=-1.5+3*x/d;for(var w=0;w<b;w++){m=q=-2+3*w/b;u=t;for(var v=0;v<p;v++){r=m*m;y=u*u;if(4<r+y)break;r=r-y+q;u=2*m*u+t;m=r}v>a.skip&&(c.point.rgba=[v%f*n,v%g*e,v%l*k,c.point.rgba[3]],c.point.set(w,x))}}return a})})("tgen");(function(g){g=window[g];g.effect("opacity",{adjust:128},function(c,a){c.walk(function(b){b[3]=a.adjust;return b});return a});g.effect("vibrance",{adjust:50},function(c,a){var b=-1*a.adjust;c.walk(function(a){var c=Math.max(a[0],a[1],a[2]),d=2*Math.abs(c-(a[0]+a[1]+a[2])/3)/255*b/100;a[0]!==c&&(a[0]+=(c-a[0])*d);a[1]!==c&&(a[1]+=(c-a[1])*d);a[2]!==c&&(a[2]+=(c-a[2])*d);return[a[0],a[1],a[2],a[3]]});return a});g.effect("brightness",{adjust:50,legacy:!0},function(c,a){!0===a.legacy?c.walk(function(b){return[Math.min(b[0]+
a.adjust,255),Math.min(b[1]+a.adjust,255),Math.min(b[2]+a.adjust,255),b[3]]}):c.walk(function(b){return[b[0]=Math.min(255/b[0]*(a.adjust/255),255),b[1]=Math.min(255/b[1]*(a.adjust/255),255),b[2]=Math.min(255/b[2]*(a.adjust/255),255),b[3]]});return a});g.effect("contrast",{adjust:50},function(c,a){var b=(100+a.adjust)/100;c.walk(function(a){a[0]=255*((a[0]/255-.5)*b+.5);a[1]=255*((a[1]/255-.5)*b+.5);a[2]=255*((a[2]/255-.5)*b+.5);return[Math.max(Math.min(a[0],255),0),Math.max(Math.min(a[1],255),0),
Math.max(Math.min(a[2],255),0),a[3]]});return a});g.effect("threshold",{adjust:128},function(c,a){c.walk(function(b){b=.2126*b[0]+.7152*b[1]+.0722*b[2]<=a.adjust?0:255;return[b,b,b,1]});return a});g.effect("gamma",{adjust:.5},function(c,a){c.walk(function(b){b[0]=255*Math.pow(b[0]/255,1/a.adjust);b[1]=255*Math.pow(b[1]/255,1/a.adjust);b[2]=255*Math.pow(b[2]/255,1/a.adjust);return[b[0],b[1],b[2],b[3]]});return a});g.effect("grayscale",{method:["ligthness","average","luminosity"]},function(c,a){"string"==
typeof a&&(a={method:a});"object"==typeof a.method&&(a.method=c.randItem(a.method));switch(a.method){case "ligthness":c.walk(function(a){var b=Math.max(a[0],a[1],a[2])+Math.min(a[0],a[1],a[2]);return[b,b,b,a[3]]});break;case "average":c.walk(function(a){var b=(a[0]+a[1]+a[2])/3;return[b,b,b,a[3]]});break;case "luminosity":c.walk(function(a){var b=c.calc.luminance(a);return[b,b,b,a[3]]})}return a});g.effect("colorize",{level:50,rgba:"random",colormap:null},function(c,a){c.colormap.init(a.colormap,
255,function(b){a.colormap=b});c.walk(function(b){if(c.colormap.data){var d=c.colormap.get((b[0]+b[1]+b[2])/3,a.rgba);d[3]=b[3];return d}return c.point.colorize(b,a.rgba,a.level)});return a});g.effect("invert",{channels:[1,1,1]},function(c,a){c.walk(function(b){return[a.channels[0]?255-b[0]:b[0],a.channels[1]?255-b[1]:b[1],a.channels[2]?255-b[2]:b[2],b[3]]});return a});g.effect("sobel",{type:1},function(c,a){c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-2,-1,0,0,0,1,2,1]:[-1,0,
1,-2,0,2,-1,0,1]});return a});g.effect("emboss",{type:1},function(c,a){c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[1,1,1,1,.7,-1,-1,-1,-1]:[-2,-1,0,-1,1,1,0,1,2]});return a});g.effect("edgedetect",{type:1},function(c,a){c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[-1,-1,-1,-1,8,-1,-1,-1,-1]:[0,1,0,1,-4,1,0,1,0]});return a});g.effect("sharpen",{type:1},function(c,a){c.do("convolute",{store:!1,transparent:!1,weights:1==a.type?[0,-1,0,-1,5,-1,0,-1,0]:[-1,-1,-1,-1,9,-1,
-1,-1,-1]});return a});g.effect("blur",{},function(c,a){c.do("convolute",{store:!1,transparent:!1,weights:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]});return a});g.effect("sinecolor",{sines:[1,7],channel:[0,2]},function(c,a){a.sines=c.randByArray(a.sines);a.channel=c.randByArray(a.channel);c.walk(function(b){var d=parseInt(255*Math.sin(c.calc.pi/180*b[a.channel]*(255/360)*a.sines));b[a.channel]=Math.abs(d);return b});return a});g.effect("convolute",{blend:"opacity",transparent:!1,weights:[1,1,1,1,1,1,
1,1,1]},function(c,a){if("object"!=typeof a.weights||null==a.weights)return a;var b=new c.buffer;b.clear();for(var d=Math.round(Math.sqrt(a.weights.length)),f=Math.floor(d/2),g=a.transparent?1:0,l=0;l<c.texture.height;l++)for(var n=0;n<c.texture.width;n++){for(var e=0,k=0,p=0,q=0,t=0;t<d;t++)for(var m=0;m<d;m++){var r=a.weights[t*d+m],u=c.texture.get(n+m-f,l+t-f);e+=u[0]*r;k+=u[1]*r;p+=u[2]*r;q+=u[3]}b.set(n,l,[e,k,p,q+g*(255-q)])}for(d=c.texture.size();d--;)c.texture.data[d]=b.data[d];return a})})("tgen");(function(g){g=window[g];g.shape("rect",function(c,a,b,d,f,g){void 0!==g&&(a-=parseInt(d/2,10),b-=parseInt(f/2,10));for(g=0;g<d;g++)for(var h=0;h<f;h++)c.point.set(a+g,b+h)});g.shape("circle",function(c,a,b,d,f){void 0==f&&(a+=d,b+=d);for(f=-d;f<d;f++)for(var g=Math.round(Math.sqrt(d*d-f*f)),l=-g;l<g;l++)c.point.set(a+f,b+l)});g.shape("line",function(c,a,b,d,f){var g=Math.sqrt((d-a)*(d-a)+(f-b)*(f-b));d=(d-a)/g;f=(f-b)/g;for(var l,n,e=0;e<g;e++)l=a+d*e,n=b+f*e,c.point.set(l,n)});g.shape("colorLine",
function(c,a,b,d,f,g){var h=Math.sqrt((d-a)*(d-a)+(f-b)*(f-b));d=(d-a)/h;f=(f-b)/h;for(var n,e,k=g.length,p=0;p<h;p++){n=a+d*p;e=b+f*p;var q=parseInt(p/h*k);c.point.rgba=g[q];for(q=1;7>=q;q++)c.point.set(n-q,e+q)}});g.shape("sphere",function(c,a,b,d,f,g,l){void 0==f&&(a+=d,b+=d);for(f=-d;f<d;f++)for(var h=parseInt(Math.sqrt(d*d-f*f),10),e=-h;e<h;e++){var k=Math.min(255,Math.max(0,255-255*Math.sqrt(e*e+f*f)/(d/2)))/255;0<k&&(c.point.rgba=[g[0]*k,g[1]*k,g[2]*k,l?255*k:g[3]],c.point.set(a+f,b+e))}});
g.shape("pyramid",function(c,a,b,d,f,g,l,n){var e=parseInt(d/2,10),h=parseInt(f/2,10);1!=g&&(a+=e,b+=h);for(g=-e;g<e;g++)for(var p=-h;p<h;p++){var q=255*(.25-Math.abs(g/d))+255*(.25-Math.abs(p/f));1<q&&(c.point.rgba=[l[0]/255*q,l[1]/255*q,l[2]/255*q,n?q:l[3]],c.point.set(a+g,b+p))}})})("tgen");
